<!DOCTYPE html>
<h1>Foreign Function Interface</h1>
<br>
<p>Rust provides a Foreign Function Interface (FFI) to C libraries. Foreign
functions must be declared inside an <code>extern</code> block annotated with a <code>#[link]</code>
attribute containing the name of the foreign library.</p>
<br>
<div data-lang="rust,ignore"><div data-l="use std::fmt;"></div><div data-l=""></div><div data-l="#// this extern block links to the libm library"></div><div data-l="// ">this extern block links to the libm library</div><div data-l="#[link(name = &quot;m&quot;)]"></div><div data-l="extern {"></div><div data-l="#    // this is a foreign function"></div><div data-l="#    // that computes the square root of a single precision complex number"></div><div data-l="    // ">this is a foreign function that computes the square root of a single precision complex number</div><div data-l="    fn csqrtf(z: Complex) -&gt; Complex;"></div><div data-l=""></div><div data-l="    fn ccosf(z: Complex) -&gt; Complex;"></div><div data-l="}"></div><div data-l=""></div><div data-l="#// Since calling foreign functions is considered unsafe,"></div><div data-l="#// it's common to write safe wrappers around them."></div><div data-l="// ">Since calling foreign functions is considered unsafe, it's common to write safe wrappers around them.</div><div data-l="fn cos(z: Complex) -&gt; Complex {"></div><div data-l="    unsafe { ccosf(z) }"></div><div data-l="}"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="#    // z = -1 + 0i"></div><div data-l="    // ">z = -1 + 0i</div><div data-l="    let z = Complex { re: -1., im: 0. };"></div><div data-l=""></div><div data-l="#    // calling a foreign function is an unsafe operation"></div><div data-l="    // ">calling a foreign function is an unsafe operation</div><div data-l="    let z_sqrt = unsafe { csqrtf(z) };"></div><div data-l=""></div><div data-l="    println!(&quot;the square root of {:?} is {:?}&quot;, z, z_sqrt);"></div><div data-l=""></div><div data-l="#    // calling safe API wrapped around unsafe operation"></div><div data-l="    // ">calling safe API wrapped around unsafe operation</div><div data-l="    println!(&quot;cos({:?}) = {:?}&quot;, z, cos(z));"></div><div data-l="}"></div><div data-l=""></div><div data-l="#// Minimal implementation of single precision complex numbers"></div><div data-l="// ">Minimal implementation of single precision complex numbers</div><div data-l="#[repr(C)]"></div><div data-l="#[derive(Clone, Copy)]"></div><div data-l="struct Complex {"></div><div data-l="    re: f32,"></div><div data-l="    im: f32,"></div><div data-l="}"></div><div data-l=""></div><div data-l="impl fmt::Debug for Complex {"></div><div data-l="    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {"></div><div data-l="        if self.im &lt; 0. {"></div><div data-l="            write!(f, &quot;{}-{}i&quot;, self.re, -self.im)"></div><div data-l="        } else {"></div><div data-l="            write!(f, &quot;{}+{}i&quot;, self.re, self.im)"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l="}"></div></div>