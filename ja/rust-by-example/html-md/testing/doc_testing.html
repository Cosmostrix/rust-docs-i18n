<!DOCTYPE html>
<h1>Documentation testing</h1>
<br>
<p>The primary way of documenting a Rust project is through annotating the source
code. Documentation comments are written in <a class="notranslate" href="#4markdown">markdown</a> and support code
blocks in them. Rust takes care about correctness, so these code blocks are
compiled and used as tests.</p>
<br>
<div data-lang="rust,ignore"><div data-l="#///// First line is a short summary describing function."></div><div data-l="/// ">First line is a short summary describing function.</div><div data-l="///"></div><div data-l="#///// The next lines present detailed documentation. Code blocks start with"></div><div data-l="/// ">The next lines present detailed documentation. Code blocks start with</div><div data-l="#///// triple backquotes and have implicit `fn main()` inside"></div><div data-l="/// ">triple backquotes and have implicit <code>fn main()</code> inside</div><div data-l="#///// and `extern crate &lt;cratename&gt;`. Assume we're testing `doccomments` crate:"></div><div data-l="/// ">and <code>extern crate &lt;cratename&gt;</code>. Assume we're testing <code>doccomments</code> crate:</div><div data-l="///"></div><div data-l="#///// ```"></div><div data-l="/// ">```</div><div data-l="#///// let result = doccomments::add(2, 3);"></div><div data-l="/// ">let result = doccomments::add(2, 3);</div><div data-l="#///// assert_eq!(result, 5);"></div><div data-l="/// ">assert_eq!(result, 5);</div><div data-l="#///// ```"></div><div data-l="/// ">```</div><div data-l="pub fn add(a: i32, b: i32) -&gt; i32 {"></div><div data-l="    a + b"></div><div data-l="}"></div><div data-l=""></div><div data-l="#///// Usually doc comments may include sections &quot;Examples&quot;, &quot;Panics&quot; and &quot;Failures&quot;."></div><div data-l="/// ">Usually doc comments may include sections &quot;Examples&quot;, &quot;Panics&quot; and &quot;Failures&quot;.</div><div data-l="///"></div><div data-l="#///// The next function divides two numbers."></div><div data-l="/// ">The next function divides two numbers.</div><div data-l="///"></div><div data-l="#///// # Examples"></div><div data-l="/// "># Examples</div><div data-l="///"></div><div data-l="#///// ```"></div><div data-l="/// ">```</div><div data-l="#///// let result = doccomments::div(10, 2);"></div><div data-l="/// ">let result = doccomments::div(10, 2);</div><div data-l="#///// assert_eq!(result, 5);"></div><div data-l="/// ">assert_eq!(result, 5);</div><div data-l="#///// ```"></div><div data-l="/// ">```</div><div data-l="///"></div><div data-l="#///// # Panics"></div><div data-l="/// "># Panics</div><div data-l="///"></div><div data-l="#///// The function panics if the second argument is zero."></div><div data-l="/// ">The function panics if the second argument is zero.</div><div data-l="///"></div><div data-l="#///// ```rust,should_panic"></div><div data-l="/// ">```rust,should_panic</div><div data-l="#///// // panics on division by zero"></div><div data-l="/// ">// panics on division by zero</div><div data-l="#///// doccomments::div(10, 0);"></div><div data-l="/// ">doccomments::div(10, 0);</div><div data-l="#///// ```"></div><div data-l="/// ">```</div><div data-l="pub fn div(a: i32, b: i32) -&gt; i32 {"></div><div data-l="    if b == 0 {"></div><div data-l="        panic!(&quot;Divide-by-zero error&quot;);"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    a / b"></div><div data-l="}"></div></div>
<br>
<p>Tests can be run with <code>cargo test</code>:</p>
<br>
<div data-lang="bash"><div data-l="$ cargo test"></div><div data-l="running 0 tests"></div><div data-l=""></div><div data-l="test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div><div data-l=""></div><div data-l="   Doc-tests doccomments"></div><div data-l=""></div><div data-l="running 3 tests"></div><div data-l="test src/lib.rs - add (line 7) ... ok"></div><div data-l="test src/lib.rs - div (line 21) ... ok"></div><div data-l="test src/lib.rs - div (line 31) ... ok"></div><div data-l=""></div><div data-l="test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div>
<br>
<h2>Motivation behind documentation tests</h2>
<br>
<p>The main purpose of documentation tests is to serve as an examples that exercise
the functionality, which is one of the most important
<a class="notranslate" href="#3question-instead-of-unwrap">guidelines</a>. It allows using examples from docs as
complete code snippets. But using <code>?</code> makes compilation fail since <code>main</code>
returns <code>unit</code>. The ability to hide some source lines from documentation comes
to the rescue: one may write <code>fn try_main() -&gt; Result&lt;(), ErrorType&gt;</code>, hide it and
<code>unwrap</code> it in hidden <code>main</code>. Sounds complicated? Here's an example:</p>
<br>
<div data-lang="rust,ignore"><div data-l="#///// Using hidden `try_main` in doc tests."></div><div data-l="/// ">Using hidden <code>try_main</code> in doc tests.</div><div data-l="///"></div><div data-l="#///// ```"></div><div data-l="/// ">```</div><div data-l="#///// # // hidden lines start with `#` symbol, but they're still compileable!"></div><div data-l="/// "># // hidden lines start with <code>#</code> symbol, but they're still compileable!</div><div data-l="#///// # fn try_main() -&gt; Result&lt;(), String&gt; { // line that wraps the body shown in doc"></div><div data-l="/// "># fn try_main() -&gt; Result<(), String> { // line that wraps the body shown in doc</div><div data-l="#///// let res = try::try_div(10, 2)?;"></div><div data-l="/// ">let res = try::try_div(10, 2)?;</div><div data-l="#///// # Ok(()) // returning from try_main"></div><div data-l="/// "># Ok(()) // returning from try_main</div><div data-l="#///// # }"></div><div data-l="/// "># }</div><div data-l="#///// # fn main() { // starting main that'll unwrap()"></div><div data-l="/// "># fn main() { // starting main that'll unwrap()</div><div data-l="#///// #    try_main().unwrap(); // calling try_main and unwrapping"></div><div data-l="/// ">#    try_main().unwrap(); // calling try_main and unwrapping</div><div data-l="#///// #                         // so that test will panic in case of error"></div><div data-l="/// ">#                         // so that test will panic in case of error</div><div data-l="#///// # }"></div><div data-l="/// "># }</div><div data-l="pub fn try_div(a: i32, b: i32) -&gt; Result&lt;i32, String&gt; {"></div><div data-l="    if b == 0 {"></div><div data-l="        Err(String::from(&quot;Divide-by-zero&quot;))"></div><div data-l="    } else {"></div><div data-l="        Ok(a / b)"></div><div data-l="    }"></div><div data-l="}"></div></div>
<br>
<h2>See Also</h2>
<br>
<div data-b="*"><a class="notranslate" href="#3RFC505">RFC505</a> on documentation style</div>
<div data-b="*"><a href="#3doc-nursery">API Guidelines</a> on documentation guidelines</div>
<br>
<a class="notranslate" href="#1https://rust-lang-nursery.github.io/api-guidelines/documentation.html">doc-nursery</a>
<a class="notranslate" href="#1https://daringfireball.net/projects/markdown/">markdown</a>
<a class="notranslate" href="#1https://github.com/rust-lang/rfcs/blob/master/text/0505-api-comment-conventions.md">RFC505</a>
<a class="notranslate" href="#1https://rust-lang-nursery.github.io/api-guidelines/documentation.html#examples-use--not-try-not-unwrap-c-question-mark">question-instead-of-unwrap</a>