<!DOCTYPE html>
<h1>Testcase: unit clarification</h1>
<br>
<p>A useful method of unit conversions can be examined by implementing <code>Add</code>
with a phantom type parameter. The <code>Add</code> <code>trait</code> is examined below:</p>
<br>
<div data-lang="rust,ignore"><div data-l="#// This construction would impose: `Self + RHS = Output`"></div><div data-l="#// where RHS defaults to Self if not specified in the implementation."></div><div data-l="// ">This construction would impose: <code>Self + RHS = Output</code> where RHS defaults to Self if not specified in the implementation.</div><div data-l="pub trait Add&lt;RHS = Self&gt; {"></div><div data-l="    type Output;"></div><div data-l=""></div><div data-l="    fn add(self, rhs: RHS) -&gt; Self::Output;"></div><div data-l="}"></div><div data-l=""></div><div data-l="#// `Output` must be `T&lt;U&gt;` so that `T&lt;U&gt; + T&lt;U&gt; = T&lt;U&gt;`."></div><div data-l="// "><code>Output</code> must be <code>T&lt;U&gt;</code> so that <code>T&lt;U&gt; + T&lt;U&gt; = T&lt;U&gt;</code>.</div><div data-l="impl&lt;U&gt; Add for T&lt;U&gt; {"></div><div data-l="    type Output = T&lt;U&gt;;"></div><div data-l="    ..."></div><div data-l="}"></div></div>
<br>
<p>The whole implementation:</p>
<br>
<div data-lang="rust,editable"><div data-l="use std::ops::Add;"></div><div data-l="use std::marker::PhantomData;"></div><div data-l=""></div><div data-l="#///// Create void enumerations to define unit types."></div><div data-l="/// ">Create void enumerations to define unit types.</div><div data-l="#[derive(Debug, Clone, Copy)]"></div><div data-l="enum Inch {}"></div><div data-l="#[derive(Debug, Clone, Copy)]"></div><div data-l="enum Mm {}"></div><div data-l=""></div><div data-l="#///// `Length` is a type with phantom type parameter `Unit`,"></div><div data-l="/// "><code>Length</code> is a type with phantom type parameter <code>Unit</code>,</div><div data-l="#///// and is not generic over the length type (that is `f64`)."></div><div data-l="/// ">and is not generic over the length type (that is <code>f64</code>).</div><div data-l="///"></div><div data-l="#///// `f64` already implements the `Clone` and `Copy` traits."></div><div data-l="/// "><code>f64</code> already implements the <code>Clone</code> and <code>Copy</code> traits.</div><div data-l="#[derive(Debug, Clone, Copy)]"></div><div data-l="struct Length&lt;Unit&gt;(f64, PhantomData&lt;Unit&gt;);"></div><div data-l=""></div><div data-l="#///// The `Add` trait defines the behavior of the `+` operator."></div><div data-l="/// ">The <code>Add</code> trait defines the behavior of the <code>+</code> operator.</div><div data-l="impl&lt;Unit&gt; Add for Length&lt;Unit&gt; {"></div><div data-l="     type Output = Length&lt;Unit&gt;;"></div><div data-l=""></div><div data-l="#    // add() returns a new `Length` struct containing the sum."></div><div data-l="    // ">add() returns a new <code>Length</code> struct containing the sum.</div><div data-l="    fn add(self, rhs: Length&lt;Unit&gt;) -&gt; Length&lt;Unit&gt; {"></div><div data-l="#        // `+` calls the `Add` implementation for `f64`."></div><div data-l="        // "><code>+</code> calls the <code>Add</code> implementation for <code>f64</code>.</div><div data-l="        Length(self.0 + rhs.0, PhantomData)"></div><div data-l="    }"></div><div data-l="}"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="#    // Specifies `one_foot` to have phantom type parameter `Inch`."></div><div data-l="    // ">Specifies <code>one_foot</code> to have phantom type parameter <code>Inch</code>.</div><div data-l="    let one_foot:  Length&lt;Inch&gt; = Length(12.0, PhantomData);"></div><div data-l="#    // `one_meter` has phantom type parameter `Mm`."></div><div data-l="    // "><code>one_meter</code> has phantom type parameter <code>Mm</code>.</div><div data-l="    let one_meter: Length&lt;Mm&gt;   = Length(1000.0, PhantomData);"></div><div data-l=""></div><div data-l="#    // `+` calls the `add()` method we implemented for `Length&lt;Unit&gt;`."></div><div data-l="    // "><code>+</code> calls the <code>add()</code> method we implemented for <code>Length&lt;Unit&gt;</code>.</div><div data-l="    //"></div><div data-l="#    // Since `Length` implements `Copy`, `add()` does not consume"></div><div data-l="#    // `one_foot` and `one_meter` but copies them into `self` and `rhs`."></div><div data-l="    // ">Since <code>Length</code> implements <code>Copy</code>, <code>add()</code> does not consume <code>one_foot</code> and <code>one_meter</code> but copies them into <code>self</code> and <code>rhs</code>.</div><div data-l="    let two_feet = one_foot + one_foot;"></div><div data-l="    let two_meters = one_meter + one_meter;"></div><div data-l=""></div><div data-l="#    // Addition works."></div><div data-l="    // ">Addition works.</div><div data-l="    println!(&quot;one foot + one_foot = {:?} in&quot;, two_feet.0);"></div><div data-l="    println!(&quot;one meter + one_meter = {:?} mm&quot;, two_meters.0);"></div><div data-l=""></div><div data-l="#    // Nonsensical operations fail as they should:"></div><div data-l="#    // Compile-time Error: type mismatch."></div><div data-l="    // ">Nonsensical operations fail as they should: Compile-time Error: type mismatch.</div><div data-l="    //let one_feter = one_foot + one_meter;"></div><div data-l="}"></div></div>
<br>
<h3>See also:</h3>
<br>
<p><a class="notranslate" href="#4Borrowing (`&`)">Borrowing (`&`)</a>, <a class="notranslate" href="#4Bounds (`X: Y`)">Bounds (`X: Y`)</a>, <a class="notranslate" href="#4enum">enum</a>, <a class="notranslate" href="#4impl & self">impl & self</a>,
<a class="notranslate" href="#4Overloading">Overloading</a>, <a class="notranslate" href="#4ref">ref</a>, <a class="notranslate" href="#4Traits (`X for Y`)">Traits (`X for Y`)</a>, and <a class="notranslate" href="#4TupleStructs">TupleStructs</a>.</p>
<br>
<a class="notranslate" href="#1scope/borrow.html">Borrowing (`&amp;`)</a>
<a class="notranslate" href="#1generics/bounds.html">Bounds (`X: Y`)</a>
<a class="notranslate" href="#1custom_types/enum.html">enum</a>
<a class="notranslate" href="#1fn/methods.html">impl &amp; self</a>
<a class="notranslate" href="#1trait/ops.html">Overloading</a>
<a class="notranslate" href="#1scope/borrow/ref.html">ref</a>
<a class="notranslate" href="#1trait.html">Traits (`X for Y`)</a>
<a class="notranslate" href="#1custom_types/structs.html">TupleStructs</a>
<a class="notranslate" href="#1https://doc.rust-lang.org/std/marker/struct.PhantomData.html">std::marker::PhantomData</a>