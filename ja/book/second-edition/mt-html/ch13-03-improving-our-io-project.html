<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch13-03-improving-our-io-project.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Improving Our I/O Project</span> I / Oプロジェクトの改善</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">With this new knowledge about iterators, we can improve the I/O project in Chapter 12 by using iterators to make places in the code clearer and more concise.</span>イテレータに関するこの新しい知識を使用して、第12章でI / Oプロジェクトを改善することで、イテレータを使用してコード内の場所をより明確かつ簡潔にすることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s look at how iterators can improve our implementation of the <code>Config::new</code> function and the <code>search</code> function.</span>イテレータが<code>Config::new</code>関数と<code>search</code>関数の実装を改善する方法を見てみましょう。</span> </p><br><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Removing a <code>clone</code> Using an Iterator</span>イテレータを使用した<code>clone</code>削除</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Listing 12-6, we added code that took a slice of <code>String</code> values and created an instance of the <code>Config</code> struct by indexing into the slice and cloning the values, allowing the <code>Config</code> struct to own those values.</span>コードリスト12-6では、スライスにインデックスを付けて値を複製し、 <code>Config</code>構造体がそれらの値を所有できるようにして、 <code>String</code>値のスライスを取り、 <code>Config</code>構造体のインスタンスを作成するコードを追加しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Listing 13-24, we&#39;ve reproduced the implementation of the <code>Config::new</code> function as it was in Listing 12-23:</span>リスト13-24では、リスト12-23のように<code>Config::new</code>関数の実装を再現しました：</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="impl Config {"></div><div data-l="    pub fn new(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {"></div><div data-l="        if args.len() &lt; 3 {"></div><div data-l="            return Err(&quot;not enough arguments&quot;);"></div><div data-l="        }"></div><div data-l=""></div><div data-l="        let query = args[1].clone();"></div><div data-l="        let filename = args[2].clone();"></div><div data-l=""></div><div data-l="        let case_sensitive = env::var(&quot;CASE_INSENSITIVE&quot;).is_err();"></div><div data-l=""></div><div data-l="        Ok(Config { query, filename, case_sensitive })"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 13-24: Reproduction of the <code>Config::new</code> function from Listing 12-23</span></span> <span class=caption>リスト13-24：リスト12-23の<code>Config::new</code>関数の再現</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">At the time, we said not to worry about the inefficient <code>clone</code> calls because we would remove them in the future.</span>当時、 <code>clone</code>コールの非効率性については心配しないようにしました。なぜなら、将来<code>clone</code>コールを削除するからです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Well, that time is now!</span>さて、その時は今です！</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We needed <code>clone</code> here because we have a slice with <code>String</code> elements in the parameter <code>args</code> , but the <code>new</code> function doesn&#39;t own <code>args</code> .</span>パラメータ<code>args</code> <code>String</code>要素を含むスライスがあるため、ここで<code>clone</code>必要でしたが、 <code>new</code>関数は<code>args</code>所有していません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To return ownership of a <code>Config</code> instance, we had to clone the values from the <code>query</code> and <code>filename</code> fields of <code>Config</code> so the <code>Config</code> instance can own its values.</span>所有権戻るには<code>Config</code>インスタンスを、私たちは、から値のクローンを作成しなければならなかった<code>query</code>と<code>filename</code>のフィールド<code>Config</code>よう<code>Config</code>インスタンスは、その値を所有することができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">With our new knowledge about iterators, we can change the <code>new</code> function to take ownership of an iterator as its argument instead of borrowing a slice.</span>イテレータについての新しい知識があれば、 <code>new</code>関数を変更して、スライスを借用するのではなく、イテレータの所有権を引数として取ることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll use the iterator functionality instead of the code that checks the length of the slice and indexes into specific locations.</span>スライダの長さをチェックし、特定の場所にインデックスを付けるコードの代わりに、イテレータ機能を使用します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This will clarify what the <code>Config::new</code> function is doing because the iterator will access the values.</span>これは、イテレータが値にアクセスするため、 <code>Config::new</code>関数が何をしているのかを明確にします。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Once <code>Config::new</code> takes ownership of the iterator and stops using indexing operations that borrow, we can move the <code>String</code> values from the iterator into <code>Config</code> rather than calling <code>clone</code> and making a new allocation.</span> <code>Config::new</code>がイテレータの所有権を奪い、借りているインデックス処理の使用をやめると、 <code>clone</code>を呼び出して新しい割り当てを行うのではなく、イテレータから<code>Config</code> <code>String</code>値を移すことができます。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using the Returned Iterator Directly</span>返されたイテレータを直接使用する</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Open your I/O project&#39;s <i>src/main.rs</i> file, which should look like this:</span> I / Oプロジェクトの<i>src / main.rs</i>ファイルを<i>開き</i>ます。これは次のようになります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="fn main() {"></div><div data-l="    let args: Vec&lt;String&gt; = env::args().collect();"></div><div data-l=""></div><div data-l="    let config = Config::new(&amp;args).unwrap_or_else(|err| {"></div><div data-l="        eprintln!(&quot;Problem parsing arguments: {}&quot;, err);"></div><div data-l="        process::exit(1);"></div><div data-l="    });"></div><div data-l=""></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll change the start of the <code>main</code> function that we had in Listing 12-24 at to the code in Listing 13-25.</span>コードリスト12-24の<code>main</code>機能の開始点をリスト13-25のコードに変更します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This won&#39;t compile until we update <code>Config::new</code> as well.</span>これは、 <code>Config::new</code>も更新するまではコンパイルされません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="fn main() {"></div><div data-l="    let config = Config::new(env::args()).unwrap_or_else(|err| {"></div><div data-l="        eprintln!(&quot;Problem parsing arguments: {}&quot;, err);"></div><div data-l="        process::exit(1);"></div><div data-l="    });"></div><div data-l=""></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 13-25: Passing the return value of <code>env::args</code> to <code>Config::new</code></span></span> <span class=caption>リスト13-25： <code>env::args</code>戻り値を<code>Config::new</code>渡す</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>env::args</code> function returns an iterator!</span> <code>env::args</code>関数はイテレータを返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rather than collecting the iterator values into a vector and then passing a slice to <code>Config::new</code> , now we&#39;re passing ownership of the iterator returned from <code>env::args</code> to <code>Config::new</code> directly.</span>イテレータの値をベクトルに集めてから、 <code>Config::new</code>スライスを渡すのではなく、 <code>env::args</code>から返されたイテレータの所有権を<code>Config::new</code>直接渡しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Next, we need to update the definition of <code>Config::new</code> .</span>次に、 <code>Config::new</code>定義を更新する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In your I/O project&#39;s <i>src/lib.rs</i> file, let&#39;s change the signature of <code>Config::new</code> to look like Listing 13-26.</span>あなたのI / Oプロジェクトの<i>src / lib.rs</i>ファイルで、 <code>Config::new</code>シグネチャをリスト13-26のように変更しましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This still won&#39;t compile because we need to update the function body.</span>関数本体を更新する必要があるため、これはまだコンパイルされません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="impl Config {"></div><div data-l="    pub fn new(mut args: std::env::Args) -&gt; Result&lt;Config, &amp;'static str&gt; {"></div><div data-l="#        // --snip--"></div><div data-l="        // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 13-26: Updating the signature of <code>Config::new</code> to expect an iterator</span></span> <span class=caption>リスト13-26：イテレータを期待するために<code>Config::new</code>シグネチャを更新する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The standard library documentation for the <code>env::args</code> function shows that the type of the iterator it returns is <code>std::env::Args</code> .</span> <code>env::args</code>関数の標準ライブラリのドキュメントは、それが返すイテレータの型が<code>std::env::Args</code>ことを示しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve updated the signature of the <code>Config::new</code> function so the parameter <code>args</code> has the type <code>std::env::Args</code> instead of <code>&amp;[String]</code> .</span> <code>Config::new</code>関数のシグネチャを更新しました。パラメータ<code>args</code>には<code>&amp;[String]</code>代わりに<code>std::env::Args</code>型があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because we&#39;re taking ownership of <code>args</code> and we&#39;ll be mutating <code>args</code> by iterating over it, we can add the <code>mut</code> keyword into the specification of the <code>args</code> parameter to make it mutable.</span>我々はの所有権取っているので<code>args</code> 、我々が変異することがあります<code>args</code> 、反復処理を行うことで、我々は追加できる<code>mut</code>の仕様にキーワードを<code>args</code>それを可変にするパラメータ。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using <code>Iterator</code> Trait Methods Instead of Indexing</span>インデックス作成の代わりに<code>Iterator</code> Traitメソッドを使用する</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Next, we&#39;ll fix the body of <code>Config::new</code> .</span>次に、 <code>Config::new</code>本文を修正します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The standard library documentation also mentions that <code>std::env::Args</code> implements the <code>Iterator</code> trait, so we know we can call the <code>next</code> method on it!</span>標準的なライブラリのドキュメントでは、 <code>std::env::Args</code>が<code>Iterator</code>特性を実装しているので、 <code>next</code>メソッドを呼び出すことができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 13-27 updates the code from Listing 12-23 to use the <code>next</code> method:</span>コードリスト13-27は、リスト12-23のコードを更新して<code>next</code>メソッドを使用する方法を示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="# use std::env;"></div><div data-l=#></div><div data-l="# struct Config {"></div><div data-l="#     query: String,"></div><div data-l="#     filename: String,"></div><div data-l="#     case_sensitive: bool,"></div><div data-l="# }"></div><div data-l=#></div><div data-l="impl Config {"></div><div data-l="    pub fn new(mut args: std::env::Args) -&gt; Result&lt;Config, &amp;'static str&gt; {"></div><div data-l="        args.next();"></div><div data-l=""></div><div data-l="        let query = match args.next() {"></div><div data-l="            Some(arg) =&gt; arg,"></div><div data-l="            None =&gt; return Err(&quot;Didn't get a query string&quot;),"></div><div data-l="        };"></div><div data-l=""></div><div data-l="        let filename = match args.next() {"></div><div data-l="            Some(arg) =&gt; arg,"></div><div data-l="            None =&gt; return Err(&quot;Didn't get a file name&quot;),"></div><div data-l="        };"></div><div data-l=""></div><div data-l="        let case_sensitive = env::var(&quot;CASE_INSENSITIVE&quot;).is_err();"></div><div data-l=""></div><div data-l="        Ok(Config { query, filename, case_sensitive })"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 13-27: Changing the body of <code>Config::new</code> to use iterator methods</span></span> <span class=caption>リスト13-27：イテレータメソッドを使うために<code>Config::new</code>本文を変更する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Remember that the first value in the return value of <code>env::args</code> is the name of the program.</span> <code>env::args</code>戻り値の最初の値はプログラムの名前です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We want to ignore that and get to the next value, so first we call <code>next</code> and do nothing with the return value.</span>それを無視して次の値に到達したいので、最初に<code>next</code>を呼び出し、戻り値で何もしません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Second, we call <code>next</code> to get the value we want to put in the <code>query</code> field of <code>Config</code> .</span>次に、 <code>next</code>を呼び出して、 <code>Config</code> <code>query</code>フィールドに入れたい値を取得します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If <code>next</code> returns a <code>Some</code> , we use a <code>match</code> to extract the value.</span> <code>next</code>が<code>Some</code>返す場合は、 <code>match</code>を使用して値を抽出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If it returns <code>None</code> , it means not enough arguments were given and we return early with an <code>Err</code> value.</span> <code>None</code>を返すと、十分な引数が与えられていないことを意味し、 <code>Err</code>値で早期に返されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We do the same thing for the <code>filename</code> value.</span> <code>filename</code>値も同じです。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Making Code Clearer with Iterator Adaptors</span>イテレータアダプタでコードをより明瞭にする</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can also take advantage of iterators in the <code>search</code> function in our I/O project, which is reproduced here in Listing 13-28 as it was in Listing 12-19:</span>リスト12-19のリスト13-28のように、I / Oプロジェクトの<code>search</code>機能でイテレータを利用することもできます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    let mut results = Vec::new();"></div><div data-l=""></div><div data-l="    for line in contents.lines() {"></div><div data-l="        if line.contains(query) {"></div><div data-l="            results.push(line);"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    results"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 13-28: The implementation of the <code>search</code> function from Listing 12-19</span></span> <span class=caption>リスト13-28：コードリスト12-19の<code>search</code>関数の実装</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can write this code in a more concise way using iterator adaptor methods.</span>イテレータアダプタのメソッドを使用して、このコードをより簡潔な方法で記述することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Doing so also lets us avoid having a mutable intermediate <code>results</code> vector.</span>そうすることで、変更可能な中間<code>results</code>ベクトルを避けることもできます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The functional programming style prefers to minimize the amount of mutable state to make code clearer.</span>関数型プログラミングスタイルは、コードを明確にするために可変状態の量を最小限にすることを好みます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Removing the mutable state might enable a future enhancement to make searching happen in parallel, because we wouldn&#39;t have to manage concurrent access to the <code>results</code> vector.</span>変更可能状態を削除すると、 <code>results</code>ベクトルへの同時アクセスを管理する必要がないため、検索を並行して行うための将来の拡張が可能になり<code>results</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 13-29 shows this change:</span>リスト13-29はこの変更を示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    contents.lines()"></div><div data-l="        .filter(|line| line.contains(query))"></div><div data-l="        .collect()"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 13-29: Using iterator adaptor methods in the implementation of the <code>search</code> function</span></span> <span class=caption>リスト13-29： <code>search</code>関数の実装におけるイテレータアダプタメソッドの使用</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Recall that the purpose of the <code>search</code> function is to return all lines in <code>contents</code> that contain the <code>query</code> .</span> <code>search</code>関数の目的は、 <code>query</code>を含む<code>contents</code>すべての行を返すことです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Similar to the <code>filter</code> example in Listing 13-19, this code uses the <code>filter</code> adaptor to keep only the lines that <code>line.contains(query)</code> returns <code>true</code> for.</span>リスト13-19の<code>filter</code>例と同様に、このコードでは、 <code>filter</code>アダプタを使用して<code>line.contains(query)</code>が<code>true</code>を返す行だけを保持し<code>line.contains(query)</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We then collect the matching lines into another vector with <code>collect</code> .</span>その後、一致する行を<code>collect</code>を<code>collect</code>て別のベクトルに<code>collect</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Much simpler!</span>もっと簡単！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Feel free to make the same change to use iterator methods in the <code>search_case_insensitive</code> function as well.</span> <code>search_case_insensitive</code>関数でイテレータメソッドを使用するようにも同じ変更を加えてください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The next logical question is which style you should choose in your own code and why: the original implementation in Listing 13-28 or the version using iterators in Listing 13-29.</span>次の論理的な質問は、独自のコードでどのスタイルを選択する必要があるのか​​、またその理由はリスト13-28の元の実装またはリスト13-29のイテレータを使用するバージョンです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Most Rust programmers prefer to use the iterator style.</span>ほとんどのRustプログラマーはイテレータースタイルを使用することを好みます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It&#39;s a bit tougher to get the hang of at first, but once you get a feel for the various iterator adaptors and what they do, iterators can be easier to understand.</span>最初はハングアップするのはやや難しいですが、いろいろなイテレーターアダプターの感覚を得ると、イテレーターは理解しやすくなります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Instead of fiddling with the various bits of looping and building new vectors, the code focuses on the high-level objective of the loop.</span>ループのさまざまな部分を手にして新しいベクトルを構築するのではなく、ループの高レベルの目的に焦点を合わせます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This abstracts away some of the commonplace code so it&#39;s easier to see the concepts that are unique to this code, such as the filtering condition each element in the iterator must pass.</span>このコードでは、いくつかの一般的なコードを抽象化しているので、イテレータの各要素が通過しなければならないフィルタ条件など、このコードに固有の概念を簡単に見ることができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">But are the two implementations truly equivalent?</span>しかし、2つの実装は本当に同等ですか？</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The intuitive assumption might be that the more low-level loop will be faster.</span>直感的な前提は、より低レベルのループが高速になることです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s talk about performance.</span>パフォーマンスについて話しましょう。</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch13-03-improving-our-io-project.html');});</script>