<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch11-01-writing-tests.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">How to Write Tests</span>テストを書く方法</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Tests are Rust functions that verify that the non-test code is functioning in the expected manner.</span>テストは、非テストコードが期待どおりに機能していることを検証するRust関数です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The bodies of test functions typically perform these three actions:</span>テスト関数の本体は、通常、次の3つのアクションを実行します。</span> </p><br><div data-b=1.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Set up any needed data or state.</span>必要なデータや状態を設定します。</span> </div><div data-b=2.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Run the code you want to test.</span>テストするコードを実行します。</span> </div><div data-b=3.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Assert the results are what you expect.</span>アサート結果は期待通りです。</span> </div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s look at the features Rust provides specifically for writing tests that take these actions, which include the <code>test</code> attribute, a few macros, and the <code>should_panic</code> attribute.</span> Rustが、 <code>test</code>属性、いくつかのマクロ、 <code>should_panic</code>属性を含むこれらのアクションを実行するテストを記述するために特に提供する機能を見てみましょう。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The Anatomy of a Test Function</span>テスト機能の解剖</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">At its simplest, a test in Rust is a function that&#39;s annotated with the <code>test</code> attribute.</span>最も簡単な方法では、Rustでの<code>test</code>は<code>test</code>属性で注釈を付けられた関数です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Attributes are metadata about pieces of Rust code;</span>属性は、錆コードに関するメタデータです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">one example is the <code>derive</code> attribute we used with structs in Chapter 5. To change a function into a test function, add <code>#[test]</code> on the line before <code>fn</code> .</span> 1つの例は、第5章でstructで使用した<code>derive</code>属性です。関数をテスト関数に変更するには、 <code>fn</code>前の行に<code>#[test]</code>を追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When you run your tests with the <code>cargo test</code> command, Rust builds a test runner binary that runs the functions annotated with the <code>test</code> attribute and reports on whether each test function passes or fails.</span> <code>cargo test</code>コマンドでテストを実行すると、Rustは<code>test</code>属性で注釈を付けられた関数を実行するテストランナーバイナリを作成し、各テスト関数が成功するか失敗するかを報告します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Chapter 7, we saw that when we make a new library project with Cargo, a test module with a test function in it is automatically generated for us.</span>第7章では、Cargoを使用して新しいライブラリプロジェクトを作成するときに、その中にテスト機能を持つテストモジュールが自動的に生成されることがわかりました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This module helps you start writing your tests so you don&#39;t have to look up the exact structure and syntax of test functions every time you start a new project.</span>このモジュールはテストの作成を開始するのに役立ちますので、新しいプロジェクトを開始するたびにテスト関数の構造と構文を正確に調べる必要はありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You can add as many additional test functions and as many test modules as you want!</span>必要なだけ多くのテスト機能とテストモジュールを追加することができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll explore some aspects of how tests work by experimenting with the template test generated for us without actually testing any code.</span>実際にコードをテストすることなく、私たちのために生成されたテンプレートテストを試すことで、テストの仕組みのいくつかの側面を探求します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we&#39;ll write some real-world tests that call some code that we&#39;ve written and assert that its behavior is correct.</span>次に、私たちが書いたコードを呼び出し、その動作が正しいことを主張する実際のテストを書きます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s create a new library project called <code>adder</code> :</span> <code>adder</code>という新しいライブラリプロジェクトを作成しましょう：</span> </p><br><div data-lang=text><div data-l="$ cargo new adder --lib"></div><div data-l="     Created library `adder` project"></div><div data-l="$ cd adder"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The contents of the <i>src/lib.rs</i> file in your <code>adder</code> library should look like Listing 11-1.</span> <code>adder</code>ライブラリ内の<i>src / lib.rs</i>ファイルの内容はリスト11-1のようになります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    #[test]"></div><div data-l="    fn it_works() {"></div><div data-l="        assert_eq!(2 + 2, 4);"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-1: The test module and function generated automatically by <code>cargo new</code></span></span> <span class=caption>リスト11-1： <code>cargo new</code>によって自動的に生成されたテストモジュールと関数</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For now, let&#39;s ignore the top two lines and focus on the function to see how it works.</span>今のところ、上の2行を無視して、関数にどのように作用するかを見てみましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note the <code>#[test]</code> annotation before the <code>fn</code> line: this attribute indicates this is a test function, so the test runner knows to treat this function as a test.</span> <code>fn</code>行の前に<code>#[test]</code>注釈があることに注意してください。この属性はこれがテスト関数であることを示しているので、テストランナーはこの関数をテストとして扱うことを知っています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could also have non-test functions in the <code>tests</code> module to help set up common scenarios or perform common operations, so we need to indicate which functions are tests by using the <code>#[test]</code> attribute.</span> <code>tests</code>モジュールには、共通のシナリオを設定したり、一般的な操作を実行するための非テスト機能もあるので、 <code>#[test]</code>属性を使用して、どの機能がテストであるかを示す必要があります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The function body uses the <code>assert_eq€</code> macro to assert that 2 + 2 equals 4. This assertion serves as an example of the format for a typical test.</span>関数本体は<code>assert_eq€</code>マクロを使用して、2 + 2が4に等しいことを宣言します。このアサーションは、典型的なテストの形式の例として機能します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s run it to see that this test passes.</span>このテストが合格することを確認するために実行してみましょう。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>cargo test</code> command runs all tests in our project, as shown in Listing 11-2.</span> <code>cargo test</code>コマンドは、リスト11-2に示すように、プロジェクト内のすべてのテストを実行します。</span> </p><br><div data-lang=text><div data-l="$ cargo test"></div><div data-l="   Compiling adder v0.1.0 (file:///projects/adder)"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.22 secs"></div><div data-l="     Running target/debug/deps/adder-ce99bcc2479f4607"></div><div data-l=""></div><div data-l="running 1 test"></div><div data-l="test tests::it_works ... ok"></div><div data-l=""></div><div data-l="test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div><div data-l=""></div><div data-l="   Doc-tests adder"></div><div data-l=""></div><div data-l="running 0 tests"></div><div data-l=""></div><div data-l="test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-2: The output from running the automatically generated test</span></span> <span class=caption>リスト11-2：自動的に生成されたテストを実行したときの出力</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Cargo compiled and ran the test.</span>貨物はコンパイルされ、テストが実行されました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">After the <code>Compiling</code> , <code>Finished</code> , and <code>Running</code> lines is the line <code>running 1 test</code> .</span> <code>Compiling</code> 、 <code>Finished</code> 、 <code>Running</code>行は、 <code>running 1 test</code>を<code>Running</code>行です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The next line shows the name of the generated test function, called <code>it_works</code> , and the result of running that test, <code>ok</code> .</span>次の行には、生成されたテスト関数の名前<code>it_works</code>とそのテストを実行した結果<code>ok</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The overall summary of running the tests appears next.</span>次に、テストの実行の概要が表示されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The text <code>test result: ok.</code></span>テキスト<code>test result: ok.</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">means that all the tests passed, and the portion that reads <code>1 passed; 0 failed</code></span>すべてのテストが合格したことを意味<code>1 passed; 0 failed</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>1 passed; 0 failed</code> totals the number of tests that passed or failed.</span> <code>1 passed; 0 failed</code> totalは、合格または不合格のテストの数を示します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because we don&#39;t have any tests we&#39;ve marked as ignored, the summary shows <code>0 ignored</code> .</span>無視されたテストはないため、サマリーには<code>0 ignored</code>た<code>0 ignored</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We also haven&#39;t filtered the tests being run, so the end of the summary shows <code>0 filtered out</code> .</span>また、実行されているテストをフィルタリングしていないため、要約の最後には<code>0 filtered out</code>た<code>0 filtered out</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll talk about ignoring and filtering out tests in the next section, “Controlling How Tests Are Run.”</span>テストの無視と除外については、次のセクション「テストの実行方法の制御」で説明します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>0 measured</code> statistic is for benchmark tests that measure performance.</span> <code>0 measured</code>統計値は、パフォーマンスを測定するベンチマークテストのものです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Benchmark tests are, as of this writing, only available in nightly Rust.</span>ベンチマークテストは、この記事の執筆時点で、夜間の錆だけで利用可能です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">See <a href=#3bench>the documentation about benchmark tests</a> to learn more.</span>詳細<a href=#3bench>は、ベンチマークテストに関するドキュメントを</a>参照してください。</span> </p><br> <a class=notranslate href=#1../../unstable-book/library-features/test.html>bench</a> <br> <p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The next part of the test output, which starts with <code>Doc-tests adder</code> , is for the results of any documentation tests.</span> <code>Doc-tests adder</code>で始まるテスト出力の次の部分は、ドキュメンテーションテストの結果です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We don&#39;t have any documentation tests yet, but Rust can compile any code examples that appear in our API documentation.</span>まだドキュメントテストはありませんが、RustはAPIドキュメントに記載されているコード例をコンパイルできます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This feature helps us keep our docs and our code in sync!</span>この機能は、ドキュメントとコードを同期させるのに役立ちます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll discuss how to write documentation tests in the “Documentation Comments as Tests” section of Chapter 14. For now, we&#39;ll ignore the <code>Doc-tests</code> output.</span>第14章の「ドキュメンテーションコメントをテストとして」の章でドキュメントテストを書く方法について説明します。今度は、 <code>Doc-tests</code>出力を無視します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s change the name of our test to see how that changes the test output.</span>テストの名前を変更してテスト出力をどのように変更するかを見てみましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Change the <code>it_works</code> function to a different name, such as <code>exploration</code> , like so:</span> <code>it_works</code>関数を<code>exploration</code>などの別の名前に変更します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    #[test]"></div><div data-l="    fn exploration() {"></div><div data-l="        assert_eq!(2 + 2, 4);"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then run <code>cargo test</code> again.</span>次に、再び<code>cargo test</code>実行します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The output now shows <code>exploration</code> instead of <code>it_works</code> :</span>出力に<code>it_works</code>代わりに<code>exploration</code>ように<code>it_works</code> ：</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::exploration ... ok"></div><div data-l=""></div><div data-l="test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s add another test, but this time we&#39;ll make a test that fails!</span>別のテストを追加しましょう。今回は失敗したテストを行います。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Tests fail when something in the test function panics.</span>テスト機能で何かがパニックすると、テストは失敗します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Each test is run in a new thread, and when the main thread sees that a test thread has died, the test is marked as failed.</span>各テストは新しいスレッドで実行され、メインスレッドがテストスレッドが終了したことがわかると、テストは失敗とマークされます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We talked about the simplest way to cause a panic in Chapter 9, which is to call the <code>panic€</code> macro.</span>私たちはパニックを引き起こす最も単純な方法について話しました。 <code>panic€</code>を呼び出すこと<code>panic€</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Enter the new test, <code>another</code> , so your <i>src/lib.rs</i> file looks like Listing 11-3.</span>新しいテストを<code>another</code>入力すると、 <i>src / lib.rs</i>ファイルはリスト11-3のように<i>なり</i>ます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    #[test]"></div><div data-l="    fn exploration() {"></div><div data-l="        assert_eq!(2 + 2, 4);"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn another() {"></div><div data-l="        panic!(&quot;Make this test fail&quot;);"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-3: Adding a second test that will fail because we call the <code>panic€</code> macro</span></span> <span class=caption>リスト11-3： <code>panic€</code>マクロを呼び出すために失敗する2番目のテストを追加する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Run the tests again using <code>cargo test</code> .</span> <code>cargo test</code>を使用してテストを再実行します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The output should look like Listing 11-4, which shows that our <code>exploration</code> test passed and <code>another</code> failed.</span>リスト11-4のような出力が表示されます。これは、 <code>exploration</code>テストが合格し、 <code>another</code>失敗したことを示しています。</span> </p><br><div data-lang=text><div data-l="running 2 tests"></div><div data-l="test tests::exploration ... ok"></div><div data-l="test tests::another ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l="---- tests::another stdout ----"></div><div data-l="    thread 'tests::another' panicked at 'Make this test fail', src/lib.rs:10:8"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div><div data-l=""></div><div data-l=failures:></div><div data-l="    tests::another"></div><div data-l=""></div><div data-l="test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out"></div><div data-l=""></div><div data-l="error: test failed"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-4: Test results when one test passes and one test fails</span></span> <span class=caption>コードリスト11-4：1つのテストが合格し、1つのテストが失敗した場合のテスト結果</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Instead of <code>ok</code> , the line <code>test tests::another</code> shows <code>FAILED</code> .</span> <code>ok</code>代わりに、回線<code>test tests::another</code>が<code>FAILED</code>示しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Two new sections appear between the individual results and the summary: the first section displays the detailed reason for each test failure.</span> 2つの新しいセクションが個々の結果とサマリーの間に表示されます。最初のセクションには、それぞれのテストの失敗の詳細な理由が表示されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In this case, <code>another</code> failed because it <code>panicked at &#39;Make this test fail&#39;</code> , which happened on line 10 in the <i>src/lib.rs</i> file.</span>この場合、 <i>src / lib.rs</i>ファイルの10行目で起こった<code>panicked at &#39;Make this test fail&#39;</code>で<code>panicked at &#39;Make this test fail&#39;</code>たため<code>another</code>失敗しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The next section lists just the names of all the failing tests, which is useful when there are lots of tests and lots of detailed failing test output.</span>次のセクションでは、失敗したすべてのテストの名前だけを示します。これは、たくさんのテストがあり、多くの詳細な失敗したテスト出力がある場合に便利です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can use the name of a failing test to run just that test to more easily debug it;</span>失敗したテストの名前を使用して、そのテストだけを実行してより簡単にデバッグすることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">we&#39;ll talk more about ways to run tests in the “Controlling How Tests Are Run” section.</span>テストを実行する方法の詳細については、「テストの実行方法の制御」のセクションで説明します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The summary line displays at the end: overall, our test result is <code>FAILED</code> .</span>終了時に要約行が表示されます。全体的に、テスト結果は<code>FAILED</code>です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We had one test pass and one test fail.</span> 1回のテストパスと1回のテストが失敗しました。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that you&#39;ve seen what the test results look like in different scenarios, let&#39;s look at some macros other than <code>panic€</code> that are useful in tests.</span>さまざまなシナリオでテスト結果がどのように見えるかを見てきましたので、テストで役立つ<code>panic€</code>以外のマクロを見てみましょう。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Checking Results with the <code>assert€</code> Macro</span> <code>assert€</code>マクロによる結果の確認</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>assert€</code> macro, provided by the standard library, is useful when you want to ensure that some condition in a test evaluates to <code>true</code> .</span>標準ライブラリによって提供される<code>assert€</code>マクロは、テスト中のある条件が<code>true</code>評価されることを確実にしたい場合に便利<code>true</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We give the <code>assert€</code> macro an argument that evaluates to a Boolean.</span>ブール値に評価する引数を<code>assert€</code>マクロに与えます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the value is <code>true</code> , <code>assert€</code> does nothing and the test passes.</span>値が<code>true</code>場合、 <code>assert€</code>は何もせず、テストに合格します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the value is <code>false</code> , the <code>assert€</code> macro calls the <code>panic€</code> macro, which causes the test to fail.</span>値が<code>false</code>場合、 <code>assert€</code>マクロは<code>panic€</code>呼び出すため、テストが失敗します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using the <code>assert€</code> macro helps us check that our code is functioning in the way we intend.</span> <code>assert€</code>マクロを使用する<code>assert€</code> 、私たちのコードが意図したとおりに機能していることを確認するのに役立ちます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Chapter 5, Listing 5-15, we used a <code>Rectangle</code> struct and a <code>can_hold</code> method, which are repeated here in Listing 11-5.</span>第5章のリスト5-15では、 <code>Rectangle</code>構造体と<code>can_hold</code>メソッドを使用しました。リスト11-5でこれを繰り返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s put this code in the <i>src/lib.rs</i> file and write some tests for it using the <code>assert€</code> macro.</span>このコードを<i>src / lib.rs</i>ファイルに<i>置き</i> 、 <code>assert€</code>マクロを使っていくつかのテストを書きましょう。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l=#[derive(Debug)]></div><div data-l="pub struct Rectangle {"></div><div data-l="    length: u32,"></div><div data-l="    width: u32,"></div><div data-l=}></div><div data-l=""></div><div data-l="impl Rectangle {"></div><div data-l="    pub fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {"></div><div data-l="        self.length &gt; other.length &amp;&amp; self.width &gt; other.width"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-5: Using the <code>Rectangle</code> struct and its <code>can_hold</code> method from Chapter 5</span></span> <span class=caption>リスト11-5： <code>Rectangle</code>構造体と第5章の<code>can_hold</code>メソッドの使用</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>can_hold</code> method returns a Boolean, which means it&#39;s a perfect use case for the <code>assert€</code> macro.</span> <code>can_hold</code>メソッドはブール値を返します。 <code>can_hold</code> 、 <code>assert€</code>マクロの完璧な使用例です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Listing 11-6, we write a test that exercises the <code>can_hold</code> method by creating a <code>Rectangle</code> instance that has a length of 8 and a width of 7 and asserting that it can hold another <code>Rectangle</code> instance that has a length of 5 and a width of 1.</span>リスト11-6において、我々は、行使テスト書き込み<code>can_hold</code>作成方法を<code>Rectangle</code> 8の長さと7の幅を有するインスタンスを、それが別の保持することができると主張<code>Rectangle</code> 5の長さと幅を有するインスタンスを1。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn larger_can_hold_smaller() {"></div><div data-l="        let larger = Rectangle { length: 8, width: 7 };"></div><div data-l="        let smaller = Rectangle { length: 5, width: 1 };"></div><div data-l=""></div><div data-l="        assert!(larger.can_hold(&amp;smaller));"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-6: A test for <code>can_hold</code> that checks whether a larger rectangle can indeed hold a smaller rectangle</span></span> <span class=caption>リスト11-6：大きな矩形が実際に小さな矩形を保持できるかどうかを調べる<code>can_hold</code>のテスト</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that we&#39;ve added a new line inside the <code>tests</code> module: <code>use super::*;</code></span> <code>tests</code>モジュールの中に新しい行を追加したことに注意してください： <code>use super::*;</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">.</span> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>tests</code> module is a regular module that follows the usual visibility rules we covered in Chapter 7 in the “Privacy Rules” section.</span> <code>tests</code>モジュールは、「プライバシールール」セクションの第7章で説明した通常の表示ルールに従う通常のモジュールです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because the <code>tests</code> module is an inner module, we need to bring the code under test in the outer module into the scope of the inner module.</span> <code>tests</code>モジュールは内部モジュールなので、外部モジュールのテスト対象コードを内部モジュールのスコープに持っていく必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We use a glob here so anything we define in the outer module is available to this <code>tests</code> module.</span>ここではグロブを使用しているので、外部モジュールで定義したものはすべてこの<code>tests</code>モジュールで使用できます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve named our test <code>larger_can_hold_smaller</code> , and we&#39;ve created the two <code>Rectangle</code> instances that we need.</span> <code>larger_can_hold_smaller</code>という名前のテストを作成し、必要な2つの<code>Rectangle</code>インスタンスを作成しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we called the <code>assert€</code> macro and passed it the result of calling <code>larger.can_hold(&amp;smaller)</code> .</span>次に<code>assert€</code>マクロを呼び出し、 <code>larger.can_hold(&amp;smaller)</code>を呼び出した結果を渡します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This expression is supposed to return <code>true</code> , so our test should pass.</span>この式は<code>true</code>を返すと想定されているので、テストは成功するはずです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s find out!</span>確認してみましょう！</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::larger_can_hold_smaller ... ok"></div><div data-l=""></div><div data-l="test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It does pass!</span>それは合格する！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s add another test, this time asserting that a smaller rectangle cannot hold a larger rectangle:</span>別のテストを追加してみましょう。今回は、小さな矩形で大きな矩形を保持できないと主張します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn larger_can_hold_smaller() {"></div><div data-l="#        // --snip--"></div><div data-l="        // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l="    }"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn smaller_cannot_hold_larger() {"></div><div data-l="        let larger = Rectangle { length: 8, width: 7 };"></div><div data-l="        let smaller = Rectangle { length: 5, width: 1 };"></div><div data-l=""></div><div data-l="        assert!(!smaller.can_hold(&amp;larger));"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because the correct result of the <code>can_hold</code> function in this case is <code>false</code> , we need to negate that result before we pass it to the <code>assert€</code> macro.</span>この場合の<code>can_hold</code>関数の正しい結果は<code>false</code>であるため、その結果を<code>assert€</code>マクロに渡す前にその結果を否定する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As a result, our test will pass if <code>can_hold</code> returns <code>false</code> :</span>その結果、 <code>can_hold</code>が<code>false</code>返す場合、テストは成功し<code>false</code> ：</span> </p><br><div data-lang=text><div data-l="running 2 tests"></div><div data-l="test tests::smaller_cannot_hold_larger ... ok"></div><div data-l="test tests::larger_can_hold_smaller ... ok"></div><div data-l=""></div><div data-l="test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Two tests that pass!</span> 2つのテストが合格！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now let&#39;s see what happens to our test results when we introduce a bug in our code.</span>次に、コードにバグを導入したときに、テスト結果に何が起こるかを見てみましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s change the implementation of the <code>can_hold</code> method by replacing the greater than sign with a less than sign when it compares the lengths:</span>長さを比較するときに大なり記号を小記号で置き換えることにより、 <code>can_hold</code>メソッドの実装を変更しましょう：</span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="# #[derive(Debug)]"></div><div data-l="# pub struct Rectangle {"></div><div data-l="#     length: u32,"></div><div data-l="#     width: u32,"></div><div data-l="# }"></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="impl Rectangle {"></div><div data-l="    pub fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool {"></div><div data-l="        self.length &lt; other.length &amp;&amp; self.width &gt; other.width"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Running the tests now produces the following:</span>テストを実行すると、以下が生成されます。</span> </p><br><div data-lang=text><div data-l="running 2 tests"></div><div data-l="test tests::smaller_cannot_hold_larger ... ok"></div><div data-l="test tests::larger_can_hold_smaller ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l="---- tests::larger_can_hold_smaller stdout ----"></div><div data-l="    thread 'tests::larger_can_hold_smaller' panicked at 'assertion failed:"></div><div data-l="    larger.can_hold(&amp;smaller)', src/lib.rs:22:8"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div><div data-l=""></div><div data-l=failures:></div><div data-l="    tests::larger_can_hold_smaller"></div><div data-l=""></div><div data-l="test result: FAILED. 1 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Our tests caught the bug!</span>私たちのテストではバグが見つかった！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because <code>larger.length</code> is 8 and <code>smaller.length</code> is 5, the comparison of the lengths in <code>can_hold</code> now returns <code>false</code> : 8 is not less than 5.</span> <code>larger.length</code>は8で<code>smaller.length</code>は5であるため、 <code>can_hold</code>の長さの比較は<code>false</code>返し<code>false</code> .8は5以上です。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Testing Equality with the <code>assert_eq€</code> and <code>assert_ne€</code> Macros</span> <code>assert_eq€</code>および<code>assert_ne€</code>マクロを使用した<code>assert_eq€</code>テスト</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A common way to test functionality is to compare the result of the code under test to the value you expect the code to return to make sure they&#39;re equal.</span>機能をテストする一般的な方法は、テスト中のコードの結果と、コードが一致することを期待する値とを比較することです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You could do this using the <code>assert€</code> macro and passing it an expression using the <code>==</code> operator.</span>これを行うには<code>assert€</code>マクロを使用し、 <code>==</code>演算子を使用して式を渡します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, this is such a common test that the standard library provides a pair of macros— <code>assert_eq€</code> and <code>assert_ne€</code> —to perform this test more conveniently.</span>しかし、これは、標準ライブラリがこのテストをより便利に実行するために<code>assert_eq€</code>と<code>assert_ne€</code> <code>assert_eq€</code>提供するような共通のテストです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">These macros compare two arguments for equality or inequality, respectively.</span>これらのマクロは、それぞれ平等または不等式の2つの引数を比較します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">They&#39;ll also print the two values if the assertion fails, which makes it easier to see <i>why</i> the test failed;</span>アサーションに失敗した場合は、2つの値も出力される<i>ため</i> 、テストが失敗した<i>理由を</i>簡単に確認できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">conversely, the <code>assert€</code> macro only indicates that it got a <code>false</code> value for the <code>==</code> expression, not the values that lead to the <code>false</code> value.</span>逆に、 <code>assert€</code>マクロは、それが持っていることを示し<code>false</code>の値を<code>==</code>表現ではなく、につながるの値<code>false</code>値。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Listing 11-7, we write a function named <code>add_two</code> that adds <code>2</code> to its parameter and returns the result.</span> <code>add_two</code>リスト11-7では<code>add_two</code>という名前の関数を書いて、そのパラメータに<code>2</code>を加えて結果を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we test this function using the <code>assert_eq€</code> macro.</span>次に、 <code>assert_eq€</code>マクロを使ってこの関数をテストします。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="pub fn add_two(a: i32) -&gt; i32 {"></div><div data-l="    a + 2"></div><div data-l=}></div><div data-l=""></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn it_adds_two() {"></div><div data-l="        assert_eq!(4, add_two(2));"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-7: Testing the function <code>add_two</code> using the <code>assert_eq€</code> macro</span></span> <span class=caption>リスト11-7：機能検査<code>add_two</code>使用して<code>assert_eq€</code>マクロを</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s check that it passes!</span>それが通過することをチェックしよう！</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::it_adds_two ... ok"></div><div data-l=""></div><div data-l="test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The first argument we gave to the <code>assert_eq€</code> macro, <code>4</code> , is equal to the result of calling <code>add_two(2)</code> .</span>我々が得た最初の引数<code>assert_eq€</code>マクロ<code>4</code> 、呼び出した結果に等しい<code>add_two(2)</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The line for this test is <code>test tests::it_adds_two ... ok</code> , and the <code>ok</code> text indicates that our test passed!</span>このテストのためのラインは、 <code>test tests::it_adds_two ... ok</code> 、および<code>ok</code>のテキストは、私たちのテストに合格していることを示しています！</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s introduce a bug into our code to see what it looks like when a test that uses <code>assert_eq€</code> fails.</span> <code>assert_eq€</code>を使ったテストが失敗したときの様子を見てみましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Change the implementation of the <code>add_two</code> function to instead add <code>3</code> :</span> <code>add_two</code>関数の実装を変更して、代わりに<code>3</code>を追加します。</span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="pub fn add_two(a: i32) -&gt; i32 {"></div><div data-l="    a + 3"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Run the tests again:</span>テストをもう一度実行します。</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::it_adds_two ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l="---- tests::it_adds_two stdout ----"></div><div data-l="        thread 'tests::it_adds_two' panicked at 'assertion failed: `(left == right)`"></div><div data-l="  left: `4`,"></div><div data-l=" right: `5`', src/lib.rs:11:8"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div><div data-l=""></div><div data-l=failures:></div><div data-l="    tests::it_adds_two"></div><div data-l=""></div><div data-l="test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Our test caught the bug!</span>私たちのテストではバグが見つかった！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>it_adds_two</code> test failed, displaying the message <code class=2>assertion failed: `(left == right)`</code> and showing that <code>left</code> was <code>4</code> and <code>right</code> was <code>5</code> .</span> <code>it_adds_two</code>テストが失敗し、メッセージ<code class=2>assertion failed: `(left == right)`</code>と表示され、 <code>left</code>が<code>4</code>で<code>right</code>が<code>5</code>あったこと<code>left</code>示されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This message is useful and helps us start debugging: it means the <code>left</code> argument to <code>assert_eq€</code> was <code>4</code> but the <code>right</code> argument, where we had <code>add_two(2)</code> , was <code>5</code> .</span>このメッセージは有用で、デバッグを開始するのに役立ちます。つまり、 <code>assert_eq€</code>の<code>left</code>引数は<code>4</code>でしたが、 <code>add_two(2)</code>があった<code>right</code>引数は<code>5</code>でした。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that in some languages and test frameworks, the parameters to the functions that assert two values are equal are called <code>expected</code> and <code>actual</code> , and the order in which we specify the arguments matters.</span>いくつかの言語とテストフレームワークでは、2つの値が同じであると宣言する関数のパラメータを<code>expected</code>値と<code>actual</code>と呼び、引数を指定する順序が重要であることに注意してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, in Rust, they&#39;re called <code>left</code> and <code>right</code> , and the order in which we specify the value we expect and the value that the code under test produces doesn&#39;t matter.</span>しかし、ルーストに、彼らは呼ばれている<code>left</code>と<code>right</code> 、そして我々は我々が期待値とテスト対象のコードは問題ではありません生成する値を指定する順序。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could write the assertion in this test as <code>assert_eq€(add_two(2), 4)</code> , which would result in a failure message that displays <code class=2>assertion failed: `(left == right)`</code> and that <code>left</code> was <code>5</code> and <code>right</code> was <code>4</code> .</span>このテストでアサーションを<code>assert_eq€(add_two(2), 4)</code>として書くと、アサーションが失敗したというエラーメッセージが表示されます<code class=2>assertion failed: `(left == right)`</code> 、 <code>left</code>は<code>5</code> 、 <code>right</code>は<code>4</code>でした。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>assert_ne€</code> macro will pass if the two values we give it are not equal and fail if they&#39;re equal.</span> <code>assert_ne€</code>マクロは、与えられた2つの値が等しくない場合に合格し、等しい場合に失敗します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This macro is most useful for cases when we&#39;re not sure what a value <i>will</i> be, but we know what the value definitely <i>won&#39;t</i> be if our code is functioning as we intend.</span>このマクロは、値<i>が</i>どのようなものかわからない場合に最も便利ですが、意図したとおりにコードが機能している場合<i>は</i> 、値がどう<i>なる</i>かはわかります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, if we&#39;re testing a function that is guaranteed to change its input in some way, but the way in which the input is changed depends on the day of the week that we run our tests, the best thing to assert might be that the output of the function is not equal to the input.</span>たとえば、何らかの方法で入力を変更することが保証されている関数をテストする場合、入力を変更する方法はテストを実行する曜日によって異なりますが、関数の出力が入力と等しくないことを示します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Under the surface, the <code>assert_eq€</code> and <code>assert_ne€</code> macros use the operators <code>==</code> and <code>€=</code> , respectively.</span>表面の下では、 <code>assert_eq€</code>および<code>assert_ne€</code>マクロはそれぞれ演算子<code>==</code>および<code>€=</code>を使用します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When the assertions fail, these macros print their arguments using debug formatting, which means the values being compared must implement the <code>PartialEq</code> and <code>Debug</code> traits.</span>アサーションが失敗した場合、これらのマクロは引数を出力します。これは、比較される値が<code>PartialEq</code>と<code>Debug</code>特性を実装しなければならないことを意味します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">All the primitive types and most of the standard library types implement these traits.</span>すべてのプリミティブ型とほとんどの標準ライブラリ型は、これらの特性を実装しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For structs and enums that you define, you&#39;ll need to implement <code>PartialEq</code> to assert that values of those types are equal or not equal.</span>定義した構造体と列挙体では、 <code>PartialEq</code>を実装して、それらの型の値が等しいかどうかを<code>PartialEq</code>する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You&#39;ll need to implement <code>Debug</code> to print the values when the assertion fails.</span>アサーションが失敗したときに値を出力するには、 <code>Debug</code>を実装する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because both traits are derivable traits, as mentioned in Listing 5-12 in Chapter 5, this is usually as straightforward as adding the <code>#[derive(PartialEq, Debug)]</code> annotation to your struct or enum definition.</span>第5章のリスト5-12で説明したように、両方の形質が導出可能な特性であるため、 <code>#[derive(PartialEq, Debug)]</code>アノテーションを構造体または列挙型の定義に追加するのと<code>#[derive(PartialEq, Debug)]</code>です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">See Appendix C for more details about these and other derivable traits.</span>これらおよび他の導出可能な形質の詳細については、付録Cを参照してください。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Adding Custom Failure Messages</span>カスタムエラーメッセージの追加</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You can also add a custom message to be printed with the failure message as optional arguments to the <code>assert€</code> , <code>assert_eq€</code> , and <code>assert_ne€</code> macros.</span> <code>assert€</code> 、 <code>assert_eq€</code> 、および<code>assert_ne€</code>マクロへのオプションの引数として、失敗メッセージとともに出力されるカスタムメッセージを追加することもできます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Any arguments specified after the one required argument to <code>assert€</code> or the two required arguments to <code>assert_eq€</code> and <code>assert_ne€</code> are passed along to the <code>format€</code> macro (discussed in Chapter 8 in the “Concatenation with the <code>+</code> Operator or the <code>format€</code> Macro” section), so you can pass a format string that contains <code>{}</code> placeholders and values to go in those placeholders.</span> <code>assert€</code>または<code>assert_eq€</code>と<code>assert_ne€</code>必要な2つの引数を<code>assert_eq€</code>マクロに渡し<code>format€</code> （第8章の「 <code>+</code>演算子または<code>format€</code>マクロの連結」の章で説明してい<code>format€</code> ）、あなたが含まれているフォーマット文字列渡すことができますので、 <code>{}</code>これらのプレースホルダに行くためのプレースホルダと値を。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Custom messages are useful to document what an assertion means;</span>カスタムメッセージは、アサーションが意味するものを文書化するのに便利です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">when a test fails, you&#39;ll have a better idea of what the problem is with the code.</span>テストが失敗した場合は、コードの問題の詳細を知ることができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, let&#39;s say we have a function that greets people by name and we want to test that the name we pass into the function appears in the output:</span>たとえば、名前で人を迎える関数があり、関数に渡す名前が出力に現れることをテストしたいとしましょう：</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="pub fn greeting(name: &amp;str) -&gt; String {"></div><div data-l="    format!(&quot;Hello {}!&quot;, name)"></div><div data-l=}></div><div data-l=""></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn greeting_contains_name() {"></div><div data-l="        let result = greeting(&quot;Carol&quot;);"></div><div data-l="        assert!(result.contains(&quot;Carol&quot;));"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The requirements for this program haven&#39;t been agreed upon yet, and we&#39;re pretty sure the <code>Hello</code> text at the beginning of the greeting will change.</span>このプログラムの要件はまだ合意されていません。挨拶の開始時の<code>Hello</code>テキストが変更されることは間違いありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We decided we don&#39;t want to have to update the test when the requirements change, so instead of checking for exact equality to the value returned from the <code>greeting</code> function, we&#39;ll just assert that the output contains the text of the input parameter.</span>要件が変更されたときにテストを更新する必要がないと判断したので、 <code>greeting</code>関数から返された値と完全に等しいかどうかを調べる代わりに、出力に入力パラメータのテキストが含まれていると主張します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s introduce a bug into this code by changing <code>greeting</code> to not include <code>name</code> to see what this test failure looks like:</span> <code>greeting</code>に<code>name</code>を<code>name</code>ないように<code>name</code>して、このテストの失敗の内容を確認して、このコードにバグを導入しましょう。</span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="pub fn greeting(name: &amp;str) -&gt; String {"></div><div data-l="    String::from(&quot;Hello!&quot;)"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Running this test produces the following:</span>このテストを実行すると、以下が生成されます。</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::greeting_contains_name ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l="---- tests::greeting_contains_name stdout ----"></div><div data-l="        thread 'tests::greeting_contains_name' panicked at 'assertion failed:"></div><div data-l="result.contains(&quot;Carol&quot;)', src/lib.rs:12:8"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div><div data-l=""></div><div data-l=failures:></div><div data-l="    tests::greeting_contains_name"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This result just indicates that the assertion failed and which line the assertion is on.</span>この結果は、アサーションが失敗し、アサーションがどのラインにあるかを示します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A more useful failure message in this case would print the value we got from the <code>greeting</code> function.</span>この場合、より有用な失敗メッセージは、 <code>greeting</code>関数から得た値を出力します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s change the test function, giving it a custom failure message made from a format string with a placeholder filled in with the actual value we got from the <code>greeting</code> function:</span>テスト関数を変更し、 <code>greeting</code>関数から得られた実際の値で埋められたプレースホルダを持つ書式文字列から作成されたカスタムエラーメッセージを与えましょう：</span> </p><br><div data-lang=rust,ignore><div data-l=#[test]></div><div data-l="fn greeting_contains_name() {"></div><div data-l="    let result = greeting(&quot;Carol&quot;);"></div><div data-l="    assert!("></div><div data-l="        result.contains(&quot;Carol&quot;),"></div><div data-l="        &quot;Greeting did not contain name, value was `{}`&quot;, result"></div><div data-l="    );"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now when we run the test, we&#39;ll get a more informative error message:</span>テストを実行すると、より有益なエラーメッセージが表示されます。</span> </p><br><div data-lang=text><div data-l="---- tests::greeting_contains_name stdout ----"></div><div data-l="        thread 'tests::greeting_contains_name' panicked at 'Greeting did not"></div><div data-l="contain name, value was `Hello!`', src/lib.rs:12:8"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can see the value we actually got in the test output, which would help us debug what happened instead of what we were expecting to happen.</span>実際にテスト結果に表示された値がわかります。これは、発生すると予想されるものではなく、発生したことをデバッグするのに役立ちます。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Checking for Panics with <code>should_panic</code></span> <code>should_panic</code>でパニックをチェックする</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In addition to checking that our code returns the correct values we expect, it&#39;s also important to check that our code handles error conditions as we expect.</span>私たちのコードが期待する正しい値を返すことを確認することに加えて、われわれのコードが予期したとおりにエラー条件を処理することを確認することも重要です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, consider the <code>Guess</code> type that we created in Chapter 9, Listing 9-9.</span>たとえば、第9章のリスト9-9で作成した<code>Guess</code>型を考えてみましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Other code that uses <code>Guess</code> depends on the guarantee that <code>Guess</code> instances will contain only values between 1 and 100. We can write a test that ensures that attempting to create a <code>Guess</code> instance with a value outside that range panics.</span> <code>Guess</code>を使用する他のコードは、 <code>Guess</code>インスタンスに<code>Guess</code>値しか含まれないという保証に依存します。その範囲外の値を持つ<code>Guess</code>インスタンスを作成しようとするテストを確実に行うことができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We do this by adding another attribute, <code>should_panic</code> , to our test function.</span>これを行うには、テスト関数に<code>should_panic</code>別の属性を追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This attribute makes a test pass if the code inside the function panics;</span>この属性は、関数内のコードがパニックになった場合にテストに合格します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">the test will fail if the code inside the function doesn&#39;t panic.</span>関数内のコードがパニックに陥らなければ、テストは失敗します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 11-8 shows a test that checks that the error conditions of <code>Guess::new</code> happen when we expect them to.</span>リスト11-8は、期待通りに<code>Guess::new</code>エラー状態が発生したことをチェックするテストを示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="pub struct Guess {"></div><div data-l="    value: u32,"></div><div data-l=}></div><div data-l=""></div><div data-l="impl Guess {"></div><div data-l="    pub fn new(value: u32) -&gt; Guess {"></div><div data-l="        if value &lt; 1 || value &gt; 100 {"></div><div data-l="            panic!(&quot;Guess value must be between 1 and 100, got {}.&quot;, value);"></div><div data-l="        }"></div><div data-l=""></div><div data-l="        Guess {"></div><div data-l="            value"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l=}></div><div data-l=""></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    #[should_panic]"></div><div data-l="    fn greater_than_100() {"></div><div data-l="        Guess::new(200);"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-8: Testing that a condition will cause a <code>panic€</code></span></span> <span class=caption>リスト11-8：条件が<code>panic€</code>を引き起こすかどうかのテスト</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We place the <code>#[should_panic]</code> attribute after the <code>#[test]</code> attribute and before the test function it applies to.</span>私たちは、置く<code>#[should_panic]</code>の後に属性を<code>#[test]</code>属性と、それが適用されるテスト関数の前に。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s look at the result when this test passes:</span>このテストに合格したときの結果を見てみましょう：</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::greater_than_100 ... ok"></div><div data-l=""></div><div data-l="test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Looks good!</span>いいね！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now let&#39;s introduce a bug in our code by removing the condition that the <code>new</code> function will panic if the value is greater than 100:</span>次に、値が100より大きい場合、 <code>new</code>関数がパニックになるという条件を削除して、コード内にバグを導入しましょう：</span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="# pub struct Guess {"></div><div data-l="#     value: u32,"></div><div data-l="# }"></div><div data-l=#></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="impl Guess {"></div><div data-l="    pub fn new(value: u32) -&gt; Guess {"></div><div data-l="        if value &lt; 1  {"></div><div data-l="            panic!(&quot;Guess value must be between 1 and 100, got {}.&quot;, value);"></div><div data-l="        }"></div><div data-l=""></div><div data-l="        Guess {"></div><div data-l="            value"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When we run the test in Listing 11-8, it will fail:</span>リスト11-8のテストを実行すると失敗します：</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::greater_than_100 ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l=failures:></div><div data-l="    tests::greater_than_100"></div><div data-l=""></div><div data-l="test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We don&#39;t get a very helpful message in this case, but when we look at the test function, we see that it&#39;s annotated with <code>#[should_panic]</code> .</span>この場合、非常に役立つメッセージはありませんが、テスト関数を見ると<code>#[should_panic]</code>注釈が付いています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The failure we got means that the code in the test function did not cause a panic.</span>テスト機能のコードがパニックを引き起こさなかったことを意味します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Tests that use <code>should_panic</code> can be imprecise because they only indicate that the code has caused some panic.</span> <code>should_panic</code>を使用するテストは、コードがいくつかのパニックを引き起こしたことだけを示しているため、不正確になる可能性があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A <code>should_panic</code> test would pass even if the test panics for a different reason than the one we were expecting to happen.</span>たとえ私たちが期待していたのとは異なる理由でテストがパニックになっても、 <code>should_panic</code>テストは合格となります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To make <code>should_panic</code> tests more precise, we can add an optional <code>expected</code> parameter to the <code>should_panic</code> attribute.</span>作るために<code>should_panic</code>テストをより正確に、我々はオプションを追加することができ<code>expected</code>にパラメータを<code>should_panic</code>属性。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The test harness will make sure that the failure message contains the provided text.</span>テストハーネスは、失敗メッセージに指定されたテキストが含まれていることを確認します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, consider the modified code for <code>Guess</code> in Listing 11-9 where the <code>new</code> function panics with different messages depending on whether the value is too small or too large.</span>たとえば、リスト11-9の<code>Guess</code>の変更されたコードでは、値が小さすぎるか大きすぎるかに応じて異なるメッセージで<code>new</code>関数がパニックする場合があります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn main() {}"></div><div data-l="# pub struct Guess {"></div><div data-l="#     value: u32,"></div><div data-l="# }"></div><div data-l=#></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="impl Guess {"></div><div data-l="    pub fn new(value: u32) -&gt; Guess {"></div><div data-l="        if value &lt; 1 {"></div><div data-l="            panic!(&quot;Guess value must be greater than or equal to 1, got {}.&quot;,"></div><div data-l="                   value);"></div><div data-l="        } else if value &gt; 100 {"></div><div data-l="            panic!(&quot;Guess value must be less than or equal to 100, got {}.&quot;,"></div><div data-l="                   value);"></div><div data-l="        }"></div><div data-l=""></div><div data-l="        Guess {"></div><div data-l="            value"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l=}></div><div data-l=""></div><div data-l=#[cfg(test)]></div><div data-l="mod tests {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    #[should_panic(expected = &quot;Guess value must be less than or equal to 100&quot;)]"></div><div data-l="    fn greater_than_100() {"></div><div data-l="        Guess::new(200);"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 11-9: Testing that a condition will cause a <code>panic€</code> with a particular panic message</span></span> <span class=caption>リスト11-9：条件が特定のパニックメッセージを含む<code>panic€</code>を引き起こすかどうかのテスト</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This test will pass because the value we put in the <code>should_panic</code> attribute&#39;s <code>expected</code> parameter is a substring of the message that the <code>Guess::new</code> function panics with.</span>このテストは、 <code>should_panic</code>属性の<code>expected</code>パラメータに入れた値が、 <code>Guess::new</code>関数がパニックするメッセージの部分文字列であるため、合格します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could have specified the entire panic message that we expect, which in this case would be <code>Guess value must be less than or equal to 100, got 200.</code> What you choose to specify in the expected parameter for <code>should_panic</code> depends on how much of the panic message is unique or dynamic and how precise you want your test to be.</span>この場合、 <code>Guess value must be less than or equal to 100, got 200.</code>パニックメッセージ全体を指定することができました<code>should_panic</code>の期待されるパラメータで指定するものは、どのくらいのパニックメッセージはユニークでダイナミックであり、テストがどれほど正確であるかは正確です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In this case, a substring of the panic message is enough to ensure that the code in the test function executes the <code>else if value &gt; 100</code> case.</span>この場合、パニックメッセージの部分文字列は、テスト関数内のコードが<code>else if value &gt; 100</code>場合に<code>else if value &gt; 100</code>実行するのに十分<code>else if value &gt; 100</code> 。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To see what happens when a <code>should_panic</code> test with an <code>expected</code> message fails, let&#39;s again introduce a bug into our code by swapping the bodies of the <code>if value &lt; 1</code> and the <code>else if value &gt; 100</code> blocks:</span> <code>expected</code>メッセージで<code>should_panic</code>テストが失敗したときに何が起こるかを見るには、 <code>if value &lt; 1</code>ボディと<code>else if value &gt; 100</code>ブロックのボディを入れ替えて、コードにバグを導入してみましょう。</span> </p><br><div data-lang=rust,ignore><div data-l="if value &lt; 1 {"></div><div data-l="    panic!(&quot;Guess value must be less than or equal to 100, got {}.&quot;, value);"></div><div data-l="} else if value &gt; 100 {"></div><div data-l="    panic!(&quot;Guess value must be greater than or equal to 1, got {}.&quot;, value);"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This time when we run the <code>should_panic</code> test, it will fail:</span>今回は<code>should_panic</code>テストを実行すると失敗します：</span> </p><br><div data-lang=text><div data-l="running 1 test"></div><div data-l="test tests::greater_than_100 ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l="---- tests::greater_than_100 stdout ----"></div><div data-l="        thread 'tests::greater_than_100' panicked at 'Guess value must be"></div><div data-l="greater than or equal to 1, got 200.', src/lib.rs:11:12"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div><div data-l="note: Panic did not include expected string 'Guess value must be less than or"></div><div data-l="equal to 100'"></div><div data-l=""></div><div data-l=failures:></div><div data-l="    tests::greater_than_100"></div><div data-l=""></div><div data-l="test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The failure message indicates that this test did indeed panic as we expected, but the panic message did not include the expected string <code>&#39;Guess value must be less than or equal to 100&#39;</code> .</span>失敗メッセージは、このテストが期待通りにパニックになったことを示していますが、パニックメッセージに<code>&#39;Guess value must be less than or equal to 100&#39;</code>予想される文字列は含まれていませんでした。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The panic message that we did get in this case was <code>Guess value must be greater than or equal to 1, got 200.</code> Now we can start figuring out where our bug is!</span>このケースで私たちが得たパニックメッセージは、 <code>Guess value must be greater than or equal to 1, got 200.</code>でした。今、私たちのバグがどこにあるかを知ることができます！</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that you know several ways to write tests, let&#39;s look at what is happening when we run our tests and explore the different options we can use with <code>cargo test</code> .</span>テストを書くためのいくつかの方法を知ったので、私たちがテストを実行し、 <code>cargo test</code>使用できるさまざまなオプションを調べるときに何が起こっているかを見てみましょう。</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch11-01-writing-tests.html');});</script>