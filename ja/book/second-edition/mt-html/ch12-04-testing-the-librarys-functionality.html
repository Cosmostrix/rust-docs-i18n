<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch12-04-testing-the-librarys-functionality.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Developing the Library&#39;s Functionality with Test-Driven Development</span>テスト駆動開発による図書館の機能開発</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that we&#39;ve extracted the logic into <i>src/lib.rs</i> and left the argument collecting and error handling in <i>src/main.rs</i> , it&#39;s much easier to write tests for the core functionality of our code.</span> <i>src / lib.rsに</i>ロジックを抽出し、 <i>src / main.rs</i>に引数の収集とエラー処理を残した<i>ので</i> 、コードのコア機能のテストを書く方がずっと簡単です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can call functions directly with various arguments and check return values without having to call our binary from the command line.</span>コマンドラインからバイナリを呼び出すことなく、さまざまな引数を使って関数を直接呼び出すことができ、戻り値をチェックすることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Feel free to write some tests for the functionality in the <code>Config::new</code> and <code>run</code> functions on your own.</span> <code>Config::new</code>機能のいくつかのテストを自由に作成し、自分で<code>run</code>ことができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In this section, we&#39;ll add the searching logic to the <code>minigrep</code> program by using the Test-driven development (TDD) process.</span>このセクションでは、テストドリブン開発（TDD）プロセスを使用して検索ロジックを<code>minigrep</code>プログラムに追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This software development technique follows these steps:</span>このソフトウェア開発テクニックは、次の手順に従います。</span> </p><br><div data-b=1.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Write a test that fails and run it to make sure it fails for the reason you expect.</span>失敗したテストを作成して実行し、期待どおりに失敗したかどうかを確認します。</span> </div><div data-b=2.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Write or modify just enough code to make the new test pass.</span>新しいテストパスを作成するのに十分なコードを書いたり修正したりしてください。</span> </div><div data-b=3.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Refactor the code you just added or changed and make sure the tests continue to pass.</span>ちょうど追加または変更したコードをリファクタリングし、テストが合格したことを確認してください。</span> </div><div data-b=4.> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Repeat from step 1!</span>ステップ1から繰り返してください！</span> </div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This process is just one of many ways to write software, but TDD can help drive code design as well.</span>このプロセスは、ソフトウェアを書く多くの方法の1つに過ぎませんが、TDDはコードデザインの推進にも役立ちます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Writing the test before you write the code that makes the test pass helps to maintain high test coverage throughout the process.</span>テストをパスするコードを書く前にテストを書くことは、プロセス全体を通して高いテストカバレッジを維持するのに役立ちます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll test drive the implementation of the functionality that will actually do the searching for the query string in the file contents and produce a list of lines that match the query.</span>ファイル内容のクエリ文字列を実際に検索する機能の実装をテストし、クエリに一致する行のリストを生成します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll add this functionality in a function called <code>search</code> .</span>この機能を<code>search</code>という関数に追加し<code>search</code> 。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Writing a Failing Test</span>失敗したテストの作成</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because we don&#39;t need them anymore, let&#39;s remove the <code>println€</code> statements from <i>src/lib.rs</i> and <i>src/main.rs</i> that we used to check the program&#39;s behavior.</span>これ以上必要ないので、プログラムの動作を確認するために使用した<i>src / lib.rs</i>と<i>src / main.rs</i>から<code>println€</code>ステートメントを削除しましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then, in <i>src/lib.rs</i> , we&#39;ll add a <code>test</code> module with a test function, as we did in Chapter 11. The test function specifies the behavior we want the <code>search</code> function to have: it will take a query and the text to search for the query in, and it will return only the lines from the text that contain the query.</span>次に、 <i>src / lib.rsに</i> 、第11章で行ったように、テスト関数を含む<code>test</code>モジュールを追加します。テスト関数は、 <code>search</code>関数に必要な動作を指定します。これは、クエリとテキストを検索すると、クエリを含むテキストの行だけが返されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-15 shows this test, which won&#39;t compile yet.</span>リスト12-15はこのテストを示していますが、まだコンパイルされません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="#      vec![]"></div><div data-l="# }"></div><div data-l=#></div><div data-l=#[cfg(test)]></div><div data-l="mod test {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn one_result() {"></div><div data-l="        let query = &quot;duct&quot;;"></div><div data-l="        let contents = &quot;\"></div><div data-l=Rust:></div><div data-l="safe, fast, productive."></div><div data-l="Pick three.&quot;;"></div><div data-l=""></div><div data-l="        assert_eq!("></div><div data-l="            vec![&quot;safe, fast, productive.&quot;],"></div><div data-l="            search(query, contents)"></div><div data-l="        );"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-15: Creating a failing test for the <code>search</code> function we wish we had</span></span> <span class=caption>リスト12-15：私たちが持っていたしたい<code>search</code>機能のための失敗テストの作成</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This test searches for the string <code>&quot;duct&quot;</code> .</span>このテストは文字列<code>&quot;duct&quot;</code>検索します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The text we&#39;re searching is three lines, only one of which contains <code>&quot;duct&quot;</code> .</span>私たちが探しているテキストは3行で、そのうちの1つだけが<code>&quot;duct&quot;</code>を含んでいます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We assert that the value returned from the <code>search</code> function contains only the line we expect.</span> <code>search</code>関数から返される値には、期待される行のみが含まれていると主張します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We aren&#39;t able to run this test and watch it fail because the test doesn&#39;t even compile: the <code>search</code> function doesn&#39;t exist yet!</span>このテストを実行することはできません。テストはコンパイルされていないため、失敗します。 <code>search</code>機能はまだ存在しません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">So now we&#39;ll add just enough code to get the test to compile and run by adding a definition of the <code>search</code> function that always returns an empty vector, as shown in Listing 12-16.</span>そこで、リスト12-16に示すように、空のベクトルを常に返す<code>search</code>関数の定義を追加して、テストをコンパイルして実行するのに十分なコードを追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then the test should compile and fail because an empty vector doesn&#39;t match a vector containing the line <code>&quot;safe, fast, productive.&quot;</code></span>空のベクトルが<code>&quot;safe, fast, productive.&quot;</code>という行を含むベクトルと一致しないため、テストはコンパイルして失敗するはず<code>&quot;safe, fast, productive.&quot;</code></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    vec![]"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-16: Defining just enough of the <code>search</code> function so our test will compile</span></span> <span class=caption>リスト12-16：テストをコンパイルするための<code>search</code>関数を十分に定義する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Notice that we need an explicit lifetime <code>&#39;a</code> defined in the signature of <code>search</code> and used with the <code>contents</code> argument and the return value.</span> <code>search</code>のシグネチャで定義され、 <code>contents</code>引数と戻り値とともに使用される明示的な有効期間<code>&#39;a</code>が必要であることに注目してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Recall in Chapter 10 that the lifetime parameters specify which argument lifetime is connected to the lifetime of the return value.</span>第10章では、ライフタイムパラメータは、どの引数のライフタイムが戻り値の存続時間に接続されるかを指定していることを思い出してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In this case, we indicate that the returned vector should contain string slices that reference slices of the argument <code>contents</code> (rather than the argument <code>query</code> ).</span>この場合、返されたベクトルには、（引数<code>query</code>ではなく）引数の<code>contents</code>スライスを参照する文字列スライスが含まれている必要があることを示し<code>query</code> 。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In other words, we tell Rust that the data returned by the <code>search</code> function will live as long as the data passed into the <code>search</code> function in the <code>contents</code> argument.</span>言い換えれば、 <code>search</code>関数によって返されるデータは、データが<code>contents</code>引数の<code>search</code>関数に渡される限り存続することをRustに伝えます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This is important!</span>これは重要！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The data referenced <i>by</i> a slice needs to be valid for the reference to be valid;</span>スライス<i>によって</i>参照<i>される</i>データは、参照を有効にするために有効である必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">if the compiler assumes we&#39;re making string slices of <code>query</code> rather than <code>contents</code> , it will do its safety checking incorrectly.</span>コンパイラが<code>contents</code>ではなく<code>query</code>文字列スライスを作成していると仮定すると、安全性のチェックが正しく行われません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If we forget the lifetime annotations and try to compile this function, we&#39;ll get this error:</span>生涯の注釈を忘れてこの関数をコンパイルしようとすると、このエラーが発生します：</span> </p><br><div data-lang=text><div data-l="error[E0106]: missing lifetime specifier"></div><div data-l=" --&gt; src/lib.rs:5:51"></div><div data-l="  |"></div><div data-l="5 | pub fn search(query: &amp;str, contents: &amp;str) -&gt; Vec&lt;&amp;str&gt; {"></div><div data-l="  |                                                   ^ expected lifetime"></div><div data-l=parameter></div><div data-l="  |"></div><div data-l="  = help: this function's return type contains a borrowed value, but the"></div><div data-l="  signature does not say whether it is borrowed from `query` or `contents`"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rust can&#39;t possibly know which of the two arguments we need, so we need to tell it.</span>錆はおそらく我々が必要とする二つの議論のどれを知ることができないので、それを伝える必要がある。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because <code>contents</code> is the argument that contains all of our text and we want to return the parts of that text that match, we know <code>contents</code> is the argument that should be connected to the return value using the lifetime syntax.</span> <code>contents</code>はすべてのテキストを含む引数であり、一致するテキスト部分を返したいので、 <code>contents</code>は生涯構文を使用して戻り値に接続する必要がある引数です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Other programming languages don&#39;t require you to connect arguments to return values in the signature.</span>他のプログラミング言語では、シグネチャの戻り値に引数を接続する必要はありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Although this might seem strange, it will get easier over time.</span>これは奇妙に思えるかもしれませんが、時間の経過とともに容易になります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You might want to compare this example with the “Validating References with Lifetimes” section in Chapter 10.</span>この例を第10章の「有効期間と参照の検証」の項と比較するとよいでしょう。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now let&#39;s run the test:</span>今度はテストを実行しましょう：</span> </p><br><div data-lang=text><div data-l="$ cargo test"></div><div data-l="   Compiling minigrep v0.1.0 (file:///projects/minigrep)"></div><div data-l=--warnings--></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.43 secs"></div><div data-l="     Running target/debug/deps/minigrep-abcabcabc"></div><div data-l=""></div><div data-l="running 1 test"></div><div data-l="test test::one_result ... FAILED"></div><div data-l=""></div><div data-l=failures:></div><div data-l=""></div><div data-l="---- test::one_result stdout ----"></div><div data-l="        thread 'test::one_result' panicked at 'assertion failed: `(left =="></div><div data-l="right)`"></div><div data-l="left: `[&quot;safe, fast, productive.&quot;]`,"></div><div data-l="right: `[]`)', src/lib.rs:48:8"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div><div data-l=""></div><div data-l=""></div><div data-l=failures:></div><div data-l="    test::one_result"></div><div data-l=""></div><div data-l="test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out"></div><div data-l=""></div><div data-l="error: test failed, to rerun pass '--lib'"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Great, the test fails, exactly as we expected.</span>うーん、期待通りにテストが失敗します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s get the test to pass!</span>テストをパスしましょう！</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Writing Code to Pass the Test</span>テストに合格するコードを書く</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Currently, our test is failing because we always return an empty vector.</span>現在、私たちは常に空のベクトルを返すので、私たちのテストは失敗しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To fix that and implement <code>search</code> , our program needs to follow these steps:</span>それを修正して<code>search</code>を実装<code>search</code>は、プログラムで次の手順を実行する必要があります。</span> </p><br><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Iterate through each line of the contents.</span>内容の各行を繰り返します。</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Check whether the line contains our query string.</span>行にクエリ文字列が含まれているかどうかを確認します。</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If it does, add it to the list of values we&#39;re returning.</span>そうであれば、返す値のリストに追加します。</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If it doesn&#39;t, do nothing.</span>そうでない場合は、何もしないでください。</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Return the list of results that match.</span>一致する結果のリストを返します。</span> </div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s work through each step, starting with iterating through lines.</span>各ステップを繰り返し、最初から最後まで繰り返してみましょう。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Iterating Through Lines with the <code>lines</code> Method</span> <code>lines</code>メソッドを使用して<code>lines</code>繰り返す</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rust has a helpful method to handle line-by-line iteration of strings, conveniently named <code>lines</code> , that works as shown in Listing 12-17.</span> Rustは、リスト12-17に示すように、便利な名前の<code>lines</code>である行単位の文字列の繰り返し処理に役立つメソッドを持っています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note this won&#39;t compile yet.</span>これはまだコンパイルされないことに注意してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    for line in contents.lines() {"></div><div data-l="#        // do something with line"></div><div data-l="        // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">do something with line</span>ラインで何かする</span> </div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-17: Iterating through each line in <code>contents</code></span></span> <span class=caption>リスト12-17： <code>contents</code>各行を繰り返す</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>lines</code> method returns an iterator.</span> <code>lines</code>メソッドはイテレータを返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll talk about iterators in depth in Chapter 13, but recall that you saw this way of using an iterator in Listing 3-5, where we used a <code>for</code> loop with an iterator to run some code on each item in a collection.</span>第13章でイテレータについて詳しく説明しますが、リスト3-5のイテレータを使用するこの方法では、イテレータを使用して<code>for</code>ループを使用して、コレクションの各アイテムに対していくつかのコードを実行しました。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Searching Each Line for the Query</span>各行のクエリの検索</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Next, we&#39;ll check whether the current line contains our query string.</span>次に、現在の行にクエリ文字列が含まれているかどうかを確認します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Fortunately, strings have a helpful method named <code>contains</code> that does this for us!</span>幸いにも、文字列には<code>contains</code>という名前の便利なメソッドがあり、これは私たちのためにこれを行います！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Add a call to the <code>contains</code> method in the <code>search</code> function, as shown in Listing 12-18.</span>リスト12-18に示すように、 <code>search</code>関数の<code>contains</code>メソッドへの呼び出しを追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note this still won&#39;t compile yet.</span>これはまだコンパイルされないことに注意してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    for line in contents.lines() {"></div><div data-l="        if line.contains(query) {"></div><div data-l="#            // do something with line"></div><div data-l="            // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">do something with line</span>ラインで何かする</span> </div><div data-l="        }"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-18: Adding functionality to see whether the line contains the string in <code>query</code></span></span> <span class=caption>コードリスト12-18： <code>query</code>文字列が含まれているかどうかを調べる機能を追加する</span></span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Storing Matching Lines</span>マッチングラインの保存</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We also need a way to store the lines that contain our query string.</span>また、クエリ文字列を含む行を格納する方法も必要です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For that, we can make a mutable vector before the <code>for</code> loop and call the <code>push</code> method to store a <code>line</code> in the vector.</span>そのためには、 <code>for</code>ループの前に変更可能なベクトルを作成し、 <code>push</code>メソッドを呼び出してベクトルに<code>line</code>を格納することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">After the <code>for</code> loop, we return the vector, as shown in Listing 12-19.</span> <code>for</code>ループの後に、リスト12-19に示すようにベクトルを返します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="pub fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    let mut results = Vec::new();"></div><div data-l=""></div><div data-l="    for line in contents.lines() {"></div><div data-l="        if line.contains(query) {"></div><div data-l="            results.push(line);"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    results"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-19: Storing the lines that match so we can return them</span></span> <span class=caption>リスト12-19：一致する行を保存して返すことができる</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now the <code>search</code> function should return only the lines that contain <code>query</code> , and our test should pass.</span>これで<code>search</code>関数は<code>query</code>を含む行だけを返すようになり、テストは成功するはずです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s run the test:</span>テストを実行しましょう：</span> </p><br><div data-lang=text><div data-l="$ cargo test"></div><div data-l=--snip--></div><div data-l="running 1 test"></div><div data-l="test test::one_result ... ok"></div><div data-l=""></div><div data-l="test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Our test passed, so we know it works!</span>私たちのテストは合格しました。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">At this point, we could consider opportunities for refactoring the implementation of the search function while keeping the tests passing to maintain the same functionality.</span>現時点では、検索機能の実装をリファクタリングして、同じ機能を維持するためにテストを通過させる機会を考慮することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The code in the search function isn&#39;t too bad, but it doesn&#39;t take advantage of some useful features of iterators.</span>検索関数のコードはそれほど悪くはありませんが、イテレータの便利な機能を利用していません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll return to this example in Chapter 13, where we&#39;ll explore iterators in detail, and look at how to improve it.</span>第13章のこの例に戻ります。ここでは、イテレータを詳細に調査し、イテレータを改善する方法を見ていきます。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using the <code>search</code> Function in the <code>run</code> Function</span> <code>run</code>関数の<code>search</code>機能の使用</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that the <code>search</code> function is working and tested, we need to call <code>search</code> from our <code>run</code> function.</span> <code>search</code>機能が動作しテストされたので、 <code>run</code>関数から<code>search</code>を呼び出す必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We need to pass the <code>config.query</code> value and the <code>contents</code> that <code>run</code> reads from the file to the <code>search</code> function.</span>私たちは、合格する必要が<code>config.query</code>値と<code>contents</code> <code>run</code>にファイルから読み込み<code>search</code>機能を。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then <code>run</code> will print each line returned from <code>search</code> :</span>次に、 <code>run</code>は<code>search</code>から返された各行を出力し<code>search</code> ：</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;Error&gt;&gt; {"></div><div data-l="    let mut f = File::open(config.filename)?;"></div><div data-l=""></div><div data-l="    let mut contents = String::new();"></div><div data-l="    f.read_to_string(&amp;mut contents)?;"></div><div data-l=""></div><div data-l="    for line in search(&amp;config.query, &amp;contents) {"></div><div data-l="        println!(&quot;{}&quot;, line);"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    Ok(())"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re still using a <code>for</code> loop to return each line from <code>search</code> and print it.</span>私たちはまだ<code>for</code>ループを使って<code>search</code>から各行を返し、それを印刷します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now the entire program should work!</span>今やプログラム全体がうまくいくはずです！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s try it out, first with a word that should return exactly one line from the Emily Dickinson poem, “frog”:</span>エミリー・ディキンソンの詩「カエル」からちょうど1行戻ってくる言葉でまず試してみましょう。</span> </p><br><div data-lang=text><div data-l="$ cargo run frog poem.txt"></div><div data-l="   Compiling minigrep v0.1.0 (file:///projects/minigrep)"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.38 secs"></div><div data-l="     Running `target/debug/minigrep frog poem.txt`"></div><div data-l="How public, like a frog"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Cool!</span>クール！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now let&#39;s try a word that will match multiple lines, like “body”:</span>次に、 &quot;body&quot;のように複数の行に一致する単語を試してみましょう：</span> </p><br><div data-lang=text><div data-l="$ cargo run body poem.txt"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs"></div><div data-l="     Running `target/debug/minigrep body poem.txt`"></div><div data-l="I’m nobody! Who are you?"></div><div data-l="Are you nobody, too?"></div><div data-l="How dreary to be somebody!"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">And finally, let&#39;s make sure that we don&#39;t get any lines when we search for a word that isn&#39;t anywhere in the poem, such as “monomorphization”:</span>そして、最後に、 &quot;monomorphization&quot;のような、詩のどこにもない単語を検索するときに、私たちがどんな行をも作らないようにしましょう。</span> </p><br><div data-lang=text><div data-l="$ cargo run monomorphization poem.txt"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs"></div><div data-l="     Running `target/debug/minigrep monomorphization poem.txt`"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Excellent!</span>優れた！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve built our own mini version of a classic tool and learned a lot about how to structure applications.</span>私たちは、独自のミニバージョンの古典的なツールを構築し、アプリケーションの構造化方法について多くのことを学びました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve also learned a bit about file input and output, lifetimes, testing, and command line parsing.</span>また、ファイルの入出力、寿命、テスト、およびコマンドライン解析についても少し学びました。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To round out this project, we&#39;ll briefly demonstrate how to work with environment variables and how to print to standard error, both of which are useful when you&#39;re writing command line programs.</span>このプロジェクトを完成させるために、環境変数を使って作業する方法と標準エラーに印刷する方法を簡単に説明します。どちらもコマンドラインプログラムを書くときに便利です。</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch12-04-testing-the-librarys-functionality.html');});</script>