<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch09-02-recoverable-errors-with-result.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Recoverable Errors with <code>Result</code></span> <code>Result</code>回復可能なエラー</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Most errors aren&#39;t serious enough to require the program to stop entirely.</span>ほとんどのエラーは、プログラムが完全に停止するのに十分な深刻なものではありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Sometimes, when a function fails, it&#39;s for a reason that you can easily interpret and respond to.</span>時には、関数が失敗すると、それはあなたが簡単に解釈して応答できるという理由からです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, if you try to open a file and that operation fails because the file doesn&#39;t exist, you might want to create the file instead of terminating the process.</span>たとえば、ファイルを開こうとしたときにそのファイルが存在しないために操作が失敗した場合は、プロセスを終了する代わりにファイルを作成することができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Recall from “ <a href=#3handle_failure>Handling Potential Failure with the <code>Result</code> Type</a></span> 「 <a href=#3handle_failure><code>Result</code>タイプによる潜在的な障害の処理</a> 」を思い出してください。</span> <!-- ignore --> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">” in Chapter 2 that the <code>Result</code> enum is defined as having two variants, <code>Ok</code> and <code>Err</code> , as follows:</span>第2章では、 <code>Result</code>列挙型は、 <code>Ok</code>と<code>Err</code>という2つの変種を持つと定義されています。</span> </p><br> <a class=notranslate href=#1ch02-00-guessing-game-tutorial.html#handling-potential-failure-with-the-result-type>handle_failure</a> <br> <div data-lang=rust><div data-l="enum Result&lt;T, E&gt; {"></div><div data-l="    Ok(T),"></div><div data-l="    Err(E),"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>T</code> and <code>E</code> are generic type parameters: we&#39;ll discuss generics in more detail in Chapter 10. What you need to know right now is that <code>T</code> represents the type of the value that will be returned in a success case within the <code>Ok</code> variant, and <code>E</code> represents the type of the error that will be returned in a failure case within the <code>Err</code> variant.</span> <code>T</code>と<code>E</code>はジェネリック型のパラメータです：ジェネリックについては第10章でより詳しく説明します。あなたが今知る必要があるのは、 <code>T</code>は<code>Ok</code>バリアント内で成功のケースで返される値の型を表し、 <code>E</code>は<code>Err</code>バリアント内の<code>Err</code>場合に返されるエラーのタイプを表します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because <code>Result</code> has these generic type parameters, we can use the <code>Result</code> type and the functions that the standard library has defined on it in many different situations where the successful value and error value we want to return may differ.</span> <code>Result</code>はこれらのジェネリック型パラメータがあるため、 <code>Result</code>型と、標準ライブラリが定義している関数を使用することができます。戻り値とエラー値が異なる場合があります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s call a function that returns a <code>Result</code> value because the function could fail.</span>関数が失敗する可能性があるため、 <code>Result</code>値を返す関数を呼び出しましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Listing 9-3 we try to open a file.</span>コードリスト9-3では、ファイルを開こうとしています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;);"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 9-3: Opening a file</span></span> <span class=caption>リスト9-3：ファイルを開く</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">How do we know <code>File::open</code> returns a <code>Result</code> ?</span> <code>File::open</code>が<code>Result</code>返す方法を知るには？</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could look at the standard library API documentation, or we could ask the compiler!</span>私たちは、標準ライブラリAPIのドキュメントを見ることができますか、コンパイラに尋ねることができます！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If we give <code>f</code> a type annotation that we know is <i>not</i> the return type of the function and then try to compile the code, the compiler will tell us that the types don&#39;t match.</span>我々が与えた場合<code>f</code> 、我々は、関数の戻り値の型で<i>はありません</i>知っているし、コードをコンパイルしようとするタイプの注釈は、コンパイラは型が一致しないことを私たちに教えてくれます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The error message will then tell us what the type of <code>f</code> <i>is</i> .</span>エラーメッセージは、その後のタイプを教えます<code>f</code> <i>あります</i> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s try it!</span>試してみよう！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We know that the return type of <code>File::open</code> isn&#39;t of type <code>u32</code> , so let&#39;s change the <code>let f</code> statement to this:</span> <code>File::open</code>戻り値の型は<code>u32</code>型ではないので、 <code>let f</code>文をこれに変更し<code>let f</code> ：</span> </p><br><div data-lang=rust,ignore><div data-l="let f: u32 = File::open(&quot;hello.txt&quot;);"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Attempting to compile now gives us the following output:</span>今コンパイルしようとすると、次のような出力が得られます。</span> </p><br><div data-lang=text><div data-l="error[E0308]: mismatched types"></div><div data-l=" --&gt; src/main.rs:4:18"></div><div data-l="  |"></div><div data-l="4 |     let f: u32 = File::open(&quot;hello.txt&quot;);"></div><div data-l="  |                  ^^^^^^^^^^^^^^^^^^^^^^^ expected u32, found enum"></div><div data-l="`std::result::Result`"></div><div data-l="  |"></div><div data-l="  = note: expected type `u32`"></div><div data-l="             found type `std::result::Result&lt;std::fs::File, std::io::Error&gt;`"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This tells us the return type of the <code>File::open</code> function is a <code>Result&lt;T, E&gt;</code> .</span>これは、 <code>File::open</code>関数の戻り値の型が<code>Result&lt;T, E&gt;</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The generic parameter <code>T</code> has been filled in here with the type of the success value, <code>std::fs::File</code> , which is a file handle.</span>ジェネリックパラメータ<code>T</code>は、ここで成功値の型<code>std::fs::File</code> （ファイルハンドル）で埋められています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The type of <code>E</code> used in the error value is <code>std::io::Error</code> .</span>エラー値に使用される<code>E</code>のタイプは<code>std::io::Error</code>です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This return type means the call to <code>File::open</code> might succeed and return a file handle that we can read from or write to.</span>この戻り値の型は、 <code>File::open</code>への呼び出しが成功し、読み書き可能なファイルハンドルを返すことを意味します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The function call also might fail: for example, the file might not exist, or we might not have permission to access the file.</span>関数呼び出しも失敗する可能性があります。たとえば、ファイルが存在しないか、ファイルにアクセスする権限がないなどです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>File::open</code> function needs to have a way to tell us whether it succeeded or failed and at the same time give us either the file handle or error information.</span> <code>File::open</code>関数には、成功したか失敗したかを示す方法が必要です。同時に、ファイルハンドルまたはエラー情報のいずれかを与えます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This information is exactly what the <code>Result</code> enum conveys.</span>この情報は、 <code>Result</code> enumが伝えるものとまったく同じです。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In the case where <code>File::open</code> succeeds, the value in the variable <code>f</code> will be an instance of <code>Ok</code> that contains a file handle.</span> <code>File::open</code>が成功した場合、変数<code>f</code>値はファイルハンドルを含む<code>Ok</code>インスタンスになります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In the case where it fails, the value in <code>f</code> will be an instance of <code>Err</code> that contains more information about the kind of error that happened.</span>失敗した場合、 <code>f</code>の値は、発生したエラーの種類に関する詳細情報を含む<code>Err</code>インスタンスになります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We need to add to the code in Listing 9-3 to take different actions depending on the value <code>File::open</code> returns.</span>リスト9-3のコードに、 <code>File::open</code>値に応じて異なるアクションを取るために追加する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 9-4 shows one way to handle the <code>Result</code> using a basic tool, the <code>match</code> expression that we discussed in Chapter 6.</span>リスト9-4は、基本的なツールである第6章で説明した<code>match</code>式を使用して<code>Result</code>を処理する方法の1つを示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,should_panic><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;);"></div><div data-l=""></div><div data-l="    let f = match f {"></div><div data-l="        Ok(file) =&gt; file,"></div><div data-l="        Err(error) =&gt; {"></div><div data-l="            panic!(&quot;There was a problem opening the file: {:?}&quot;, error)"></div><div data-l="        },"></div><div data-l="    };"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 9-4: Using a <code>match</code> expression to handle the <code>Result</code> variants that might be returned</span></span> <span class=caption>リスト9-4： <code>match</code>式を使用して返される可能性のある<code>Result</code>バリアントを処理する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that, like the <code>Option</code> enum, the <code>Result</code> enum and its variants have been imported in the prelude, so we don&#39;t need to specify <code>Result::</code> before the <code>Ok</code> and <code>Err</code> variants in the <code>match</code> arms.</span>同様に、なお<code>Option</code>列挙型、 <code>Result</code>列挙型とその亜種はプレリュードにインポートされているので、我々は指定する必要はありません<code>Result::</code>前に、 <code>Ok</code>し、 <code>Err</code>中バリアント<code>match</code>腕。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Here we tell Rust that when the result is <code>Ok</code> , return the inner <code>file</code> value out of the <code>Ok</code> variant, and we then assign that file handle value to the variable <code>f</code> .</span>ここでは、結果があるときという錆を教えて<code>Ok</code> 、インナー返す<code>file</code>のうち、値を<code>Ok</code>バリアント、私たちはその後、変数にそのファイルハンドル値を割り当て<code>f</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">After the <code>match</code> , we can use the file handle for reading or writing.</span> <code>match</code>後、ファイルハンドルを読み書きすることができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The other arm of the <code>match</code> handles the case where we get an <code>Err</code> value from <code>File::open</code> .</span> <code>match</code>のもう一方の腕は、 <code>File::open</code>から<code>Err</code>値を取得するケースを処理し<code>File::open</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In this example, we&#39;ve chosen to call the <code>panic€</code> macro.</span>この例では、 <code>panic€</code>マクロを呼び出すことにしました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If there&#39;s no file named <i>hello.txt</i> in our current directory and we run this code, we&#39;ll see the following output from the <code>panic€</code> macro:</span>現在のディレクトリに<i>hello.txt</i>という名前のファイルがなく、このコードを実行すると、 <code>panic€</code>マクロから次の出力が表示されます。</span> </p><br><div data-lang=text><div data-l="thread 'main' panicked at 'There was a problem opening the file: Error { repr:"></div><div data-l="Os { code: 2, message: &quot;No such file or directory&quot; } }', src/main.rs:9:12"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As usual, this output tells us exactly what has gone wrong.</span>いつものように、この出力は何が間違っているかを正確に教えてくれます。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Matching on Different Errors</span>さまざまなエラーでのマッチング</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The code in Listing 9-4 will <code>panic€</code> no matter why <code>File::open</code> failed.</span>リスト9-4のコードは、 <code>File::open</code>失敗した理由に関係なく、 <code>panic€</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">What we want to do instead is take different actions for different failure reasons: if <code>File::open</code> failed because the file doesn&#39;t exist, we want to create the file and return the handle to the new file.</span>ファイルが存在しないために<code>File::open</code>失敗した場合、ファイルを作成して新しいファイルにハンドルを戻したいと考えています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If <code>File::open</code> failed for any other reason—for example, because we didn&#39;t have permission to open the file—we still want the code to <code>panic€</code> in the same way as it did in Listing 9-4.</span> <code>File::open</code>が他の理由で失敗した場合（たとえば、ファイルを開く権限がないなど）、リスト9-4と同じ方法でコードを<code>panic€</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Look at Listing 9-5, which adds another arm to the <code>match</code> .</span>リスト9-5を見てください。これは、 <code>match</code>別の腕を追加します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><p><!-- ignore this test because otherwise it creates hello.txt which causes other
tests to fail lol --></p><br><div data-lang=rust,ignore><div data-l="use std::fs::File;"></div><div data-l="use std::io::ErrorKind;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;);"></div><div data-l=""></div><div data-l="    let f = match f {"></div><div data-l="        Ok(file) =&gt; file,"></div><div data-l="        Err(ref error) if error.kind() == ErrorKind::NotFound =&gt; {"></div><div data-l="            match File::create(&quot;hello.txt&quot;) {"></div><div data-l="                Ok(fc) =&gt; fc,"></div><div data-l="                Err(e) =&gt; {"></div><div data-l="                    panic!("></div><div data-l="                        &quot;Tried to create file but there was a problem: {:?}&quot;,"></div><div data-l="                        e"></div><div data-l="                    )"></div><div data-l="                },"></div><div data-l="            }"></div><div data-l="        },"></div><div data-l="        Err(error) =&gt; {"></div><div data-l="            panic!("></div><div data-l="                &quot;There was a problem opening the file: {:?}&quot;,"></div><div data-l="                error"></div><div data-l="            )"></div><div data-l="        },"></div><div data-l="    };"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 9-5: Handling different kinds of errors in different ways</span></span> <span class=caption>コードリスト9-5：さまざまな種類のエラーをさまざまな方法で処理する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The type of the value that <code>File::open</code> returns inside the <code>Err</code> variant is <code>io::Error</code> , which is a struct provided by the standard library.</span> <code>Err</code>バリアントの中で<code>File::open</code>が返す値の型は<code>io::Error</code> 。これは標準ライブラリによって提供される構造体です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This struct has a method <code>kind</code> that we can call to get an <code>io::ErrorKind</code> value.</span>この構造体には、メソッドがある<code>kind</code> 、我々が取得するために呼び出すことができ<code>io::ErrorKind</code>値を。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The enum <code>io::ErrorKind</code> is provided by the standard library and has variants representing the different kinds of errors that might result from an <code>io</code> operation.</span> enum <code>io::ErrorKind</code>は標準ライブラリによって提供され、 <code>io</code>操作の結果として生じるさまざまな種類のエラーを表すバリアントを持っています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The variant we want to use is <code>ErrorKind::NotFound</code> , which indicates the file we&#39;re trying to open doesn&#39;t exist yet.</span>使用するバリアントは<code>ErrorKind::NotFound</code> 。これは、開こうとしているファイルがまだ存在しないことを示します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The condition <code>if error.kind() == ErrorKind::NotFound</code> is called a <i>match guard</i> : it&#39;s an extra condition on a <code>match</code> arm that further refines the arm&#39;s pattern.</span> <code>if error.kind() == ErrorKind::NotFound</code>が<i>マッチガード</i>と呼ばれる場合の条件は、 <code>match</code>アームの余分な条件であり、アームのパターンをさらに洗練させます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This condition must be true for that arm&#39;s code to be run;</span>この条件は、そのアームのコードを実行するためには真でなければなりません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">otherwise, the pattern matching will move on to consider the next arm in the <code>match</code> .</span>そうでない場合、パターンマッチングは、内の次のアームを検討する上で移動する<code>match</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>ref</code> in the pattern is needed so <code>error</code> is not moved into the guard condition but is merely referenced by it.</span>パターン内の<code>ref</code>が必要なので、 <code>error</code>はガード条件に移動せずに単に参照されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The reason you use <code>ref</code> to create a reference in a pattern instead of <code>&amp;</code> will be covered in detail in Chapter 18. In short, in the context of a pattern, <code>&amp;</code> matches a reference and gives you its value, but <code>ref</code> matches a value and gives you a reference to it.</span> <code>&amp;</code> <code>ref</code>代わりに<code>ref</code>を使って第18章でパターンを参照する理由は、第18章で詳しく説明します。パターンの文脈では<code>&amp;</code>は参照と一致し、その値を<code>ref</code>ますが、 <code>ref</code>は値と一致します。あなたにそれへの参照を与えます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The condition we want to check in the match guard is whether the value returned by <code>error.kind()</code> is the <code>NotFound</code> variant of the <code>ErrorKind</code> enum.</span>マッチガードでチェックしたい条件は、 <code>error.kind()</code>によって返された値が<code>ErrorKind</code> enumの<code>NotFound</code>バリエーションかどうかです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If it is, we try to create the file with <code>File::create</code> .</span>そうであれば、 <code>File::create</code>を使ってファイルを作成しようとし<code>File::create</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, because <code>File::create</code> could also fail, we need to add an inner <code>match</code> expression as well.</span>しかし、 <code>File::create</code>も失敗<code>File::create</code>可能性があるため、内部<code>match</code>式も追加する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When the file can&#39;t be opened, a different error message will be printed.</span>ファイルを開くことができない場合は、別のエラーメッセージが表示されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The last arm of the outer <code>match</code> stays the same so the program panics on any error besides the missing file error.</span>外側の<code>match</code>の最後の腕は同じままであり、ファイルエラー以外のエラーでもプログラムはパニックに陥ります。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Shortcuts for Panic on Error: <code>unwrap</code> and <code>expect</code></span>パニックエラーのショートカット： <code>unwrap</code> and <code>expect</code></span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using <code>match</code> works well enough, but it can be a bit verbose and doesn&#39;t always communicate intent well.</span> <code>match</code>を使用すると十分に機能しますが、少し冗長になり、必ずしも意図的に通信するとは限りません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>Result&lt;T, E&gt;</code> type has many helper methods defined on it to do various tasks.</span> <code>Result&lt;T, E&gt;</code>型には、さまざまなタスクを実行するための多くのヘルパーメソッドが定義されています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">One of those methods, called <code>unwrap</code> , is a shortcut method that is implemented just like the <code>match</code> expression we wrote in Listing 9-4.</span> <code>unwrap</code>と呼ばれるメソッドの1つは、リスト9-4で書いた<code>match</code>式のように実装されたショートカットメソッドです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the <code>Result</code> value is the <code>Ok</code> variant, <code>unwrap</code> will return the value inside the <code>Ok</code> .</span> <code>Result</code>値が<code>Ok</code>バリアントの場合、 <code>unwrap</code>は<code>Ok</code>内の値を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the <code>Result</code> is the <code>Err</code> variant, <code>unwrap</code> will call the <code>panic€</code> macro for us.</span> <code>Result</code>が<code>Err</code>バリアントの場合、 <code>unwrap</code>は<code>panic€</code>マクロのために呼び出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Here is an example of <code>unwrap</code> in action:</span>実行中の<code>unwrap</code>例を次に示します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,should_panic><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;).unwrap();"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If we run this code without a <i>hello.txt</i> file, we&#39;ll see an error message from the <code>panic€</code> call that the <code>unwrap</code> method makes:</span> <i>hello.txt</i>ファイルなしでこのコードを実行すると、 <code>unwrap</code>メソッドが行う<code>panic€</code>コールからのエラーメッセージが表示されます。</span> </p><br><div data-lang=text><div data-l="thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error {"></div><div data-l="repr: Os { code: 2, message: &quot;No such file or directory&quot; } }',"></div><div data-l=src/libcore/result.rs:906:4></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Another method, <code>expect</code> , which is similar to <code>unwrap</code> , lets us also choose the <code>panic€</code> error message.</span> <code>unwrap</code>に似ているもう1つのメソッド<code>expect</code>は、 <code>panic€</code>エラーメッセージを選択することもできます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using <code>expect</code> instead of <code>unwrap</code> and providing good error messages can convey your intent and make tracking down the source of a panic easier.</span> <code>unwrap</code>代わりに<code>expect</code>を使用<code>expect</code> 、良いエラーメッセージを提供すると、あなたの意図を伝えることができ、パニックの原因を簡単に追跡することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The syntax of <code>expect</code> looks like this:</span> <code>expect</code>の構文は次のようになります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,should_panic><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;).expect(&quot;Failed to open hello.txt&quot;);"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We use <code>expect</code> in the same way as <code>unwrap</code> : to return the file handle or call the <code>panic€</code> macro.</span> <code>unwrap</code>と同じ方法で<code>expect</code>を使用<code>expect</code>ます：ファイルハンドルを返すか<code>panic€</code>呼び出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The error message used by <code>expect</code> in its call to <code>panic€</code> will be the parameter that we pass to <code>expect</code> , rather than the default <code>panic€</code> message that <code>unwrap</code> uses.</span> <code>panic€</code>への呼び出しで<code>expect</code>で使用されるエラーメッセージは、 <code>unwrap</code>使用するデフォルトの<code>panic€</code>メッセージではなく、 <code>expect</code>に渡すパラメータになります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Here&#39;s what it looks like:</span>以下はその様子です：</span> </p><br><div data-lang=text><div data-l="thread 'main' panicked at 'Failed to open hello.txt: Error { repr: Os { code:"></div><div data-l="2, message: &quot;No such file or directory&quot; } }', src/libcore/result.rs:906:4"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because this error message starts with the text we specified, <code>Failed to open hello.txt</code> , it will be easier to find where in the code this error message is coming from.</span>このエラーメッセージは、指定したテキストで始まり、 <code>Failed to open hello.txt</code> 、このエラーメッセージがどこから来たのかを簡単に見つけることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If we use <code>unwrap</code> in multiple places, it can take more time to figure out exactly which <code>unwrap</code> is causing the panic because all <code>unwrap</code> calls that panic print the same message.</span>複数の場所で<code>unwrap</code>を使用すると、同じメッセージをパニックするすべての<code>unwrap</code>コールが発生するため、どの<code>unwrap</code>がパニックを引き起こしているかを正確に把握するのに時間がかかることがあります。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Propagating Errors</span>伝播エラー</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When you&#39;re writing a function whose implementation calls something that might fail, instead of handling the error within this function, you can return the error to the calling code so that it can decide what to do.</span>この関数内でエラーを処理する代わりに、実装が失敗する可能性のある呼び出しを呼び出す関数を書くときに、エラーを呼び出しコードに戻して何をすべきかを決定することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This is known as <i>propagating</i> the error and gives more control to the calling code, where there might be more information or logic that dictates how the error should be handled than what you have available in the context of your code.</span>これは、エラーを<i>伝播</i>するものとして知られており、コードのコンテキストで使用可能なものよりエラーを処理する方法を指示する情報やロジックがある場合、呼び出しコードをより詳細に制御できます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, Listing 9-6 shows a function that reads a username from a file.</span>たとえば、コードリスト9-6は、ファイルからユーザー名を読み取る関数を示しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the file doesn&#39;t exist or can&#39;t be read, this function will return those errors to the code that called this function.</span>ファイルが存在しないか、読み取れない場合、この関数はこれらのエラーをこの関数を呼び出したコードに返します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust><div data-l="use std::io;"></div><div data-l="use std::io::Read;"></div><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;);"></div><div data-l=""></div><div data-l="    let mut f = match f {"></div><div data-l="        Ok(file) =&gt; file,"></div><div data-l="        Err(e) =&gt; return Err(e),"></div><div data-l="    };"></div><div data-l=""></div><div data-l="    let mut s = String::new();"></div><div data-l=""></div><div data-l="    match f.read_to_string(&amp;mut s) {"></div><div data-l="        Ok(_) =&gt; Ok(s),"></div><div data-l="        Err(e) =&gt; Err(e),"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 9-6: A function that returns errors to the calling code using <code>match</code></span></span> <span class=caption>コードリスト9-6： <code>match</code>を使って呼び出し元のコードにエラーを返す関数</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Look at the return type of the function first: <code>Result&lt;String, io::Error&gt;</code> .</span>最初に関数の戻り値の型を<code>Result&lt;String, io::Error&gt;</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This means the function is returning a value of the type <code>Result&lt;T, E&gt;</code> where the generic parameter <code>T</code> has been filled in with the concrete type <code>String</code> and the generic type <code>E</code> has been filled in with the concrete type <code>io::Error</code> .</span>これは、関数が<code>Result&lt;T, E&gt;</code>型の値を返すことを意味します。ここで、ジェネリックパラメータ<code>T</code>は具体的な型<code>String</code>で埋められ、ジェネリック型<code>E</code>は具象型<code>io::Error</code>埋められています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If this function succeeds without any problems, the code that calls this function will receive an <code>Ok</code> value that holds a <code>String</code> —the username that this function read from the file.</span>この関数が問題なく成功すると、この関数を呼び出すコードは、この関数がファイルから読み取ったユーザー名である<code>String</code>を保持する<code>Ok</code>値を受け取ります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If this function encounters any problems, the code that calls this function will receive an <code>Err</code> value that holds an instance of <code>io::Error</code> that contains more information about what the problems were.</span>この関数が何らかの問題に遭遇した場合、この関数を呼び出すコードは、問題の内容に関する詳細情報を含む<code>io::Error</code>インスタンスを保持する<code>Err</code>値を受け取ります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We chose <code>io::Error</code> as the return type of this function because that happens to be the type of the error value returned from both of the operations we&#39;re calling in this function&#39;s body that might fail: the <code>File::open</code> function and the <code>read_to_string</code> method.</span>この関数の戻り値の型として<code>io::Error</code>を選択しました。これは、この関数の本体で呼び出されている両方の操作から返されるエラー値の型であるためです： <code>File::open</code>関数と<code>read_to_string</code>メソッド。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The body of the function starts by calling the <code>File::open</code> function.</span>関数の本体は、 <code>File::open</code>関数を呼び出すことによって開始します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we handle the <code>Result</code> value returned with a <code>match</code> similar to the <code>match</code> in Listing 9-4, only instead of calling <code>panic€</code> in the <code>Err</code> case, we return early from this function and pass the error value from <code>File::open</code> back to the calling code as this function&#39;s error value.</span>リスト9-4の<code>match</code>に似た<code>match</code>返された<code>Result</code>値を処理します<code>Err</code>ケースで<code>panic€</code>を呼び出すのではなく、この関数から早く戻り、 <code>File::open</code>エラー値をコードをこの関数のエラー値として呼び出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If <code>File::open</code> succeeds, we store the file handle in the variable <code>f</code> and continue.</span> <code>File::open</code>が成功すると、ファイルハンドルを変数<code>f</code>格納して処理を続行します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we create a new <code>String</code> in variable <code>s</code> and call the <code>read_to_string</code> method on the file handle in <code>f</code> to read the contents of the file into <code>s</code> .</span>次に、変数<code>s</code>新しい<code>String</code>を作成し、 <code>f</code>のファイルハンドルの<code>read_to_string</code>メソッドを呼び出して、ファイルの内容を<code>s</code>読み込みます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>read_to_string</code> method also returns a <code>Result</code> because it might fail, even though <code>File::open</code> succeeded.</span> <code>read_to_string</code>メソッドは、 <code>File::open</code>成功したにもかかわらず失敗する可能性があるため、 <code>Result</code>も返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">So we need another <code>match</code> to handle that <code>Result</code> : if <code>read_to_string</code> succeeds, then our function has succeeded, and we return the username from the file that&#39;s now in <code>s</code> wrapped in an <code>Ok</code> .</span>だから我々は、他の必要な<code>match</code>その処理するために<code>Result</code>次の場合<code>read_to_string</code>成功し、その後、私たちの関数が成功した、と私たちは、今のファイルからユーザ名を返す<code>s</code>に包まれて<code>Ok</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If <code>read_to_string</code> fails, we return the error value in the same way that we returned the error value in the <code>match</code> that handled the return value of <code>File::open</code> .</span> <code>read_to_string</code>が失敗した場合、 <code>File::open</code>戻り値を処理した<code>match</code>でエラー値を返したのと同じ方法でエラー値を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, we don&#39;t need to explicitly say <code>return</code> , because this is the last expression in the function.</span>しかし、関数の最後の式であるため、 <code>return</code>を明示的に言う必要はありません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The code that calls this code will then handle getting either an <code>Ok</code> value that contains a username or an <code>Err</code> value that contains an <code>io::Error</code> .</span>このコードを呼び出すコードは、ユーザー名を含む<code>Ok</code>値または<code>io::Error</code>を含む<code>Err</code>値のいずれかを取得して処理します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We don&#39;t know what the calling code will do with those values.</span>これらの値で呼び出し側のコードが何をするかはわかりません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the calling code gets an <code>Err</code> value, it could call <code>panic€</code> and crash the program, use a default username, or look up the username from somewhere other than a file, for example.</span>呼び出し元のコードが<code>Err</code>値を取得した場合、 <code>panic€</code>てプログラムをクラッシュさせたり、デフォルトのユーザー名を使用したり、ファイル以外のユーザー名を参照することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We don&#39;t have enough information on what the calling code is actually trying to do, so we propagate all the success or error information upward for it to handle appropriately.</span>呼び出し元コードが実際に何をしようとしているかについて十分な情報がないため、すべての成功またはエラーの情報を上向きに伝播して適切に処理します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This pattern of propagating errors is so common in Rust that Rust provides the question mark operator <code>?</code></span>この伝播エラーのパターンは、Rustが疑問符演算子を提供するほど一般的<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">to make this easier.</span>これをより簡単にする。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A Shortcut for Propagating Errors: the <code>?</code></span>伝播エラーのショートカット： <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Operator</span>オペレーター</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 9-7 shows an implementation of <code>read_username_from_file</code> that has the same functionality as it had in Listing 9-6, but this implementation uses the <code>?</code></span>リスト9-7は、リスト9-6と同じ機能を持つ<code>read_username_from_file</code>実装を示していますが、この実装では<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator.</span>オペレーター。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust><div data-l="use std::io;"></div><div data-l="use std::io::Read;"></div><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {"></div><div data-l="    let mut f = File::open(&quot;hello.txt&quot;)?;"></div><div data-l="    let mut s = String::new();"></div><div data-l="    f.read_to_string(&amp;mut s)?;"></div><div data-l="    Ok(s)"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 9-7: A function that returns errors to the calling code using the <code>?</code></span></span> <span class=caption>リスト9-7：使用して呼び出し元のコードにエラーを返す関数<code>?</code></span></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>operator</span></span> <span class=caption>オペレーター</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>?</code></span> <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">placed after a <code>Result</code> value is defined to work in almost the same way as the <code>match</code> expressions we defined to handle the <code>Result</code> values in Listing 9-6.</span>後に置か<code>Result</code>値はほぼ同じ方法で動作するように定義されている<code>match</code>我々が扱うように定義された式の<code>Result</code>リスト9-6の値を。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the value of the <code>Result</code> is an <code>Ok</code> , the value inside the <code>Ok</code> will get returned from this expression, and the program will continue.</span> <code>Result</code>の値が<code>Ok</code>の場合、 <code>Ok</code>内の値がこの式から返され、プログラムは続行されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the value is an <code>Err</code> , the value inside the <code>Err</code> will be returned from the whole function as if we had used the <code>return</code> keyword so the error value gets propagated to the calling code.</span>値がある場合<code>Err</code> 、内部値<code>Err</code> 、我々が使用していたかのように全体の関数から返される<code>return</code>エラー値は、呼び出し元のコードに伝播されますので、キーワードを。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">There is a difference between what the <code>match</code> expression from Listing 9-6 and the <code>?</code></span>リスト9-6の<code>match</code>式と<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator do: error values used with <code>?</code></span>演算子do：エラー値は<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">go through the <code>from</code> function, defined in the <code>From</code> trait in the standard library, which is used to convert errors from one type into another.</span>あるタイプから別のタイプへのエラーを変換するために使用される、標準ライブラリの<code>From</code>特性で定義された<code>from</code>関数を実行します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When the <code>?</code></span>いつ<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator calls the <code>from</code> function, the error type received is converted into the error type defined in the return type of the current function.</span>演算子が<code>from</code>関数を呼び出すと、受け取ったエラー・タイプが現行関数の戻りタイプで定義されているエラー・タイプに変換されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This is useful when a function returns one error type to represent all the ways a function might fail, even if parts might fail for many different reasons.</span>これは、関数が多くの異なる理由で失敗する可能性がある場合でも、関数が失敗する可能性のあるすべての方法を表す1つのエラータイプを返す場合に便利です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As long as each error type implements the <code>from</code> function to define how to convert itself to the returned error type, the <code>?</code></span>それぞれのエラータイプが<code>from</code>関数を実装して、返されたエラータイプに変換する方法を定義する限り、 <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator takes care of the conversion automatically.</span>演算子は自動的に変換を処理します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In the context of Listing 9-7, the <code>?</code></span>リスト9-7のコンテキストでは<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">at the end of the <code>File::open</code> call will return the value inside an <code>Ok</code> to the variable <code>f</code> .</span> <code>File::open</code>呼び出しの終わりに、 <code>Ok</code>中の値を変数<code>f</code>返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If an error occurs, the <code>?</code></span>エラーが発生した場合、 <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator will return early out of the whole function and give any <code>Err</code> value to the calling code.</span>演算子は関数全体から早期に戻り、呼び出しコードに<code>Err</code>値を与えます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The same thing applies to the <code>?</code></span>同じことが<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">at the end of the <code>read_to_string</code> call.</span> <code>read_to_string</code>呼び出しの終わりに。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>?</code></span> <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator eliminates a lot of boilerplate and makes this function&#39;s implementation simpler.</span>演算子は多くの定型文を削除し、この関数の実装を簡単にします。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could even shorten this code further by chaining method calls immediately after the <code>?</code></span>このコードをさらに短縮することもでき<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">, as shown in Listing 9-8.</span>リスト9-8を参照してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust><div data-l="use std::io;"></div><div data-l="use std::io::Read;"></div><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn read_username_from_file() -&gt; Result&lt;String, io::Error&gt; {"></div><div data-l="    let mut s = String::new();"></div><div data-l=""></div><div data-l="    File::open(&quot;hello.txt&quot;)?.read_to_string(&amp;mut s)?;"></div><div data-l=""></div><div data-l="    Ok(s)"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 9-8: Chaining method calls after the <code>?</code></span></span> <span class=caption>9-8のリスト：後メソッド呼び出しの連鎖<code>?</code></span></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>operator</span></span> <span class=caption>オペレーター</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve moved the creation of the new <code>String</code> in <code>s</code> to the beginning of the function;</span>私たちは、新しいの創造移動した<code>String</code>中<code>s</code>関数の先頭にします。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">that part hasn&#39;t changed.</span>その部分は変更されていません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Instead of creating a variable <code>f</code> , we&#39;ve chained the call to <code>read_to_string</code> directly onto the result of <code>File::open(&quot;hello.txt&quot;)?</code></span>変数<code>f</code>を作成するのではなく、 <code>File::open(&quot;hello.txt&quot;)?</code>の結果に<code>read_to_string</code>の呼び出しを直接<code>read_to_string</code>しました<code>File::open(&quot;hello.txt&quot;)?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">.</span> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We still have a <code>?</code></span>私たちはまだ<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">at the end of the <code>read_to_string</code> call, and we still return an <code>Ok</code> value containing the username in <code>s</code> when both <code>File::open</code> and <code>read_to_string</code> succeed rather than returning errors.</span> <code>read_to_string</code>呼び出しの終わりで、 <code>File::open</code>と<code>read_to_string</code>両方がエラーを返すのではなく成功したときに<code>s</code>にユーザー名を含む<code>Ok</code>値を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The functionality is again the same as in Listing 9-6 and Listing 9-7;</span>この機能はリスト9-6とリスト9-7と同じです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">this is just a different, more ergonomic way to write it.</span>これはちょうど異なった、より人間工学的な方法でそれを書くことです。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>?</code></span> <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Operator Can Only Be Used in Functions That Return <code>Result</code></span>演算子は<code>Result</code>返す関数でのみ使用できます</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>?</code></span> <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator can only be used in functions that have a return type of <code>Result</code> , because it is defined to work in the same way as the <code>match</code> expression we defined in Listing 9-6.</span>演算子は、リスト9-6で定義した<code>match</code>式と同じ方法で動作するように定義されているので、戻り値の型が<code>Result</code>である関数でのみ使用できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The part of the <code>match</code> that requires a return type of <code>Result</code> is <code>return Err(e)</code> , so the return type of the function must be a <code>Result</code> to be compatible with this <code>return</code> .</span>戻り値のタイプの<code>Result</code>が必要な<code>match</code>部分は<code>return Err(e)</code>なので、関数の戻り値の型はこの<code>return</code>と互換性がある<code>Result</code>なければなりません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s look at what happens if we use the <code>?</code></span>私たちが<code>?</code>を使うとどうなるのか見てみましょう<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator in the <code>main</code> function, which you&#39;ll recall has a return type of <code>()</code> :</span> <code>main</code>関数のoperatorには戻り値の型<code>()</code>ます：</span> </p><br><div data-lang=rust,ignore><div data-l="use std::fs::File;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let f = File::open(&quot;hello.txt&quot;)?;"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When we compile this code, we get the following error message:</span>このコードをコンパイルすると、次のエラーメッセージが表示されます。</span> </p><br><div data-lang=text><div data-l="error[E0277]: the trait bound `(): std::ops::Try` is not satisfied"></div><div data-l=" --&gt; src/main.rs:4:13"></div><div data-l="  |"></div><div data-l="4 |     let f = File::open(&quot;hello.txt&quot;)?;"></div><div data-l="  |             ------------------------"></div><div data-l="  |             |"></div><div data-l="  |             the `?` operator can only be used in a function that returns"></div><div data-l="  `Result` (or another type that implements `std::ops::Try`)"></div><div data-l="  |             in this macro invocation"></div><div data-l="  |"></div><div data-l="  = help: the trait `std::ops::Try` is not implemented for `()`"></div><div data-l="  = note: required by `std::ops::Try::from_error`"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This error points out that we&#39;re only allowed to use the <code>?</code></span>このエラーは、我々が使用することが許されていることを指摘しています<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator in a function that returns <code>Result</code> .</span> <code>Result</code>を返す関数で演算子を使用します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In functions that don&#39;t return <code>Result</code> , when you call other functions that return <code>Result</code> , you&#39;ll need to use a <code>match</code> or one of the <code>Result</code> methods to handle the <code>Result</code> instead of using the <code>?</code></span> <code>Result</code>返さない関数では、 <code>Result</code>を返す他の関数を呼び出すときには、 <code>match</code>または<code>Result</code>メソッドの1つを使用して<code>?</code>を使用する代わりに<code>Result</code>を処理する必要があります<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator to potentially propagate the error to the calling code.</span>呼び出し側コードにエラーを伝播させる可能性があります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that we&#39;ve discussed the details of calling <code>panic€</code> or returning <code>Result</code> , let&#39;s return to the topic of how to decide which is appropriate to use in which cases.</span> <code>panic€</code>や<code>Result</code>の返信の詳細については既に説明しましたが、どのケースで適切に使用するかを決める方法のトピックに戻りましょう。</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch09-02-recoverable-errors-with-result.html');});</script>