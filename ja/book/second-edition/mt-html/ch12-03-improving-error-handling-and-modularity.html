<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch12-03-improving-error-handling-and-modularity.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Refactoring to Improve Modularity and Error Handling</span>モジュール性とエラー処理を改善するためのリファクタリング</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To improve our program, we&#39;ll fix four problems that have to do with the program&#39;s structure and how it&#39;s handling potential errors.</span>私たちのプログラムを改善するために、プログラムの構造と関係している4つの問題と潜在的なエラーをどのように処理するのかを修正します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">First, our <code>main</code> function now performs two tasks: it parses arguments and opens files.</span>最初に、 <code>main</code>関数は2つのタスクを実行します：引数を解析してファイルを開きます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For such a small function, this isn&#39;t a major problem.</span>このような小さな機能にとって、これは大きな問題ではありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, if we continue to grow our program inside <code>main</code> , the number of separate tasks the <code>main</code> function handles will increase.</span>しかし、 <code>main</code>でプログラムを成長させ続ければ、 <code>main</code>関数のハンドルが増えます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As a function gains responsibilities, it becomes more difficult to reason about, harder to test, and harder to change without breaking one of its parts.</span>関数が責任を負うにつれて、その一部を破ることなく、推論するのが難しくなり、テストが難しくなり、変更するのが難しくなります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It&#39;s best to separate functionality so each function is responsible for one task.</span>各機能が1つのタスクを担当するように、機能を分離することが最善です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This issue also ties into the second problem: although <code>query</code> and <code>filename</code> are configuration variables to our program, variables like <code>f</code> and <code>contents</code> are used to perform the program&#39;s logic.</span>この問題は第2の問題にも関連してい<code>query</code>と<code>filename</code>はプログラムの構成変数ですが、 <code>f</code>や<code>contents</code>などの変数を使用してプログラムのロジックを実行します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The longer <code>main</code> becomes, the more variables we&#39;ll need to bring into scope;</span> <code>main</code>が長くなればなるほど、より多くの変数をスコープに入れる必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">the more variables we have in scope, the harder it will be to keep track of the purpose of each.</span>スコープの変数が多ければ多いほど、それぞれの目的を把握することが難しくなります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It&#39;s best to group the configuration variables into one structure to make their purpose clear.</span>目的を明確にするために、構成変数を1つの構造にグループ化することが最善です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The third problem is that we&#39;ve used <code>expect</code> to print an error message when opening the file fails, but the error message just prints <code>file not found</code> .</span> 3番目の問題は、ファイルを開くときにエラーメッセージを出力<code>expect</code>を<code>expect</code>していたが、エラーメッセージが単に<code>file not found</code>です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Opening a file can fail in a number of ways besides the file being missing: for example, the file might exist, but we might not have permission to open it.</span>ファイルを開くことは、ファイルが存在しないこと以外にもいくつかの方法で失敗する可能性があります。たとえば、ファイルが存在する可能性がありますが、ファイルを開く権限がない可能性があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Right now, if we&#39;re in that situation, we&#39;d print the <code>file not found</code> error message, which would give the user the wrong information!</span>今の状況では、 <code>file not found</code>エラーメッセージが表示され、ユーザーに間違った情報が与えられます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Fourth, we use <code>expect</code> repeatedly to handle different errors, and if the user runs our program without specifying enough arguments, they&#39;ll get an <code>index out of bounds</code> error from Rust that doesn&#39;t clearly explain the problem.</span>第4に、さまざまなエラーを繰り返し処理する<code>expect</code>ています。ユーザーが十分な引数を指定せずにプログラムを実行すると、問題を明確に説明していないRustから<code>index out of bounds</code>エラーが発生します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It would be best if all the error-handling code were in one place so future maintainers had only one place to consult in the code if the error-handling logic needed to change.</span>エラー処理ロジックを変更する必要がある場合は、将来のメンテナーがコード内で相談する場所が1つしかないため、すべてのエラー処理コードが1か所にある場合に最適です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Having all the error-handling code in one place will also ensure that we&#39;re printing messages that will be meaningful to our end users.</span>すべてのエラー処理コードを1か所にまとめることで、エンドユーザーにとって意味のあるメッセージを確実に印刷できるようになります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s address these four problems by refactoring our project.</span>私たちのプロジェクトをリファクタリングして、これらの4つの問題に取り組んでみましょう。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Separation of Concerns for Binary Projects</span>バイナリプロジェクトの懸念の分離</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The organizational problem of allocating responsibility for multiple tasks to the <code>main</code> function is common to many binary projects.</span>複数のタスクの責任を<code>main</code>関数に割り当てるという組織の問題は、多くのバイナリプロジェクトに共通しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As a result, the Rust community has developed a process to use as a guideline for splitting the separate concerns of a binary program when <code>main</code> starts getting large.</span>その結果、Rustコミュニティは、 <code>main</code>が大きくなったときにバイナリプログラムの別の懸案事​​項を分割するためのガイドラインとして使用するプロセスを開発しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The process has the following steps:</span>プロセスには次のステップがあります。</span> </p><br><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Split your program into a <i>main.rs</i> and a <i>lib.rs</i> and move your program&#39;s logic to <i>lib.rs</i> .</span> <i>main.rs</i>と<i>lib.rs</i>にあなたのプログラムを分割し<i>、lib.rs</i>にあなたのプログラムのロジックを移動します。</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As long as your command line parsing logic is small, it can remain in</span>コマンドラインの解析ロジックが小さい限り、</span> </div><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><i>main.rs</i> .</span> <i>main.rs。</i></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">* When the command line parsing logic starts getting complicated, extract it from <i>main.rs</i> and move it to <i>lib.rs</i> .</span> *コマンドラインの解析ロジックが複雑になると、 <i>main.rs</i>から抽出して<i>lib.rs</i>に移動し<i>ます</i> 。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The responsibilities that remain in the <code>main</code> function after this process should be limited to the following:</span>このプロセス後の<code>main</code>機能に残っている責任は、次のように限定されます。</span> </p><br><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Calling the command line parsing logic with the argument values</span>引数値を使用してコマンドライン解析ロジックを呼び出す</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Setting up any other configuration</span>他の設定を設定する</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Calling a <code>run</code> function in <i>lib.rs</i></span> <i>lib.rsで</i> <code>run</code>関数を<i>呼び出す</i></span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Handling the error if <code>run</code> returns an error</span> <code>run</code>エラーを処理するとエラー<code>run</code>返される</span> </div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This pattern is about separating concerns: <i>main.rs</i> handles running the program, and <i>lib.rs</i> handles all the logic of the task at hand.</span>このパターンは、懸念を分離についてです<i>：main.rs</i>ハンドルは、プログラムを実行している、と<i>lib.rsは</i>手元の作業のすべてのロジックを処理します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because you can&#39;t test the <code>main</code> function directly, this structure lets you test all of your program&#39;s logic by moving it into functions in <i>lib.rs</i> .</span> <code>main</code>関数を直接テストすることはできないので、この構造体を使用すると、 <i>lib.rs</i>内の関数にプログラムのロジックを移動することで、すべてのプログラムのロジックをテストできます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The only code that remains in <i>main.rs</i> will be small enough to verify its correctness by reading it.</span> <i>main.rsに</i>残っている唯一のコードは、 <i>それ</i>を読み取って正当性を検証するのに十分小さいものです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s rework our program by following this process.</span>このプロセスを踏んでプログラムを修正しましょう。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Extracting the Argument Parser</span>引数パーサーの抽出</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll extract the functionality for parsing arguments into a function that <code>main</code> will call to prepare for moving the command line parsing logic to <i>src/lib.rs</i> .</span>コマンドライン解析ロジックを<i>src / lib.rsに</i>移動する準備をするために<code>main</code>が呼び出す関数に引数を解析する機能を抽出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-5 shows the new start of <code>main</code> that calls a new function <code>parse_config</code> , which we&#39;ll define in <i>src/main.rs</i> for the moment.</span>リスト12-5は新しい関数<code>parse_config</code>を呼び出す新しい<code>main</code>開始を示しています。これについては<i>src / main.rsですぐに</i>定義します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="fn main() {"></div><div data-l="    let args: Vec&lt;String&gt; = env::args().collect();"></div><div data-l=""></div><div data-l="    let (query, filename) = parse_config(&amp;args);"></div><div data-l=""></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=}></div><div data-l=""></div><div data-l="fn parse_config(args: &amp;[String]) -&gt; (&amp;str, &amp;str) {"></div><div data-l="    let query = &amp;args[1];"></div><div data-l="    let filename = &amp;args[2];"></div><div data-l=""></div><div data-l="    (query, filename)"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-5: Extracting a <code>parse_config</code> function from <code>main</code></span></span> <span class=caption>リスト12-5：抽出<code>parse_config</code>からの機能<code>main</code></span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re still collecting the command line arguments into a vector, but instead of assigning the argument value at index 1 to the variable <code>query</code> and the argument value at index 2 to the variable <code>filename</code> within the <code>main</code> function, we pass the whole vector to the <code>parse_config</code> function.</span>コマンドライン引数をベクトルに集めていますが、インデックス1の引数値を変数<code>query</code>に、インデックス2の引数値を<code>main</code>関数内の変数<code>filename</code>に代入するのではなく、ベクトル全体を<code>parse_config</code>関数。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>parse_config</code> function then holds the logic that determines which argument goes in which variable and passes the values back to <code>main</code> .</span>次に、 <code>parse_config</code>関数は、どの引数がどの変数に入り、その値を<code>main</code>戻すかを決定するロジックを保持します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We still create the <code>query</code> and <code>filename</code> variables in <code>main</code> , but <code>main</code> no longer has the responsibility of determining how the command line arguments and variables correspond.</span> <code>main</code>は依然として<code>query</code>と<code>filename</code>変数が作成されてい<code>query</code>が、 <code>main</code>はもはやコマンドラインの引数と変数がどのように対応しているかを決定する責任がありません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This rework may seem like overkill for our small program, but we&#39;re refactoring in small, incremental steps.</span>このリワークは、私たちの小規模なプログラムでは過度のように思えるかもしれませんが、少しずつ段階的にリファクタリングしています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">After making this change, run the program again to verify that the argument parsing still works.</span>この変更を行った後、プログラムを再度実行して、引き数解析が引き続き機能することを確認します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It&#39;s good to check your progress often, to help identify the cause of problems when they occur.</span>進行状況を頻繁に確認し、発生した問題の原因を特定するのに役立ちます。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Grouping Configuration Values</span>設定値のグループ化</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can take another small step to improve the <code>parse_config</code> function further.</span> <code>parse_config</code>関数をさらに改善するためにもう一度小さなステップを踏むことができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">At the moment, we&#39;re returning a tuple, but then we immediately break that tuple into individual parts again.</span>現時点ではタプルを返していますが、すぐにそのタプルを個々のパーツに分割し直します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This is a sign that perhaps we don&#39;t have the right abstraction yet.</span>これは、おそらくまだ適切な抽象概念を持っていないという兆候です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Another indicator that shows there&#39;s room for improvement is the <code>config</code> part of <code>parse_config</code> , which implies that the two values we return are related and are both part of one configuration value.</span>改善の余地があることを示す別の指標は、 <code>parse_config</code>の<code>config</code>部分です。これは、返される2つの値が関連しており、両方が1つの構成値の一部であることを意味します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re not currently conveying this meaning in the structure of the data other than by grouping the two values into a tuple;</span>現在のところ、2つの値をタプルにグループ化する以外の方法で、データの構造にこの意味を伝えていません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">we could put the two values into one struct and give each of the struct fields a meaningful name.</span> 2つの値を1つの構造体に入れ、各構造体フィールドに意味のある名前を付けることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Doing so will make it easier for future maintainers of this code to understand how the different values relate to each other and what their purpose is.</span>そうすることで、このコードの将来のメンテナが、異なる値がどのように相互に関係し、その目的が理解できるようになります。</span> </p><br><blockquote><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note: Some people call this anti-pattern of using primitive values when a complex type would be more appropriate <i>primitive obsession</i> .</span>注：複雑な型がより適切な<i>基本的な執着である</i>場合、プリミティブ値を使用するというこの反パターンと呼ばれる人もいます。</span> </p></blockquote><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-6 shows the improvements to the <code>parse_config</code> function.</span> <code>parse_config</code>リスト12-6に、 <code>parse_config</code>関数の改善点を示します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,should_panic><div data-l="# use std::env;"></div><div data-l="# use std::fs::File;"></div><div data-l=#></div><div data-l="fn main() {"></div><div data-l="    let args: Vec&lt;String&gt; = env::args().collect();"></div><div data-l=""></div><div data-l="    let config = parse_config(&amp;args);"></div><div data-l=""></div><div data-l="    println!(&quot;Searching for {}&quot;, config.query);"></div><div data-l="    println!(&quot;In file {}&quot;, config.filename);"></div><div data-l=""></div><div data-l="    let mut f = File::open(config.filename).expect(&quot;file not found&quot;);"></div><div data-l=""></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=}></div><div data-l=""></div><div data-l="struct Config {"></div><div data-l="    query: String,"></div><div data-l="    filename: String,"></div><div data-l=}></div><div data-l=""></div><div data-l="fn parse_config(args: &amp;[String]) -&gt; Config {"></div><div data-l="    let query = args[1].clone();"></div><div data-l="    let filename = args[2].clone();"></div><div data-l=""></div><div data-l="    Config { query, filename }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-6: Refactoring <code>parse_config</code> to return an instance of a <code>Config</code> struct</span></span> <span class=caption>リスト12-6： <code>parse_config</code>をリファクタリングして<code>Config</code>インスタンスを返すstruct</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve added a struct named <code>Config</code> defined to have fields named <code>query</code> and <code>filename</code> .</span> <code>Config</code>という名前のstructを追加し、 <code>query</code>および<code>filename</code>という名前のフィールドを追加しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The signature of <code>parse_config</code> now indicates that it returns a <code>Config</code> value.</span> <code>parse_config</code>のシグネチャは、 <code>Config</code>値を返すことを示します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In the body of <code>parse_config</code> , where we used to return string slices that reference <code>String</code> values in <code>args</code> , we now define <code>Config</code> to contain owned <code>String</code> values.</span> <code>parse_config</code>の本体では、 <code>args</code>に<code>String</code>値を参照する<code>String</code>列スライスを返すため、ここでは所有された<code>String</code>値を含むように<code>Config</code>を定義します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>args</code> variable in <code>main</code> is the owner of the argument values and is only letting the <code>parse_config</code> function borrow them, which means we&#39;d violate Rust&#39;s borrowing rules if <code>Config</code> tried to take ownership of the values in <code>args</code> .</span> <code>args</code>内の変数<code>main</code>引数値の所有者であるとだけさせて頂いており<code>parse_config</code>場合、我々は錆の借入ルールに違反するだろうことを意味する、それを借り機能を<code>Config</code>内の値の所有権を取得しようとした<code>args</code> 。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could manage the <code>String</code> data in a number of different ways, but the easiest, though somewhat inefficient, route is to call the <code>clone</code> method on the values.</span> <code>String</code>データはさまざまな方法で管理することができますが、最も簡単ではあるが非効率的な方法は、値で<code>clone</code>メソッドを呼び出すことです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This will make a full copy of the data for the <code>Config</code> instance to own, which takes more time and memory than storing a reference to the string data.</span>これにより、 <code>Config</code>インスタンスのデータの完全なコピーが作成されます。これは、文字列データへの参照を格納するよりも時間とメモリがかかります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, cloning the data also makes our code very straightforward because we don&#39;t have to manage the lifetimes of the references;</span>しかし、データのクローン作成は、参照の存続期間を管理する必要がないため、コードを非常に簡単にします。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">in this circumstance, giving up a little performance to gain simplicity is a worthwhile trade-off.</span>この状況では、シンプルさを得るために少しのパフォーマンスを放棄することは、価値のあるトレードオフです。</span> </p><br><blockquote><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The Trade-Offs of Using <code>clone</code></span> <code>clone</code>使用のトレードオフ</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">There&#39;s a tendency among many Rustaceans to avoid using <code>clone</code> to fix ownership problems because of its runtime cost.</span>多くの屋根裏者は、ランタイムコストのために所有権の問題を修正するために<code>clone</code>を使用することを避ける傾向があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Chapter 13, you&#39;ll learn how to use more efficient methods in this type of situation.</span>第13章では、このような状況でより効率的な方法を使用する方法を学習します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">But for now, it&#39;s okay to copy a few strings to continue making progress because you&#39;ll make these copies only once and your filename and query string are very small.</span>しかし今のところ、これらのコピーを一度しか作成せず、ファイル名とクエリ文字列が非常に小さいため、いくつかの文字列をコピーして処理を続行することは大丈夫です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It&#39;s better to have a working program that&#39;s a bit inefficient than to try to hyperoptimize code on your first pass.</span>あなたの最初のパスでコードをハイパーオプティマイズしようとするよりも少し非効率な作業プログラムを用意する方が良いでしょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As you become more experienced with Rust, it&#39;ll be easier to start with the most efficient solution, but for now, it&#39;s perfectly acceptable to call <code>clone</code> .</span> Rustの経験が豊富になると、最も効率的なソリューションから簡単に始めることができますが、今のところ<code>clone</code>を呼び出すことは完全に受け入れられます。</span> </p></blockquote><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve updated <code>main</code> so it places the instance of <code>Config</code> returned by <code>parse_config</code> into a variable named <code>config</code> , and we updated the code that previously used the separate <code>query</code> and <code>filename</code> variables so it now uses the fields on the <code>Config</code> struct instead.</span>私たちは、更新した<code>main</code>それはのインスタンス置くよう<code>Config</code>によって返さ<code>parse_config</code>という名前の変数に<code>config</code> 、そして我々は、これまでに個別に使用されるコード更新<code>query</code>および<code>filename</code> 、それは今のフィールドを使用していますので、変数を<code>Config</code>代わりに構造体を。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now our code more clearly conveys that <code>query</code> and <code>filename</code> are related and that their purpose is to configure how the program will work.</span>今、私たちのコードがより明確にすることを伝える<code>query</code>と<code>filename</code>関連していると彼らの目的は、プログラムが動作する方法を設定することであること。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Any code that uses these values knows to find them in the <code>config</code> instance in the fields named for their purpose.</span>これらの値を使用するコードは、その目的のために名前が付けられたフィールドの<code>config</code>インスタンスでそれらの値を見つけることができます。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Creating a Constructor for <code>Config</code></span> <code>Config</code>コンストラクタの作成</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">So far, we&#39;ve extracted the logic responsible for parsing the command line arguments from <code>main</code> and placed it in the <code>parse_config</code> function.</span>これまで、 <code>main</code>からコマンドライン引数を解析するロジックを抽出し、 <code>parse_config</code>関数に配置しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Doing so helped us to see that the <code>query</code> and <code>filename</code> values were related and that relationship should be conveyed in our code.</span>そうすることで、 <code>query</code>と<code>filename</code>値が関連し、その関係が私たちのコードで伝えられるべきであることがわかりました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We then added a <code>Config</code> struct to name the related purpose of <code>query</code> and <code>filename</code> and to be able to return the values&#39; names as struct field names from the <code>parse_config</code> function.</span>次に、 <code>query</code>と<code>filename</code>名の関連する目的に名前を付け、 <code>parse_config</code>関数から値の名前を構造体フィールド名として返すために、 <code>Config</code>構造体を追加しました。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">So now that the purpose of the <code>parse_config</code> function is to create a <code>Config</code> instance, we can change <code>parse_config</code> from a plain function to a function named <code>new</code> that is associated with the <code>Config</code> struct.</span> <code>parse_config</code>関数の目的は<code>Config</code>インスタンスを作成することになったので、 <code>parse_config</code>をプレーン関数から<code>Config</code>構造体に関連付けられた<code>new</code>という名前の関数に変更できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Making this change will make the code more idiomatic.</span>この変更を加えると、コードはより慣用的になります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can create instances of types in the standard library, such as <code>String</code> , by calling <code>String::new</code> .</span> <code>String::new</code>呼び出すことで、 <code>String</code>などの標準ライブラリに型のインスタンスを作成できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Similarly, by changing <code>parse_config</code> into a <code>new</code> function associated with <code>Config</code> , we&#39;ll be able to create instances of <code>Config</code> by calling <code>Config::new</code> .</span>同様に、 <code>parse_config</code>を<code>Config</code>に関連付けられた<code>new</code>関数に変更すると、 <code>Config::new</code>呼び出すことによって<code>Config</code>インスタンスを作成することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-7 shows the changes we need to make.</span>コードリスト12-7は、変更が必要であることを示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,should_panic><div data-l="# use std::env;"></div><div data-l=#></div><div data-l="fn main() {"></div><div data-l="    let args: Vec&lt;String&gt; = env::args().collect();"></div><div data-l=""></div><div data-l="    let config = Config::new(&amp;args);"></div><div data-l=""></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=}></div><div data-l=""></div><div data-l="# struct Config {"></div><div data-l="#     query: String,"></div><div data-l="#     filename: String,"></div><div data-l="# }"></div><div data-l=#></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="impl Config {"></div><div data-l="    fn new(args: &amp;[String]) -&gt; Config {"></div><div data-l="        let query = args[1].clone();"></div><div data-l="        let filename = args[2].clone();"></div><div data-l=""></div><div data-l="        Config { query, filename }"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-7: Changing <code>parse_config</code> into <code>Config::new</code></span></span> <span class=caption>リスト12-7： <code>parse_config</code>を<code>Config::new</code>変更する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve updated <code>main</code> where we were calling <code>parse_config</code> to instead call <code>Config::new</code> .</span>私たちは、更新した<code>main</code>私たちが呼んでいたところ<code>parse_config</code>代わりに呼び出すように<code>Config::new</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve changed the name of <code>parse_config</code> to <code>new</code> and moved it within an <code>impl</code> block, which associates the <code>new</code> function with <code>Config</code> .</span>私たちは、の名前変更した<code>parse_config</code>に<code>new</code>して以内にそれを移動<code>impl</code>関連付けブロック、 <code>new</code>と機能<code>Config</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Try compiling this code again to make sure it works.</span>このコードを再度コンパイルして、動作することを確認してください。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Fixing the Error Handling</span>エラー処理の修正</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now we&#39;ll work on fixing our error handling.</span>ここでは、エラー処理を修正する作業を行います。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Recall that attempting to access the values in the <code>args</code> vector at index 1 or index 2 will cause the program to panic if the vector contains fewer than three items.</span> <code>args</code>ベクトルのインデックス1またはインデックス2の値にアクセスしようとすると、ベクトルに3つ未満の項目が含まれているとプログラムがパニックになることを思い出してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Try running the program without any arguments;</span>引数なしでプログラムを実行してみてください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">it will look like this:</span>次のようになります。</span> </p><br><div data-lang=text><div data-l="$ cargo run"></div><div data-l="   Compiling minigrep v0.1.0 (file:///projects/minigrep)"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs"></div><div data-l="     Running `target/debug/minigrep`"></div><div data-l="thread 'main' panicked at 'index out of bounds: the len is 1"></div><div data-l="but the index is 1', src/main.rs:29:21"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The line <code>index out of bounds: the len is 1 but the index is 1</code> is an error message intended for programmers.</span> <code>index out of bounds: the len is 1 but the index is 1</code>の行<code>index out of bounds: the len is 1 but the index is 1</code>です。これはプログラマ向けのエラーメッセージです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It won&#39;t help our end users understand what happened and what they should do instead.</span>エンドユーザーが何が起こったのか、そして何をすべきかを理解するのに役立つものではありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s fix that now.</span>今すぐ修正しましょう。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Improving the Error Message</span>エラーメッセージの改善</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Listing 12-8, we add a check in the <code>new</code> function that will verify that the slice is long enough before accessing index 1 and 2. If the slice isn&#39;t long enough, the program panics and displays a better error message than the <code>index out of bounds</code> message.</span>リスト12-8では、 <code>new</code>関数に、スライスがインデックス1と2にアクセスする前に十分に長いことを確認するチェックを追加します。スライスの長さが十分でない場合、プログラムはパニックを起こし、より良いエラーメッセージを表示します。 <code>index out of bounds</code>メッセージの<code>index out of bounds</code></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l="fn new(args: &amp;[String]) -&gt; Config {"></div><div data-l="    if args.len() &lt; 3 {"></div><div data-l="        panic!(&quot;not enough arguments&quot;);"></div><div data-l="    }"></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-8: Adding a check for the number of arguments</span></span> <span class=caption>リスト12-8：引数の数のチェックを追加する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This code is similar to the <code>Guess::new</code> function we wrote in Listing 9-9, where we called <code>panic€</code> when the <code>value</code> argument was out of the range of valid values.</span>このコードは、リスト9-9で書いた<code>Guess::new</code>関数に似ています。ここでは、 <code>value</code>引数が有効な値の範囲外になったときに<code>panic€</code>を呼び出しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Instead of checking for a range of values here, we&#39;re checking that the length of <code>args</code> is at least 3 and the rest of the function can operate under the assumption that this condition has been met.</span>ここでは値の範囲を調べる代わりに、 <code>args</code>の長さが少なくとも3であることを確認しています。残りの関数は、この条件が満たされていることを前提として動作します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If <code>args</code> has fewer than three items, this condition will be true, and we call the <code>panic€</code> macro to end the program immediately.</span> <code>args</code> 3つ以下の項目がある場合、この条件は真となり、すぐにプログラムを終了させるために<code>panic€</code>マクロを呼び出します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">With these extra few lines of code in <code>new</code> , let&#39;s run the program without any arguments again to see what the error looks like now:</span>これらの余分な数行のコードを<code>new</code> 、引数を指定せずにプログラムを実行して、エラーの内容を確認してみましょう。</span> </p><br><div data-lang=text><div data-l="$ cargo run"></div><div data-l="   Compiling minigrep v0.1.0 (file:///projects/minigrep)"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs"></div><div data-l="     Running `target/debug/minigrep`"></div><div data-l="thread 'main' panicked at 'not enough arguments', src/main.rs:30:12"></div><div data-l="note: Run with `RUST_BACKTRACE=1` for a backtrace."></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This output is better: we now have a reasonable error message.</span>この出力は良いです：我々は今合理的なエラーメッセージがあります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, we also have extraneous information we don&#39;t want to give to our users.</span>しかし、我々はユーザーに与えたくない余分な情報も持っています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Perhaps using the technique we used in Listing 9-9 isn&#39;t the best to use here: a call to <code>panic€</code> is more appropriate for a programming problem than a usage problem, as discussed in Chapter 9. Instead, we can use the other technique you learned about in Chapter 9—returning a <code>Result</code> that indicates either success or an error.</span>おそらく、リスト9-9で使用した手法を使用するのは、ここでは最善の方法ではありません。 <code>panic€</code>呼び出しは、第9章で説明したように、プログラミングの問題に適しています。代わりに、成功またはエラーを示す<code>Result</code>を返す第9章で学んだ技術。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Returning a <code>Result</code> from <code>new</code> Instead of Calling <code>panic€</code></span> <code>panic€</code>を呼び出す代わりに<code>new</code> <code>Result</code>を返す<code>panic€</code></span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can instead return a <code>Result</code> value that will contain a <code>Config</code> instance in the successful case and will describe the problem in the error case.</span>代わりに、成功したケースで<code>Config</code>インスタンスを含む<code>Result</code>値を返し、エラーの場合の問題を説明することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When <code>Config::new</code> is communicating to <code>main</code> , we can use the <code>Result</code> type to signal there was a problem.</span> <code>Config::new</code>が<code>main</code>と通信しているとき、 <code>Result</code>型を使用して問題があることを伝えることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we can change <code>main</code> to convert an <code>Err</code> variant into a more practical error for our users without the surrounding text about <code>thread &#39;main&#39;</code> and <code>RUST_BACKTRACE</code> that a call to <code>panic€</code> causes.</span>その後、我々は変更することができ<code>main</code>変換すること<code>Err</code>について周囲のテキストなしでユーザーの皆様のために、より実用的なエラーにバリアントを<code>thread &#39;main&#39;</code>と<code>RUST_BACKTRACE</code>呼び出しがする<code>panic€</code>の原因。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-9 shows the changes we need to make to the return value of <code>Config::new</code> and the body of the function needed to return a <code>Result</code> .</span>リスト12-9は、 <code>Config::new</code>戻り値と<code>Result</code>を返すために必要な関数の本体に加えた変更を示しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that this won&#39;t compile until we update <code>main</code> as well, which we&#39;ll do in the next listing.</span>これは<code>main</code>を更新するまでコンパイルされないことに注意してください。これについては次のリストで行います。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="impl Config {"></div><div data-l="    fn new(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {"></div><div data-l="        if args.len() &lt; 3 {"></div><div data-l="            return Err(&quot;not enough arguments&quot;);"></div><div data-l="        }"></div><div data-l=""></div><div data-l="        let query = args[1].clone();"></div><div data-l="        let filename = args[2].clone();"></div><div data-l=""></div><div data-l="        Ok(Config { query, filename })"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-9: Returning a <code>Result</code> from <code>Config::new</code></span></span> <span class=caption>リスト12-9： <code>Config::new</code>からの<code>Result</code>を返す</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Our <code>new</code> function now returns a <code>Result</code> with a <code>Config</code> instance in the success case and a <code>&amp;&#39;static str</code> in the error case.</span>私たちの<code>new</code>機能は今返す<code>Result</code>して<code>Config</code>成功事例とAには、インスタンス<code>&amp;&#39;static str</code>エラーケースに。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Recall from “The Static Lifetime” section in Chapter 10 that <code>&amp;&#39;static str</code> is the type of string literals, which is our error message type for now.</span>第10章の &quot;Static Lifetime&quot;セクションから思い出してください。 <code>&amp;&#39;static str</code>は現在のエラーメッセージタイプである文字列リテラルのタイプです。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve made two changes in the body of the <code>new</code> function: instead of calling <code>panic€</code> when the user doesn&#39;t pass enough arguments, we now return an <code>Err</code> value, and we&#39;ve wrapped the <code>Config</code> return value in an <code>Ok</code> .</span> <code>new</code>関数の本体に2つの変更が加えられました。ユーザーが十分な引数を渡さないときに<code>panic€</code>を呼び出す代わりに、 <code>Err</code>値を返し、 <code>Config</code>戻り値を<code>Ok</code>ラップしました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">These changes make the function conform to its new type signature.</span>これらの変更により、機能は新しいタイプの署名に適合します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Returning an <code>Err</code> value from <code>Config::new</code> allows the <code>main</code> function to handle the <code>Result</code> value returned from the <code>new</code> function and exit the process more cleanly in the error case.</span> <code>Config::new</code>から<code>Err</code>値を返すと、 <code>main</code>関数は<code>new</code>関数から返された<code>Result</code>値を処理し、エラーの場合にはプロセスをよりきれいに終了させることができます。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Calling <code>Config::new</code> and Handling Errors</span> <code>Config::new</code>およびHandlingエラーの呼び出し</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To handle the error case and print a user-friendly message, we need to update <code>main</code> to handle the <code>Result</code> being returned by <code>Config::new</code> , as shown in Listing 12-10.</span>エラーの場合を処理し、わかりやすいメッセージを出力するには、リスト12-10に示すように、 <code>Config::new</code>が返す<code>Result</code>を処理するために<code>main</code>を更新する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll also take the responsibility of exiting the command line tool with a nonzero error code from <code>panic€</code> and implement it by hand.</span>また、コマンドラインツールを終了して、 <code>panic€</code>エラーコードである0以外のエラーコードを手にして、それを実装します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A nonzero exit status is a convention to signal to the process that called our program that the program exited with an error state.</span>ゼロ以外の終了ステータスは、プログラムを呼び出したプロセスに、エラー状態でプログラムが終了したことを通知するための規則です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="use std::process;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let args: Vec&lt;String&gt; = env::args().collect();"></div><div data-l=""></div><div data-l="    let config = Config::new(&amp;args).unwrap_or_else(|err| {"></div><div data-l="        println!(&quot;Problem parsing arguments: {}&quot;, err);"></div><div data-l="        process::exit(1);"></div><div data-l="    });"></div><div data-l=""></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-10: Exiting with an error code if creating a new <code>Config</code> fails</span></span> <span class=caption>リスト12-10：新しい<code>Config</code>作成に失敗した場合のエラーコードでの終了</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In this listing, we&#39;ve used a method we haven&#39;t covered before: <code>unwrap_or_else</code> , which is defined on <code>Result&lt;T, E&gt;</code> by the standard library.</span>このリストでは、これまでに扱っていなかったメソッド、 <code>unwrap_or_else</code>を使用しました。これは、標準ライブラリによって<code>Result&lt;T, E&gt;</code>定義されています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using <code>unwrap_or_else</code> allows us to define some custom, non- <code>panic€</code> error handling.</span>使用<code>unwrap_or_else</code>私たちはいくつかのカスタム、非定義することができます<code>panic€</code>エラー処理を。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the <code>Result</code> is an <code>Ok</code> value, this method&#39;s behavior is similar to <code>unwrap</code> : it returns the inner value <code>Ok</code> is wrapping.</span> <code>Result</code>が<code>Ok</code>値の場合、このメソッドの動作は<code>unwrap</code>似ています。つまり、内部値<code>Ok</code>が折り返しを返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">However, if the value is an <code>Err</code> value, this method calls the code in the <i>closure</i> , which is an anonymous function we define and pass as an argument to <code>unwrap_or_else</code> .</span>しかし、値が<code>Err</code>値の場合、このメソッドは<i>closure</i>のコードを呼び出します。これは、無名関数であり、 <code>unwrap_or_else</code>への引数として<code>unwrap_or_else</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll cover closures in more detail in Chapter 13. For now, you just need to know that <code>unwrap_or_else</code> will pass the inner value of the <code>Err</code> , which in this case is the static string <code>not enough arguments</code> that we added in Listing 12-9, to our closure in the argument <code>err</code> that appears between the vertical pipes.</span>第13章でクロージャについて詳しく説明します。今のところ、 <code>unwrap_or_else</code>は<code>Err</code>内部値を渡すことが<code>unwrap_or_else</code>ます。この場合、リスト12-9で追加した<code>not enough arguments</code>が<code>not enough arguments</code>ている静的な文字列です。垂直パイプの間に現れる引数<code>err</code>クロージャに<code>err</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The code in the closure can then use the <code>err</code> value when it runs.</span>クロージャ内のコードは、実行時に<code>err</code>値を使用できます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve added a new <code>use</code> line to import <code>process</code> from the standard library.</span>標準ライブラリから<code>process</code>をインポート<code>process</code>ための新しい<code>use</code>行を追加しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The code in the closure that will be run in the error case is only two lines: we print the <code>err</code> value and then call <code>process::exit</code> .</span>エラーの場合に実行されるクロージャのコードは2行だけです： <code>err</code>値を出力してから<code>process::exit</code>呼び出し<code>process::exit</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>process::exit</code> function will stop the program immediately and return the number that was passed as the exit status code.</span> <code>process::exit</code>関数はすぐにプログラムを停止し、終了ステータスコードとして渡された番号を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This is similar to the <code>panic€</code> -based handling we used in Listing 12-8, but we no longer get all the extra output.</span>これは、リスト12-8で使用した<code>panic€</code>ベースの処理に似ていますが、余分な出力をすべて得ることはできません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s try it:</span>試してみよう：</span> </p><br><div data-lang=text><div data-l="$ cargo run"></div><div data-l="   Compiling minigrep v0.1.0 (file:///projects/minigrep)"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.48 secs"></div><div data-l="     Running `target/debug/minigrep`"></div><div data-l="Problem parsing arguments: not enough arguments"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Great!</span>すばらしいです！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This output is much friendlier for our users.</span>この出力は、ユーザーにとって非常に面白いです。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Extracting Logic from <code>main</code></span> <code>main</code>からロジックを抽出する</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that we&#39;ve finished refactoring the configuration parsing, let&#39;s turn to the program&#39;s logic.</span>コンフィグレーション解析のリファクタリングが完了したので、プログラムのロジックを見てみましょう。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As we stated in “Separation of Concerns for Binary Projects”, we&#39;ll extract a function named <code>run</code> that will hold all the logic currently in the <code>main</code> function that isn&#39;t involved with setting up configuration or handling errors.</span> 「バイナリプロジェクトの懸念の分離」で述べたように、設定や処理エラーの設定に関係しない<code>main</code>関数内のすべてのロジックを保持する関数<code>run</code>を抽出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When we&#39;re done, <code>main</code> will be concise and easy to verify by inspection, and we&#39;ll be able to write tests for all the other logic.</span>作業が完了したら、 <code>main</code>は簡潔になり、検査で簡単に確認できるようになり、他のすべてのロジックのテストを書くことができます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-11 shows the extracted <code>run</code> function.</span>コードリスト12-11に、抽出された<code>run</code>関数を示します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For now, we&#39;re just making the small, incremental improvement of extracting the function.</span>今のところ、私たちは関数の抽出を少しずつ進めています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re still defining the function in <i>src/main.rs</i> .</span> <i>src / main.rsに</i>関数を定義しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="fn main() {"></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="    println!(&quot;Searching for {}&quot;, config.query);"></div><div data-l="    println!(&quot;In file {}&quot;, config.filename);"></div><div data-l=""></div><div data-l="    run(config);"></div><div data-l=}></div><div data-l=""></div><div data-l="fn run(config: Config) {"></div><div data-l="    let mut f = File::open(config.filename).expect(&quot;file not found&quot;);"></div><div data-l=""></div><div data-l="    let mut contents = String::new();"></div><div data-l="    f.read_to_string(&amp;mut contents)"></div><div data-l="        .expect(&quot;something went wrong reading the file&quot;);"></div><div data-l=""></div><div data-l="    println!(&quot;With text:\n{}&quot;, contents);"></div><div data-l=}></div><div data-l=""></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-11: Extracting a <code>run</code> function containing the rest of the program logic</span></span> <span class=caption>リスト12-11：残りのプログラムロジックを含む<code>run</code>関数の抽出</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>run</code> function now contains all the remaining logic from <code>main</code> , starting from reading the file.</span> <code>run</code>機能には、 <code>main</code>からの残りのロジックがすべてファイルの読み込みから開始されるようになりました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>run</code> function takes the <code>Config</code> instance as an argument.</span> <code>run</code>関数は、 <code>Config</code>インスタンスを引数として取ります。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Returning Errors from the <code>run</code> Function</span> <code>run</code>関数からのエラーの返却</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">With the remaining program logic separated into the <code>run</code> function, we can improve the error handling, as we did with <code>Config::new</code> in Listing 12-9.</span>リスト12-9の<code>Config::new</code>に、残りのプログラムロジックを<code>run</code>関数に分けてエラー処理を改善することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Instead of allowing the program to panic by calling <code>expect</code> , the <code>run</code> function will return a <code>Result&lt;T, E&gt;</code> when something goes wrong.</span> <code>expect</code>を呼び出す<code>expect</code>によってプログラムがパニックに陥るのを防ぐ代わりに、何かがうまくいかないときに<code>run</code>関数は<code>Result&lt;T, E&gt;</code>を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This will let us further consolidate into <code>main</code> the logic around handling errors in a user-friendly way.</span>これにより、ユーザーフレンドリーな方法でエラーを処理するロジックを<code>main</code>ロジックにさらに統合することができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 12-12 shows the changes we need to make to the signature and body of <code>run</code> .</span>コードリスト12-12は、署名と<code>run</code>本体に加えなければならない変更を示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="use std::error::Error;"></div><div data-l=""></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="fn run(config: Config) -&gt; Result&lt;(), Box&lt;Error&gt;&gt; {"></div><div data-l="    let mut f = File::open(config.filename)?;"></div><div data-l=""></div><div data-l="    let mut contents = String::new();"></div><div data-l="    f.read_to_string(&amp;mut contents)?;"></div><div data-l=""></div><div data-l="    println!(&quot;With text:\n{}&quot;, contents);"></div><div data-l=""></div><div data-l="    Ok(())"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-12: Changing the <code>run</code> function to return <code>Result</code></span></span> <span class=caption>リスト12-12： <code>run</code>関数を返す<code>run</code>変更する<code>Result</code></span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve made three significant changes here.</span>ここでは3つの大きな変更を加えました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">First, we changed the return type of the <code>run</code> function to <code>Result&lt;(), Box&lt;Error&gt;&gt;</code> .</span>まず、 <code>run</code>関数の戻り値の型を<code>Result&lt;(), Box&lt;Error&gt;&gt;</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This function previously returned the unit type, <code>()</code> , and we keep that as the value returned in the <code>Ok</code> case.</span>この関数は、以前にユニットタイプ<code>()</code>返しました。そして、それを<code>Ok</code>ケースで返される値として保持します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For the error type, we used the <i>trait object</i> <code>Box&lt;Error&gt;</code> (and we&#39;ve brought <code>std::error::Error</code> into scope with a <code>use</code> statement at the top).</span>エラーの種類については、我々は、 <i>形質オブジェクト</i>を使用<code>Box&lt;Error&gt;</code> （と、私たちは持ってきた<code>std::error::Error</code>でスコープに<code>use</code>先頭に声明）。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll cover trait objects in Chapter 17. For now, just know that <code>Box&lt;Error&gt;</code> means the function will return a type that implements the <code>Error</code> trait, but we don&#39;t have to specify what particular type the return value will be.</span>今のところ、 <code>Box&lt;Error&gt;</code>は、関数が<code>Error</code>特性を実装する型を返すことを意味していますが、戻り値がどのような型になるかを指定する必要はありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This gives us flexibility to return error values that may be of different types in different error cases.</span>これにより、異なるエラーケースで異なるタイプのエラー値を返す柔軟性が得られます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Second, we&#39;ve removed the calls to <code>expect</code> in favor of the <code>?</code></span>第二に、私たちは、そのために<code>expect</code>する呼び出しを削除しました<code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator, as we talked about in Chapter 9. Rather than <code>panic€</code> on an error, the <code>?</code></span>私たちが第9章でお話したように、オペレータは、エラーで<code>panic€</code>はなく、 <code>?</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">operator will return the error value from the current function for the caller to handle.</span>演算子は、現在の関数からエラー値を返し、呼び出し元が処理します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Third, the <code>run</code> function now returns an <code>Ok</code> value in the success case.</span>第3に、 <code>run</code>関数は成功のケースで<code>Ok</code>値を返すようになりました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve declared the <code>run</code> function&#39;s success type as <code>()</code> in the signature, which means we need to wrap the unit type value in the <code>Ok</code> value.</span> <code>run</code>関数の成功型をシグネチャに<code>()</code>として宣言しました。つまり、ユニット型の値を<code>Ok</code>値にラップする必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This <code>Ok(())</code> syntax might look a bit strange at first, but using <code>()</code> like this is the idiomatic way to indicate that we&#39;re calling <code>run</code> for its side effects only;</span>この<code>Ok(())</code>構文は最初はちょっと変わって見えるかもしれませんが、このように<code>()</code>を使うと、副作用だけを<code>run</code>と呼ぶことを示す慣用的な方法です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">it doesn&#39;t return a value we need.</span>必要な値を返しません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When you run this code, it will compile but will display a warning:</span>このコードを実行するとコンパイルされますが、警告が表示されます：</span> </p><br><div data-lang=text><div data-l="warning: unused `std::result::Result` which must be used"></div><div data-l="  --&gt; src/main.rs:18:5"></div><div data-l="   |"></div><div data-l="18 |     run(config);"></div><div data-l="   |     ^^^^^^^^^^^^"></div><div data-l="= note: #[warn(unused_must_use)] on by default"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rust tells us that our code ignored the <code>Result</code> value and the <code>Result</code> value might indicate that an error occurred.</span>錆は、私たちのコードが無視されていることを教えてくれる<code>Result</code>値をと<code>Result</code>値は、エラーが発生したことを示している可能性があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">But we&#39;re not checking to see whether or not there was an error, and the compiler reminds us that we probably meant to have some error-handling code here!</span>しかし、エラーがあったかどうかを確認するのではなく、コンパイラはおそらくここでエラー処理コードをいくつか持っていることを思い出させます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s rectify that problem now.</span>今問題を解決しよう。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Handling Errors Returned from <code>run</code> in <code>main</code></span> <code>main</code> <code>run</code>れたときに返されるエラーの処理</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll check for errors and handle them using a technique similar to one we used with <code>Config::new</code> in Listing 12-10, but with a slight difference:</span>コードリスト12-10の<code>Config::new</code>で使用したのと似たテクニックを使用してエラーをチェックして処理しますが、わずかな違いがあります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="fn main() {"></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="    println!(&quot;Searching for {}&quot;, config.query);"></div><div data-l="    println!(&quot;In file {}&quot;, config.filename);"></div><div data-l=""></div><div data-l="    if let Err(e) = run(config) {"></div><div data-l="        println!(&quot;Application error: {}&quot;, e);"></div><div data-l=""></div><div data-l="        process::exit(1);"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We use <code>if let</code> rather than <code>unwrap_or_else</code> to check whether <code>run</code> returns an <code>Err</code> value and call <code>process::exit(1)</code> if it does.</span> <code>unwrap_or_else</code>ではなく<code>if let</code>を使用して<code>if let</code> <code>run</code>が<code>Err</code>値を返すかどうかをチェックし、 <code>unwrap_or_else</code> <code>if let</code> <code>process::exit(1)</code>を呼び出し<code>process::exit(1)</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>run</code> function doesn&#39;t return a value that we want to <code>unwrap</code> in the same way that <code>Config::new</code> returns the <code>Config</code> instance.</span> <code>run</code>関数は、 <code>Config::new</code>が<code>Config</code>インスタンスを返すのと同じ方法で、 <code>unwrap</code>したい値を返しません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Because <code>run</code> returns <code>()</code> in the success case, we only care about detecting an error, so we don&#39;t need <code>unwrap_or_else</code> to return the unwrapped value because it would only be <code>()</code> .</span>ので<code>run</code>リターン<code>()</code>成功の場合は、我々は唯一のエラーを検出する気に、私たちは必要ありません<code>unwrap_or_else</code>それだけになるので開封された値を返すために<code>()</code></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The bodies of the <code>if let</code> and the <code>unwrap_or_else</code> functions are the same in both cases: we print the error and exit.</span> <code>if let</code>と<code>unwrap_or_else</code>関数の本体は、どちらの場合も同じです。エラーを出力して終了します。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Splitting Code into a Library Crate</span>コードをライブラリクレートに分割する</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Our <code>minigrep</code> project is looking good so far!</span>私たちの<code>minigrep</code>プロジェクトは今のところよく見ています！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now we&#39;ll split the <i>src/main.rs</i> file and put some code into the <i>src/lib.rs</i> file so we can test it and have a <i>src/main.rs</i> file with fewer responsibilities.</span>今、私たちは<i>、SRC / main.rsファイル</i>を分割し、我々はそれをテストし<i>、SRC / main.rsが</i>少ない責任を持つファイル持つことができるように、ファイル<i>のsrc / lib.rs</i>にいくつかのコードを配置します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s move all the code that isn&#39;t the <code>main</code> function from <i>src/main.rs</i> to <i>src/lib.rs</i> :</span>のではないすべてのコードを移動してみましょう<code>main</code> <i>のsrc / lib.rs</i>へ<i>のsrc / main.rs</i>から機能を：</span> </p><br><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>run</code> function definition</span> <code>run</code>関数定義</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The relevant <code>use</code> statements</span>関連する<code>use</code>声明</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The definition of <code>Config</code></span> <code>Config</code>の定義</span> </div><div data-b=*> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>Config::new</code> function definition</span> <code>Config::new</code>関数定義</span> </div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The contents of <i>src/lib.rs</i> should have the signatures shown in Listing 12-13 (we&#39;ve omitted the bodies of the functions for brevity).</span> <i>src / lib.rs</i>の内容は、リスト12-13に示すシグネチャを持つ必要があります（簡略化のために関数の本体は省略しています）。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that this won&#39;t compile until we modify <i>src/main.rs</i> in Listing 12-14.</span>これはリスト12-14の<i>src / main.rs</i>を変更するまでコンパイルされないことに注意してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="use std::error::Error;"></div><div data-l="use std::fs::File;"></div><div data-l="use std::io::prelude::*;"></div><div data-l=""></div><div data-l="pub struct Config {"></div><div data-l="    pub query: String,"></div><div data-l="    pub filename: String,"></div><div data-l=}></div><div data-l=""></div><div data-l="impl Config {"></div><div data-l="    pub fn new(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {"></div><div data-l="#        // --snip--"></div><div data-l="        // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l="    }"></div><div data-l=}></div><div data-l=""></div><div data-l="pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;Error&gt;&gt; {"></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-13: Moving <code>Config</code> and <code>run</code> into <i>src/lib.rs</i></span></span> <span class=caption>リスト12-13： <code>Config</code>を移動して<i>src / lib.rsに</i> <code>run</code>する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve made liberal use of the <code>pub</code> keyword: on <code>Config</code> , on its fields and its <code>new</code> method, and on the <code>run</code> function.</span>私たちは、 <code>Config</code> 、そのフィールドとその<code>new</code>メソッド、および<code>run</code>関数について<code>pub</code>キーワードを自由に使用しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We now have a library crate that has a public API that we can test!</span>私たちは現在、テストできる公開APIを持った図書館箱を持っています！</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now we need to bring the code we moved to <i>src/lib.rs</i> into the scope of the binary crate in <i>src/main.rs</i> , as shown in Listing 12-14.</span>リスト12-14に示すように、 <i>src / main.rs</i>内のバイナリ<i>・キュー</i>のスコープに<i>src / lib.rs</i>に移動したコードを持たせる必要があります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="extern crate minigrep;"></div><div data-l=""></div><div data-l="use std::env;"></div><div data-l="use std::process;"></div><div data-l=""></div><div data-l="use minigrep::Config;"></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="#    // --snip--"></div><div data-l="    // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l="    if let Err(e) = minigrep::run(config) {"></div><div data-l="#        // --snip--"></div><div data-l="        // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-14: Bringing the <code>minigrep</code> crate into the scope of <i>src/main.rs</i></span></span> <span class=caption>リスト12-14： <code>minigrep</code>を<i>src / main.rsの</i>スコープに<i>持ち込む</i></span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To bring the library crate into the binary crate, we use <code>extern crate minigrep</code> .</span>ライブラリクレートをバイナリクレートに持ち込むために、 <code>extern crate minigrep</code>を使用します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we add a <code>use minigrep::Config</code> line to bring the <code>Config</code> type into scope, and we prefix the <code>run</code> function with our crate name.</span>次に、 <code>use minigrep::Config</code>行を<code>use minigrep::Config</code>て<code>Config</code>タイプを有効範囲に追加し、 <code>run</code>関数の頭に名前を付けます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now all the functionality should be connected and should work.</span>今、すべての機能が接続され、動作するはずです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Run the program with <code>cargo run</code> and make sure everything works correctly.</span>でプログラムを実行し<code>cargo run</code>し、すべてが正常に動作することを確認してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Whew!</span>すごい！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">That was a lot of work, but we&#39;ve set ourselves up for success in the future.</span>それはたくさんの仕事でしたが、私たちは将来の成功のために自分を決めました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now it&#39;s much easier to handle errors, and we&#39;ve made the code more modular.</span>今度はエラーを処理する方がはるかに簡単で、コードをモジュール化しました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Almost all of our work will be done in <i>src/lib.rs</i> from here on out.</span>ほとんどの作業はここから<i>src / lib.rs</i>で行われます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s take advantage of this newfound modularity by doing something that would have been difficult with the old code but is easy with the new code: we&#39;ll write some tests!</span>古いコードでは難しかったが、新しいコードでは簡単なことを行うことで、この新しいモジュール性を利用しよう：我々はいくつかのテストを書くだろう！</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch12-03-improving-error-handling-and-modularity.html');});</script>