<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch12-05-working-with-environment-variables.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Working with Environment Variables</span>環境変数の操作</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll improve <code>minigrep</code> by adding an extra feature: an option for case-insensitive searching that the user can turn on via an environment variable.</span>特別な機能を追加することで<code>minigrep</code>を改善します：大文字と小文字を区別しない検索のオプションで、ユーザーが環境変数で有効にすることができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We could make this feature a command line option and require that users enter it each time they want it to apply, but instead we&#39;ll use an environment variable.</span>この機能をコマンドラインオプションにすることができ、ユーザーが適用するたびに入力する必要がありますが、代わりに環境変数を使用します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Doing so allows our users to set the environment variable once and have all their searches be case insensitive in that terminal session.</span>そうすることで、ユーザーは環境変数を一度設定し、すべての検索でそのターミナルセッションで大文字と小文字を区別することができます。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Writing a Failing Test for the Case-Insensitive <code>search</code> Function</span>大文字と小文字を区別しない<code>search</code>機能の失敗テストの作成</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We want to add a new <code>search_case_insensitive</code> function that we&#39;ll call when the environment variable is on.</span>環境変数がオンのときに呼び出す新しい<code>search_case_insensitive</code>関数を追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll continue to follow the TDD process, so the first step is again to write a failing test.</span>私たちはTDDプロセスに従い続けますので、最初のステップは失敗したテストを書き直すことです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ll add a new test for the new <code>search_case_insensitive</code> function and rename our old test from <code>one_result</code> to <code>case_sensitive</code> to clarify the differences between the two tests, as shown in Listing 12-20.</span>リスト12-20に示すように、新しい<code>search_case_insensitive</code>関数の新しいテストを追加し、古いテストの名前を<code>one_result</code>から<code>case_sensitive</code>に変更して、2つのテストの違いを明確にします。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l=#[cfg(test)]></div><div data-l="mod test {"></div><div data-l="    use super::*;"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn case_sensitive() {"></div><div data-l="        let query = &quot;duct&quot;;"></div><div data-l="        let contents = &quot;\"></div><div data-l=Rust:></div><div data-l="safe, fast, productive."></div><div data-l="Pick three."></div><div data-l="Duct tape.&quot;;"></div><div data-l=""></div><div data-l="        assert_eq!("></div><div data-l="            vec![&quot;safe, fast, productive.&quot;],"></div><div data-l="            search(query, contents)"></div><div data-l="        );"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    #[test]"></div><div data-l="    fn case_insensitive() {"></div><div data-l="        let query = &quot;rUsT&quot;;"></div><div data-l="        let contents = &quot;\"></div><div data-l=Rust:></div><div data-l="safe, fast, productive."></div><div data-l="Pick three."></div><div data-l="Trust me.&quot;;"></div><div data-l=""></div><div data-l="        assert_eq!("></div><div data-l="            vec![&quot;Rust:&quot;, &quot;Trust me.&quot;],"></div><div data-l="            search_case_insensitive(query, contents)"></div><div data-l="        );"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-20: Adding a new failing test for the case-insensitive function we&#39;re about to add</span></span> <span class=caption>リスト12-20：追加しようとしている大文字と小文字を区別しない関数のための新しい失敗テストを追加する</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that we&#39;ve edited the old test&#39;s <code>contents</code> too.</span>古いテストの<code>contents</code>も編集していることに注意してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;ve added a new line with the text <code>&quot;Duct tape.&quot;</code></span>テキストに<code>&quot;Duct tape.&quot;</code>という新しい行が追加されました<code>&quot;Duct tape.&quot;</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">using a capital D that shouldn&#39;t match the query <code>&quot;duct&quot;</code> when we&#39;re searching in a case-sensitive manner.</span>大文字と小文字を区別して検索する際に、 <code>&quot;duct&quot;</code>というクエリと一致しない大文字のDを使用します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Changing the old test in this way helps ensure that we don&#39;t accidentally break the case-sensitive search functionality that we&#39;ve already implemented.</span>このように古いテストを変更することで、すでに実装されている大文字と小文字を区別した検索機能を誤って破損しないようになります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This test should pass now and should continue to pass as we work on the case-insensitive search.</span>このテストは今すぐ通過し、大文字と小文字を区別しない検索に取り組んでいきます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The new test for the case- <i>insensitive</i> search uses <code>&quot;rUsT&quot;</code> as its query.</span>大文字と<i>小文字を区別しない</i>検索の新しいテストでは、クエリとして<code>&quot;rUsT&quot;</code>使用されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In the <code>search_case_insensitive</code> function we&#39;re about to add, the query <code>&quot;rUsT&quot;</code> should match the line containing <code>&quot;Rust:&quot;</code> with a capital R and match the line <code>&quot;Trust me.&quot;</code></span>私たちが追加しようとしている<code>search_case_insensitive</code>関数では、クエリ<code>&quot;rUsT&quot;</code>は<code>&quot;Rust:&quot;</code>を含む行と大文字Rを一致させ、 <code>&quot;Trust me.&quot;</code>という行に一致する必要があり<code>&quot;Trust me.&quot;</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">even though both have different casing than the query.</span>どちらもクエリーとは異なるケーシングを持っています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This is our failing test, and it will fail to compile because we haven&#39;t yet defined the <code>search_case_insensitive</code> function.</span>これは失敗テストですが、 <code>search_case_insensitive</code>関数をまだ定義していないため、コンパイルに失敗します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Feel free to add a skeleton implementation that always returns an empty vector, similar to the way we did for the <code>search</code> function in Listing 12-16 to see the test compile and fail.</span>リスト12-16の<code>search</code>関数の場合と同様に、空のベクトルを返すスケルトン実装を自由に追加して、テストのコンパイルと失敗を確認してください。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Implementing the <code>search_case_insensitive</code> Function</span> <code>search_case_insensitive</code>関数の実装</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>search_case_insensitive</code> function, shown in Listing 12-21, will be almost the same as the <code>search</code> function.</span>リスト12-21に示す<code>search_case_insensitive</code>関数は、 <code>search</code>関数とほぼ同じです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The only difference is that we&#39;ll lowercase the <code>query</code> and each <code>line</code> so whatever the case of the input arguments, they&#39;ll be the same case when we check whether the line contains the query.</span>唯一の違いは、小文字だろうということで<code>query</code>と各<code>line</code>ので、我々は行がクエリが含まれているかどうかをチェックするときどんな入力引数の場合、それらは同じケースになるでしょう。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="pub fn search_case_insensitive&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="    let query = query.to_lowercase();"></div><div data-l="    let mut results = Vec::new();"></div><div data-l=""></div><div data-l="    for line in contents.lines() {"></div><div data-l="        if line.to_lowercase().contains(&amp;query) {"></div><div data-l="            results.push(line);"></div><div data-l="        }"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    results"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-21: Defining the <code>search_case_insensitive</code> function to lowercase the query and the line before comparing them</span></span> <span class=caption>リスト12-21： <code>search_case_insensitive</code>関数を定義して照会とその行を比較する前に小文字にする</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">First, we lowercase the <code>query</code> string and store it in a shadowed variable with the same name.</span>まず、 <code>query</code>文字列を小文字にして、同じ名前の影付き変数に格納し<code>query</code> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Calling <code>to_lowercase</code> on the query is necessary so no matter whether the user&#39;s query is <code>&quot;rust&quot;</code> , <code>&quot;RUST&quot;</code> , <code>&quot;Rust:&quot;</code> , or <code>&quot;rUsT&quot;</code> , we&#39;ll treat the query as if it were <code>&quot;rust&quot;</code> and be insensitive to the case.</span>クエリで<code>to_lowercase</code>を呼び出す必要があるので、ユーザーのクエリが<code>&quot;rust&quot;</code> 、 <code>&quot;RUST&quot;</code> 、 <code>&quot;Rust:&quot;</code> 、 <code>&quot;rUsT&quot;</code>いずれのクエリであっても、クエリは<code>&quot;rust&quot;</code>であるかのように扱われますケース。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that <code>query</code> is now a <code>String</code> rather than a string slice, because calling <code>to_lowercase</code> creates new data rather than referencing existing data.</span>その注意<code>query</code>今ある<code>String</code>を呼び出すためではなく、文字列スライス<code>to_lowercase</code> 、既存のデータを参照するのではなく、新しいデータを作成します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Say the query is <code>&quot;rUsT&quot;</code> , as an example: that string slice doesn&#39;t contain a lowercase <code>u</code> or <code>t</code> for us to use, so we have to allocate a new <code>String</code> containing <code>&quot;rust&quot;</code> .</span>クエリが<code>&quot;rUsT&quot;</code>であるとしましょう。つまり、文字列スライスには使用する小文字の<code>u</code>または<code>t</code>が含まれていないので、 <code>&quot;rust&quot;</code>を含む新しい<code>String</code>を割り当てる必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When we pass <code>query</code> as an argument to the <code>contains</code> method now, we need to add an ampersand because the signature of <code>contains</code> is defined to take a string slice.</span>我々が通過すると<code>query</code>引数として<code>contains</code>今の方法を、私たちはの署名ので、アンパサンドを追加する必要が<code>contains</code> 、文字列のスライスを取るように定義されています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Next, we add a call to <code>to_lowercase</code> on each <code>line</code> before we check whether it contains <code>query</code> to lowercase all characters.</span>次に、我々はの呼び出しを追加<code>to_lowercase</code>それぞれに<code>line</code>我々はそれが含まれているかどうかを確認する前に、 <code>query</code>すべての文字を小文字に。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that we&#39;ve converted <code>line</code> and <code>query</code> to lowercase, we&#39;ll find matches no matter what the case of the query is.</span> <code>line</code>と<code>query</code>を小文字に変換したので、 <code>query</code>大文字と小文字は関係ありません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s see if this implementation passes the tests:</span>この実装がテストに合格したかどうかを見てみましょう：</span> </p><br><div data-lang=text><div data-l="running 2 tests"></div><div data-l="test test::case_insensitive ... ok"></div><div data-l="test test::case_sensitive ... ok"></div><div data-l=""></div><div data-l="test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Great!</span>すばらしいです！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">They passed.</span>彼らは合格した。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now, let&#39;s call the new <code>search_case_insensitive</code> function from the <code>run</code> function.</span>それでは、新しい呼びましょう<code>search_case_insensitive</code>から機能を<code>run</code>機能。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">First, we&#39;ll add a configuration option to the <code>Config</code> struct to switch between case-sensitive and case-insensitive search.</span>まず、 <code>Config</code>構造体に構成オプションを追加して、大文字小文字の区別と大/小文字を区別しない検索を切り替えます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Adding this field will cause compiler errors because we aren&#39;t initializing this field anywhere yet:</span>このフィールドを追加すると、このフィールドはまだどこにでも初期化されていないため、コンパイラエラーが発生します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="pub struct Config {"></div><div data-l="    pub query: String,"></div><div data-l="    pub filename: String,"></div><div data-l="    pub case_sensitive: bool,"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that we added the <code>case_sensitive</code> field that holds a Boolean.</span>ブール値を保持する<code>case_sensitive</code>フィールドを追加したことに注意してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Next, we need the <code>run</code> function to check the <code>case_sensitive</code> field&#39;s value and use that to decide whether to call the <code>search</code> function or the <code>search_case_insensitive</code> function, as shown in Listing 12-22.</span>次に、 <code>run</code>関数を使用して<code>case_sensitive</code>フィールドの値をチェックし、それを使用して<code>search</code>関数または<code>search_case_insensitive</code>関数を呼び出すかどうかを決定します（ <code>search_case_insensitive</code>リスト12-22を参照）。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note this still won&#39;t compile yet.</span>これはまだコンパイルされないことに注意してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="# use std::error::Error;"></div><div data-l="# use std::fs::File;"></div><div data-l="# use std::io::prelude::*;"></div><div data-l=#></div><div data-l="# fn search&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="#      vec![]"></div><div data-l="# }"></div><div data-l=#></div><div data-l="# pub fn search_case_insensitive&lt;'a&gt;(query: &amp;str, contents: &amp;'a str) -&gt; Vec&lt;&amp;'a str&gt; {"></div><div data-l="#      vec![]"></div><div data-l="# }"></div><div data-l=#></div><div data-l="# struct Config {"></div><div data-l="#     query: String,"></div><div data-l="#     filename: String,"></div><div data-l="#     case_sensitive: bool,"></div><div data-l="# }"></div><div data-l=#></div><div data-l="pub fn run(config: Config) -&gt; Result&lt;(), Box&lt;Error&gt;&gt; {"></div><div data-l="    let mut f = File::open(config.filename)?;"></div><div data-l=""></div><div data-l="    let mut contents = String::new();"></div><div data-l="    f.read_to_string(&amp;mut contents)?;"></div><div data-l=""></div><div data-l="    let results = if config.case_sensitive {"></div><div data-l="        search(&amp;config.query, &amp;contents)"></div><div data-l="    } else {"></div><div data-l="        search_case_insensitive(&amp;config.query, &amp;contents)"></div><div data-l="    };"></div><div data-l=""></div><div data-l="    for line in results {"></div><div data-l="        println!(&quot;{}&quot;, line);"></div><div data-l="    }"></div><div data-l=""></div><div data-l="    Ok(())"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-22: Calling either <code>search</code> or <code>search_case_insensitive</code> based on the value in <code>config.case_sensitive</code></span></span> <span class=caption>リスト12-22： <code>config.case_sensitive</code>の値に基づいて<code>search</code>または<code>search_case_insensitive</code>を呼び出す</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Finally, we need to check for the environment variable.</span>最後に、環境変数を確認する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The functions for working with environment variables are in the <code>env</code> module in the standard library, so we want to bring that module into scope with a <code>use std::env;</code></span>環境変数を扱うための関数は、標準ライブラリの<code>env</code>モジュールにあるので、 <code>use std::env;</code>してそのモジュールをスコープに入れたいと思っています<code>use std::env;</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">line at the top of <i>src/lib.rs</i> .</span> <i>src / lib.rsの</i>先頭にある行。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Then we&#39;ll use the <code>var</code> function from the <code>env</code> module to check for an environment variable named <code>CASE_INSENSITIVE</code> , as shown in Listing 12-23.</span>次に、 <code>env</code>モジュールの<code>var</code>関数を使用して、 <code>CASE_INSENSITIVE</code>という名前の環境変数をチェックします（ <code>CASE_INSENSITIVE</code>リスト12-23を参照）。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/lib.rs</span></span> <span class=filename>ファイル名：src / lib.rs</span></span> </p><br><div data-lang=rust><div data-l="use std::env;"></div><div data-l="# struct Config {"></div><div data-l="#     query: String,"></div><div data-l="#     filename: String,"></div><div data-l="#     case_sensitive: bool,"></div><div data-l="# }"></div><div data-l=""></div><div data-l="#// --snip--"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">--snip--</span> --snip--</span> </div><div data-l=""></div><div data-l="impl Config {"></div><div data-l="    pub fn new(args: &amp;[String]) -&gt; Result&lt;Config, &amp;'static str&gt; {"></div><div data-l="        if args.len() &lt; 3 {"></div><div data-l="            return Err(&quot;not enough arguments&quot;);"></div><div data-l="        }"></div><div data-l=""></div><div data-l="        let query = args[1].clone();"></div><div data-l="        let filename = args[2].clone();"></div><div data-l=""></div><div data-l="        let case_sensitive = env::var(&quot;CASE_INSENSITIVE&quot;).is_err();"></div><div data-l=""></div><div data-l="        Ok(Config { query, filename, case_sensitive })"></div><div data-l="    }"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 12-23: Checking for an environment variable named <code>CASE_INSENSITIVE</code></span></span> <span class=caption>リスト12-23： <code>CASE_INSENSITIVE</code>という名前の環境変数をチェックする</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Here, we create a new variable <code>case_sensitive</code> .</span>ここでは、 <code>case_sensitive</code>という新しい変数を作成します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To set its value, we call the <code>env::var</code> function and pass it the name of the <code>CASE_INSENSITIVE</code> environment variable.</span>その値を設定するには、 <code>env::var</code>関数を呼び出して、 <code>CASE_INSENSITIVE</code>環境変数の名前を<code>CASE_INSENSITIVE</code>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>env::var</code> function returns a <code>Result</code> that will be the successful <code>Ok</code> variant that contains the value of the environment variable if the environment variable is set.</span> <code>env::var</code>関数は、環境変数が設定されている場合、環境変数の値を含む成功した<code>Ok</code>バリアントになる<code>Result</code>を返します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It will return the <code>Err</code> variant if the environment variable is not set.</span>環境変数が設定されていない場合、 <code>Err</code>バリアントが返されます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re using the <code>is_err</code> method on the <code>Result</code> to check whether it&#39;s an error and therefore unset, which means it <i>should</i> do a case-sensitive search.</span> <code>Result</code>上で<code>is_err</code>メソッドを使用してエラーであるかどうかをチェックしています。つまり、大文字と小文字を区別して検索する<i>必要</i>があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If the <code>CASE_INSENSITIVE</code> environment variable is set to anything, <code>is_err</code> will return false and the program will perform a case-insensitive search.</span> <code>CASE_INSENSITIVE</code>環境変数が何かに設定されている場合、 <code>is_err</code>はfalseを返し、プログラムは大文字と小文字を区別しない検索を実行します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We don&#39;t care about the <i>value</i> of the environment variable, just whether it&#39;s set or unset, so we&#39;re checking <code>is_err</code> rather than using <code>unwrap</code> , <code>expect</code> , or any of the other methods we&#39;ve seen on <code>Result</code> .</span>我々は、それが設定または設定解除ちょうどかどうか、環境変数の<i>値</i>を気にしないので、我々はチェックしている<code>is_err</code>ではなく、使用して<code>unwrap</code> 、 <code>expect</code> 、あるいは我々が上で見てきた他の方法のいずれかの<code>Result</code> 。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We pass the value in the <code>case_sensitive</code> variable to the <code>Config</code> instance so the <code>run</code> function can read that value and decide whether to call <code>search</code> or <code>search_case_insensitive</code> , as we implemented in Listing 12-22.</span>リスト12-22で実装したように、 <code>run</code>関数がその値を読み取って<code>search</code>または<code>search_case_insensitive</code>を呼び出すかどうかを判断できるように、 <code>case_sensitive</code>変数の値を<code>Config</code>インスタンスに<code>search_case_insensitive</code>ます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Let&#39;s give it a try!</span>やるだけやってみよう！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">First, we&#39;ll run our program without the environment variable set and with the query <code>to</code> , which should match any line that contains the word “to” in all lowercase:</span>まず、環境変数を設定せずにクエリ<code>to</code>使用<code>to</code>てプログラムを実行します。これは &quot;to&quot;という単語を含む行とすべて小文字で一致します。</span> </p><br><div data-lang=text><div data-l="$ cargo run to poem.txt"></div><div data-l="   Compiling minigrep v0.1.0 (file:///projects/minigrep)"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs"></div><div data-l="     Running `target/debug/minigrep to poem.txt`"></div><div data-l="Are you nobody, too?"></div><div data-l="How dreary to be somebody!"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Looks like that still works!</span>それはまだ動作するように見えます！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now, let&#39;s run the program with <code>CASE_INSENSITIVE</code> set to <code>1</code> but with the same query <code>to</code> .</span>さて、 <code>CASE_INSENSITIVE</code>を<code>1</code>設定して、同じクエリ<code>to</code>使ってプログラムを実行しましょう。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If you&#39;re using PowerShell, you will need to set the environment variable and run the program in two commands rather than one:</span> PowerShellを使用している場合は、環境変数を設定し、プログラムを1つではなく2つのコマンドで実行する必要があります。</span> </p><br><div data-lang=text><div data-l="$ $env:CASE_INSENSITIVE=1"></div><div data-l="$ cargo run to poem.txt"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We should get lines that contain “to” that might have uppercase letters:</span>大文字の &quot;to&quot;を含む行を取得する必要があります。</span> </p><br><div data-lang=text><div data-l="$ CASE_INSENSITIVE=1 cargo run to poem.txt"></div><div data-l="    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs"></div><div data-l="     Running `target/debug/minigrep to poem.txt`"></div><div data-l="Are you nobody, too?"></div><div data-l="How dreary to be somebody!"></div><div data-l="To tell your name the livelong day"></div><div data-l="To an admiring bog!"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Excellent, we also got lines containing “To”!</span>優秀、私たちはまた、 &quot;To&quot;を含む行を持っています！</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Our <code>minigrep</code> program can now do case-insensitive searching controlled by an environment variable.</span>私たちの<code>minigrep</code>プログラムは、環境変数によって制御される大文字と小文字を区別しない検索を行うことができます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now you know how to manage options set using either command line arguments or environment variables.</span>コマンドライン引数または環境変数のいずれかを使用して設定されたオプションを管理する方法が分かりました。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Some programs allow arguments <i>and</i> environment variables for the same configuration.</span>プログラムによっては、同じ構成に対して引数<i>と</i>環境変数を使用できるものが<i>あり</i>ます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In those cases, the programs decide that one or the other takes precedence.</span>そのような場合、プログラムはどちらか一方が優先されると判断します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For another exercise on your own, try controlling case insensitivity through either a command line argument or an environment variable.</span>あなた自身の別の練習問題については、コマンドライン引数か環境変数のどちらかで大文字と小文字の区別を制御してみてください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Decide whether the command line argument or the environment variable should take precedence if the program is run with one set to case sensitive and one set to case insensitive.</span>プログラムが、大文字小文字を区別するように設定し、大文字小文字を区別しないで実行する場合は、コマンドライン引数または環境変数を優先するかどうかを決定します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>std::env</code> module contains many more useful features for dealing with environment variables: check out its documentation to see what is available.</span> <code>std::env</code>モジュールには、環境変数を扱うためのより多くの便利な機能が含まれています。</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch12-05-working-with-environment-variables.html');});</script>