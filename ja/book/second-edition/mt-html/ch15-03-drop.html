<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180709_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=ch15-03-drop.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Running Code on Cleanup with the <code>Drop</code> Trait</span> <code>Drop</code> Traitによるクリーンアップ時のコード実行</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The second trait important to the smart pointer pattern is <code>Drop</code> , which lets you customize what happens when a value is about to go out of scope.</span>スマートポインタパターンにとって重要な第2の特性は、 <code>Drop</code> 。これにより、値が範囲外になるときの処理をカスタマイズできます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You can provide an implementation for the <code>Drop</code> trait on any type, and the code you specify can be used to release resources like files or network connections.</span>任意のタイプの<code>Drop</code>特性の実装を提供できます。指定したコードを使用して、ファイルやネットワーク接続などのリソースを解放できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re introducing <code>Drop</code> in the context of smart pointers because the functionality of the <code>Drop</code> trait is almost always used when implementing a smart pointer.</span>スマートポインタを実装するときは、 <code>Drop</code>特性の機能がほとんど常に使用されるため、スマートポインタのコンテキストで<code>Drop</code>を導入しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">For example, <code>Box&lt;T&gt;</code> customizes <code>Drop</code> to deallocate the space on the heap that the box points to.</span>たとえば、 <code>Box&lt;T&gt;</code>は、ボックスが指すヒープ上のスペースを解放するために、 <code>Drop</code>をカスタマイズします。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In some languages, the programmer must call code to free memory or resources every time they finish using an instance of a smart pointer.</span>いくつかの言語では、スマートポインタのインスタンスを使用するたびにメモリまたはリソースを解放するコードをプログラマが呼び出さなければなりません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If they forget, the system might become overloaded and crash.</span>彼らが忘れると、システムが過負荷になりクラッシュする可能性があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In Rust, you can specify that a particular bit of code be run whenever a value goes out of scope, and the compiler will insert this code automatically.</span> Rustでは、値が範囲外になるたびに特定のビットのコードを実行するように指定することができ、コンパイラはこのコードを自動的に挿入します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As a result, you don&#39;t need to be careful about placing cleanup code everywhere in a program that an instance of a particular type is finished with—you still won&#39;t leak resources!</span>その結果、特定のタイプのインスタンスが終了したプログラムのどこにでもクリーンアップコードを配置することに注意する必要はありません。リソースはまだ漏れません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Specify the code to run when a value goes out of scope by implementing the <code>Drop</code> trait.</span> <code>Drop</code>特性を実装して値が範囲外になったときに実行するコードを指定します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>Drop</code> trait requires you to implement one method named <code>drop</code> that takes a mutable reference to <code>self</code> .</span> <code>Drop</code>特性では、 <code>self</code>への変更可能な参照を取る<code>drop</code>という名前のメソッドを実装する必要があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To see when Rust calls <code>drop</code> , let&#39;s implement <code>drop</code> with <code>println€</code> statements for now.</span> Rustの呼び出しがいつ<code>drop</code>を見るには、 <code>println€</code>文を使って<code>drop</code>を実装しましょう。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Listing 15-14 shows a <code>CustomSmartPointer</code> struct whose only custom functionality is that it will print <code>Dropping CustomSmartPointer€</code> when the instance goes out of scope.</span> <code>CustomSmartPointer</code>リスト15-14は、 <code>CustomSmartPointer</code>構造体を示しています。 <code>CustomSmartPointer</code>構造体は、インスタンスがスコープ外に出たときに<code>Dropping CustomSmartPointer€</code>するカスタム機能のみを<code>Dropping CustomSmartPointer€</code>ています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This example demonstrates when Rust runs the <code>drop</code> function.</span>この例は、Rustが<code>drop</code>関数を実行するときを示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust><div data-l="struct CustomSmartPointer {"></div><div data-l="    data: String,"></div><div data-l=}></div><div data-l=""></div><div data-l="impl Drop for CustomSmartPointer {"></div><div data-l="    fn drop(&amp;mut self) {"></div><div data-l="        println!(&quot;Dropping CustomSmartPointer with data `{}`!&quot;, self.data);"></div><div data-l="    }"></div><div data-l=}></div><div data-l=""></div><div data-l="fn main() {"></div><div data-l="    let c = CustomSmartPointer { data: String::from(&quot;my stuff&quot;) };"></div><div data-l="    let d = CustomSmartPointer { data: String::from(&quot;other stuff&quot;) };"></div><div data-l="    println!(&quot;CustomSmartPointers created.&quot;);"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 15-14: A <code>CustomSmartPointer</code> struct that implements the <code>Drop</code> trait where we would put our cleanup code</span></span> <span class=caption>リスト15-14：クリーンアップコードを置く<code>Drop</code>特性を実装する<code>CustomSmartPointer</code>構造体</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>Drop</code> trait is included in the prelude, so we don&#39;t need to import it.</span> <code>Drop</code>特性はプレリュードに含まれているので、インポートする必要はありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We implement the <code>Drop</code> trait on <code>CustomSmartPointer</code> and provide an implementation for the <code>drop</code> method that calls <code>println€</code> .</span> <code>CustomSmartPointer</code> <code>Drop</code>特性を実装し、 <code>println€</code>を呼び出す<code>drop</code>メソッドの実装を提供します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The body of the <code>drop</code> function is where you would place any logic that you wanted to run when an instance of your type goes out of scope.</span> <code>drop</code>関数の本体は、タイプのインスタンスが範囲外になるときに実行したいロジックを配置する場所です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We&#39;re printing some text here to demonstrate when Rust will call <code>drop</code> .</span>私たちは、錆が呼び出す際に証明するためにここにいくつかのテキストを印刷している<code>drop</code> 。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In <code>main</code> , we create two instances of <code>CustomSmartPointer</code> and then print <code>CustomSmartPointers created.</code></span> <code>main</code>では、 <code>CustomSmartPointer</code> 2つのインスタンスを作成し、作成した<code>CustomSmartPointer</code>を印刷します<code>CustomSmartPointers created.</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">.</span> 。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">At the end of <code>main</code> , our instances of <code>CustomSmartPointer</code> will go out of scope, and Rust will call the code we put in the <code>drop</code> method, printing our final message.</span> <code>main</code>の最後に、 <code>CustomSmartPointer</code>インスタンスが範囲外になり、Rustが<code>drop</code>メソッドに配置したコードを呼び出して、最終メッセージを出力します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that we didn&#39;t need to call the <code>drop</code> method explicitly.</span>明示的に<code>drop</code>メソッドを呼び出す必要はありませんでした。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When we run this program, we&#39;ll see the following output:</span>このプログラムを実行すると、次の出力が表示されます。</span> </p><br><div data-lang=text><div data-l="CustomSmartPointers created."></div><div data-l="Dropping CustomSmartPointer with data `other stuff`!"></div><div data-l="Dropping CustomSmartPointer with data `my stuff`!"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rust automatically called <code>drop</code> for us when our instances went out of scope, calling the code we specified.</span>私たちが指定したコードを呼び出して、インスタンスがスコープから外れたときに自動的に<code>drop</code>メソッドが呼び出されました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Variables are dropped in the reverse order of their creation, so <code>d</code> was dropped before <code>c</code> .</span>変数は作成の逆の順序で削除されるため、 <code>d</code>は<code>c</code>前に削除されました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This example gives you a visual guide to how the <code>drop</code> method works;</span>この例では、 <code>drop</code>メソッドの仕組みを視覚的に示します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">usually you would specify the cleanup code that your type needs to run rather than a print message.</span>通常、印刷メッセージではなく、実行する必要があるクリーンアップコードを指定します。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Dropping a Value Early with <code>std::mem::drop</code></span>初期値を<code>std::mem::drop</code></span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Unfortunately, it&#39;s not straightforward to disable the automatic <code>drop</code> functionality.</span>残念ながら、自動<code>drop</code>機能を無効にするのは簡単ではありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Disabling <code>drop</code> isn&#39;t usually necessary;</span>通常、 <code>drop</code>無効に<code>drop</code>必要はありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">the whole point of the <code>Drop</code> trait is that it&#39;s taken care of automatically.</span> <code>Drop</code>特性の全ポイントは、それが自動的に世話をすることです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Occasionally, however, you might want to clean up a value early.</span>ただし、値を早期にクリーンアップしたいことがあります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">One example is when using smart pointers that manage locks: you might want to force the <code>drop</code> method that releases the lock to run so other code in the same scope can acquire the lock.</span> 1つの例は、ロックを管理するスマートポインタを使用する場合です。ロックを解除する<code>drop</code>メソッドを強制的に実行して、同じスコープ内の他のコードがロックを取得できるようにしたい場合があります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rust doesn&#39;t let you call the <code>Drop</code> trait&#39;s <code>drop</code> method manually;</span>錆は<code>Drop</code>特性の<code>drop</code>メソッドを手動で呼び出させることはできません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">instead you have to call the <code>std::mem::drop</code> function provided by the standard library if you want to force a value to be dropped before the end of its scope.</span>代わりに、スコープの終了前に値を強制的に<code>std::mem::drop</code>たい場合は、標準ライブラリによって提供される<code>std::mem::drop</code>関数を呼び出す必要があります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If we try to call the <code>Drop</code> trait&#39;s <code>drop</code> method manually by modifying the <code>main</code> function from Listing 15-14, as shown in Listing 15-15, we&#39;ll get a compiler error:</span>リスト15-15に示すように、リスト15-14の<code>main</code>関数を変更して<code>Drop</code>特性の<code>drop</code>メソッドを手動で呼び出そうとすると、コンパイラエラーが発生します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust,ignore><div data-l="fn main() {"></div><div data-l="    let c = CustomSmartPointer { data: String::from(&quot;some data&quot;) };"></div><div data-l="    println!(&quot;CustomSmartPointer created.&quot;);"></div><div data-l="    c.drop();"></div><div data-l="    println!(&quot;CustomSmartPointer dropped before the end of main.&quot;);"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 15-15: Attempting to call the <code>drop</code> method from the <code>Drop</code> trait manually to clean up early</span></span> <span class=caption>リスト15-15： <code>Drop</code>メソッドから<code>drop</code>メソッドを手動で呼び出して、早期にクリーンアップしようとしています</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When we try to compile this code, we&#39;ll get this error:</span>このコードをコンパイルしようとすると、次のエラーが表示されます。</span> </p><br><div data-lang=text><div data-l="error[E0040]: explicit use of destructor method"></div><div data-l="  --&gt; src/main.rs:14:7"></div><div data-l="   |"></div><div data-l="14 |     c.drop();"></div><div data-l="   |       ^^^^ explicit destructor calls not allowed"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This error message states that we&#39;re not allowed to explicitly call <code>drop</code> .</span>このエラーメッセージは、明示的に<code>drop</code>呼び出すことができないことを示しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The error message uses the term <i>destructor</i> , which is the general programming term for a function that cleans up an instance.</span>エラーメッセージには、 <i>デストラクタ</i>という用語が使用されています。 <i>デストラクタ</i>は、インスタンスをクリーンアップする関数の一般的なプログラミング用語です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A <i>destructor</i> is analogous to a <i>constructor</i> , which creates an instance.</span> <i>デストラクタ</i>は、インスタンスを作成する<i>コンストラクタ</i>に似ています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>drop</code> function in Rust is one particular destructor.</span> Rustの<code>drop</code>機能は、特定のデストラクタの1つです。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Rust doesn&#39;t let us call <code>drop</code> explicitly because Rust would still automatically call <code>drop</code> on the value at the end of <code>main</code> .</span> Rustは、Rustが<code>main</code>の最後にある値を自動的に<code>drop</code>するため、明示的に<code>drop</code>呼び出せません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This would be a <i>double free</i> error because Rust would be trying to clean up the same value twice.</span>これは、Rustが同じ値を2回クリーンアップしようとしているため、 <i>2重のフリー</i>エラーになります。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We can&#39;t disable the automatic insertion of <code>drop</code> when a value goes out of scope, and we can&#39;t call the <code>drop</code> method explicitly.</span>値が範囲外になったときに<code>drop</code>の自動挿入を無効にすることはできません。また、 <code>drop</code>メソッドを明示的に呼び出すことはできません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">So, if we need to force a value to be cleaned up early, we can use the <code>std::mem::drop</code> function.</span>したがって、値を早期に強制的に消去する必要がある場合は、 <code>std::mem::drop</code>関数を使用できます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>std::mem::drop</code> function is different than the <code>drop</code> method in the <code>Drop</code> trait.</span> <code>std::mem::drop</code>関数は、 <code>Drop</code>特性の<code>drop</code>メソッドとは異なります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">We call it by passing the value we want to force to be dropped early as an argument.</span>私たちは、強制的に強制したい値を早期に引数として渡すことで呼び出します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The function is in the prelude, so we can modify <code>main</code> in Listing 15-15 to call the <code>drop</code> function, as shown in Listing 15-16:</span>この関数はプレリュードにあります。リスト15-16の<code>main</code>を変更して、リスト15-16に示すように、 <code>drop</code>関数を呼び出します。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=filename>Filename: src/main.rs</span></span> <span class=filename>ファイル名：src / main.rs</span></span> </p><br><div data-lang=rust><div data-l="# struct CustomSmartPointer {"></div><div data-l="#     data: String,"></div><div data-l="# }"></div><div data-l=#></div><div data-l="# impl Drop for CustomSmartPointer {"></div><div data-l="#     fn drop(&amp;mut self) {"></div><div data-l="#         println!(&quot;Dropping CustomSmartPointer!&quot;);"></div><div data-l="#     }"></div><div data-l="# }"></div><div data-l=#></div><div data-l="fn main() {"></div><div data-l="    let c = CustomSmartPointer { data: String::from(&quot;some data&quot;) };"></div><div data-l="    println!(&quot;CustomSmartPointer created.&quot;);"></div><div data-l="    drop(c);"></div><div data-l="    println!(&quot;CustomSmartPointer dropped before the end of main.&quot;);"></div><div data-l=}></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><span class=caption>Listing 15-16: Calling <code>std::mem::drop</code> to explicitly drop a value before it goes out of scope</span></span> <span class=caption>リスト15-16：スコープから外れる前に明示的に値を<code>std::mem::drop</code>する<code>std::mem::drop</code>を呼び出す</span></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Running this code will print the following:</span>このコードを実行すると、次の内容が印刷されます。</span> </p><br><div data-lang=text><div data-l="CustomSmartPointer created."></div><div data-l="Dropping CustomSmartPointer with data `some data`!"></div><div data-l="CustomSmartPointer dropped before the end of main."></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The text ` <code class=2>Dropping CustomSmartPointer with data `some data`!</code></span>テキスト ` <code class=2>Dropping CustomSmartPointer with data `some data`!</code></span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>is printed between the</code> CustomSmartPointer created.</span>作成<code>is printed between the</code> CustomSmartPointerの<code>is printed between the</code>れます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>and</code> CustomSmartPointer dropped before the end of main.</span> <code>and</code> CustomSmartPointerは、メインの終了前に落としました。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>text, showing that the</code> drop <code>method code is called to drop</code> c` at that point.</span> <code>text, showing that the</code>ドロップ<code>method code is called to drop</code>れてその時点でc` <code>method code is called to drop</code>示しています。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You can use code specified in a <code>Drop</code> trait implementation in many ways to make cleanup convenient and safe: for instance, you could use it to create your own memory allocator!</span> <code>Drop</code>特性インプリメンテーションで指定されたコードをさまざまな方法で使用すると、クリーンアップを便利かつ安全に行うことができます。たとえば、独自のメモリアロケータを作成するために使用できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">With the <code>Drop</code> trait and Rust&#39;s ownership system, you don&#39;t have to remember to clean up because Rust does it automatically.</span> <code>Drop</code>特性とRustの所有システムでは、Rustが自動的に行うので、クリーンアップするのを忘れる必要はありません。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">You also don&#39;t have to worry about problems resulting from accidentally cleaning up values still in use: the ownership system that makes sure references are always valid also ensures that <code>drop</code> gets called only once when the value is no longer being used.</span>また、誤って使用中の値をクリーンアップしたことによる問題についても心配する必要はありません。参照が常に有効であることを確認する所有システムによっても、値が使用されなくなったときに<code>drop</code>が確実に呼び出されます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Now that we&#39;ve examined <code>Box&lt;T&gt;</code> and some of the characteristics of smart pointers, let&#39;s look at a few other smart pointers defined in the standard library.</span> <code>Box&lt;T&gt;</code>とスマートポインタの特性のいくつかを調べたところで、標準ライブラリで定義されている他のスマートポインタを見てみましょう。</span> </p><script>_addload(function(){_setupIW('com');_csi('en','ja','ch15-03-drop.html');});</script>