<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180723_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=compiletest.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhi1BDLmdbWiRXYMNxkaJ7TdmUrvmA" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h1> <code>compiletest</code> </h1> <br><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Introduction</span>前書き</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>compiletest</code> is the main test harness of the Rust test suite.</span> <code>compiletest</code>は、Rustテストスイートの主要なテストハーネスです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">It allows test authors to organize large numbers of tests (the Rust compiler has many thousands), efficient test execution (parallel execution is supported), and allows the test author to configure behavior and expected results of both individual and groups of tests.</span>これにより、テスト作成者は多数のテスト（Rustコンパイラには数千ものものがあります）、効率的なテスト実行（並列実行がサポートされています）を構成することができ、テスト作成者は個々のテストおよびグループのテストの動作と期待される結果を設定できます。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>compiletest</code> tests may check test code for success, for failure or in some cases, even failure to compile.</span> <code>compiletest</code>テストは、テストコードが成功したかどうか、失敗したかどうか、場合によってはコンパイルが失敗したかどうかをチェックします。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Tests are typically organized as a Rust source file with annotations in comments before and/or within the test code, which serve to direct <code>compiletest</code> on if or how to run the test, what behavior to expect, and more.</span>テストは、典型的には、直接のに役立つの前および/またはテストコード内のコメントで注釈を錆ソースファイルとして編成され<code>compiletest</code> 、IFまたはどのようにテストを実行するのを期待するのはどのような行動、そしてより多くの。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If you are unfamiliar with the compiler testing framework, see <a href=#2./tests/intro.html>this chapter</a> for additional background.</span>コンパイラのテストフレームワークに慣れていない場合は、 <a href=#2./tests/intro.html>この章</a>で追加の背景を参照してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The tests themselves are typically (but not always) organized into &quot;suites&quot; – for example, <code>run-pass</code> , a folder representing tests that should succeed, <code>run-fail</code> , a folder holding tests that should compile successfully, but return a failure (non-zero status), <code>compile-fail</code> , a folder holding tests that should fail to compile, and many more.</span>テスト自体は、通常、 <code>run-pass</code> 、成功するテストを表すフォルダ、 <code>run-fail</code> 、正常にコンパイルされるべきテストを保持するフォルダ、失敗を返すフォルダなど、（必ずしもそうではない） -zeroステータス）、 <code>compile-fail</code> 、 <code>compile-fail</code>したテストを保持するフォルダなどがあります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The various suites are defined in <a class=notranslate href=#3common>src/tools/compiletest/src/common.rs</a> in the <code>pub struct Config</code> declaration.</span>さまざまなスイートは、 <code>pub struct Config</code>宣言の<a class=notranslate href=#3common>src/tools/compiletest/src/common.rs</a>に定義されています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">And a very good introduction to the different suites of compiler tests along with details about them can be found in <a href=#2./tests/adding.html>Adding new tests</a> .</span>コンパイラテストのさまざまなスイートとその詳細については、「 <a href=#2./tests/adding.html>新しいテストの追加」</a>を参照してください。</span> </p><br><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Adding a new test file</span>新しいテストファイルを追加する</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Briefly, simply create your new test in the appropriate location under <a class=notranslate href=#3test>src/test</a> .</span>簡単に言うと、新しいテストを<a class=notranslate href=#3test>src/test</a>適切な場所に作成するだけです。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">No registration of test files is necessary as <code>compiletest</code> will scan the <a class=notranslate href=#3test>src/test</a> subfolder recursively, and will execute any Rust source files it finds as tests.</span> <code>compiletest</code>が<a class=notranslate href=#3test>src/test</a>サブフォルダを再帰的にスキャンし、 <a class=notranslate href=#3test>src/test</a>として見つかったRustソースファイルを実行するため、テストファイルの登録は必要ありません。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">See <a href=#2./tests/adding.html><code>Adding new tests</code></a> for a complete guide on how to adding new tests.</span> <a href=#2./tests/adding.html><code>Adding new tests</code></a>を<a href=#2./tests/adding.html><code>Adding new tests</code></a>方法の完全なガイドについては、 <a href=#2./tests/adding.html><code>Adding new tests</code></a>参照してください。</span> </p><br><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Header Commands</span>ヘッダーコマンド</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Source file annotations which appear in comments near the top of the source file <i>before</i> any test code are known as header commands.</span>テストコードの<i>前に</i>ソースファイルの先頭近くのコメントに表示されるソースファイルの注釈は、ヘッダコマンドと呼ばれます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">These commands can instruct <code>compiletest</code> to ignore this test, set expectations on whether it is expected to succeed at compiling, or what the test&#39;s return code is expected to be.</span>これらのコマンドは、 <code>compiletest</code>にこのテストを無視し、コンパイル時に成功するかどうか、またはテストの戻りコードがどのようになるかについての期待値を設定するように指示できます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Header commands (and their inline counterparts, Error Info commands) are described more fully <a class=notranslate href=#2./tests/adding.html#header-commands-configuring-rustc>here</a> .</span>ヘッダーコマンド（およびそのインラインの対応、エラー情報コマンド）については、 <a class=notranslate href=#2./tests/adding.html#header-commands-configuring-rustc>here</a>詳しく説明し<a class=notranslate href=#2./tests/adding.html#header-commands-configuring-rustc>here</a> 。</span> </p><br><h3> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Adding a new header command</span>新しいヘッダーコマンドを追加する</span> </h3><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Header commands are defined in the <code>TestProps</code> struct in <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a> .</span>ヘッダーコマンドは、 <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a>の<code>TestProps</code>構造体で定義されています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">At a high level, there are dozens of test properties defined here, all set to default values in the <code>TestProp</code> struct&#39;s <code>impl</code> block.</span>高レベルでは、ここで定義された数十のテストプロパティがあり、すべてが<code>TestProp</code>構造体の<code>impl</code>ブロックのデフォルト値に設定されています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Any test can override this default value by specifying the property in question as header command as a comment ( <code>//</code> ) in the test source file, before any source code.</span>どのテストでも、このデフォルト値をオーバーライドするには、問題のプロパティをヘッダ・コマンドとしてテスト・ソース・ファイル内のコメント（ <code>//</code> ）としてソース・コードの前に指定します。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Using a header command</span>ヘッダーコマンドの使用</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Here is an example, specifying the <code>must-compile-successfully</code> header command, which takes no arguments, followed by the <code>failure-status</code> header command, which takes a single argument (which, in this case is a value of 1).</span>ここでは、引数をとらない<code>must-compile-successfully</code>ヘッダーコマンドを指定する例を示します.1つの引数（この場合は値1）を取る<code>failure-status</code>ヘッダーコマンドが続きます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>failure-status</code> is instructing <code>compiletest</code> to expect a failure status of 1 (rather than the current Rust default of 101 at the time of this writing).</span> <code>failure-status</code>は、 <code>compiletest</code>に対して、現在のRustのデフォルト値101が、この執筆時点ではなく、1というエラーステータスを期待するように指示しています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The header command and the argument list (if present) are typically separated by a colon:</span>ヘッダーコマンドと引数リスト（存在する場合）は、通常、コロンで区切られます。</span> </p><br><div data-lang=rust,ignore><div data-l="#// Copyright 2018 The Rust Project Developers. See the COPYRIGHT"></div><div data-l="#// file at the top-level directory of this distribution and at"></div><div data-l="#// http://rust-lang.org/COPYRIGHT."></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Copyright 2018 The Rust Project Developers.</span>著作権2018錆プロジェクトの開発者。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">See the COPYRIGHT file at the top-level directory of this distribution and at http://rust-lang.org/COPYRIGHT.</span>このディストリビューションのトップレベルのディレクトリであるCOPYRIGHTファイルとhttp://rust-lang.org/COPYRIGHTを参照してください。</span> </div><div data-l=//></div><div data-l="#// Licensed under the Apache License, Version 2.0 &lt;LICENSE-APACHE or"></div><div data-l="#// http://www.apache.org/licenses/LICENSE-2.0&gt; or the MIT license"></div><div data-l="#// &lt;LICENSE-MIT or http://opensource.org/licenses/MIT&gt;, at your"></div><div data-l="#// option. This file may not be copied, modified, or distributed"></div><div data-l="#// except according to those terms."></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Licensed under the Apache License, Version 2.0</span> Apache License、Version 2.0でライセンス</span> <LICENSE-APACHE or http://www.apache.org/licenses/LICENSE-2.0> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">or the MIT license</span>またはMITライセンス</span> <LICENSE-MIT or http://opensource.org/licenses/MIT> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">, at your option.</span> 、あなたの選択で。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This file may not be copied, modified, or distributed except according to those terms.</span>このファイルは、これらの条項を除き、コピー、変更、または配布することはできません。</span> </div><div data-l=""></div><div data-l="#// must-compile-successfully"></div><div data-l="#// failure-status: 1"></div><div data-l="// "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">must-compile-successfully failure-status: 1</span> must-compile-successful失敗ステータス：1</span> </div><div data-l=""></div><div data-l=#![feature(termination_trait)]></div><div data-l=""></div><div data-l="use std::io::{Error, ErrorKind};"></div><div data-l=""></div><div data-l="fn main() -&gt; Result&lt;(), Box&lt;Error&gt;&gt; {"></div><div data-l="    Err(Box::new(Error::new(ErrorKind::Other, &quot;returned Box&lt;Error&gt; from main()&quot;)))"></div><div data-l=}></div></div><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Adding a new header command property</span>新しいヘッダーコマンドプロパティを追加する</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">One would add a new header command if there is a need to define some test property or behavior on an individual, test-by-test basis.</span>個々のテストプロパティまたは動作をテストごとに定義する必要がある場合は、新しいヘッダーコマンドを追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">A header command property serves as the header command&#39;s backing store (holds the command&#39;s current value) at runtime.</span>ヘッダーコマンドプロパティは、実行時にヘッダーコマンドのバッキングストアとして機能します（コマンドの現在の値を保持します）。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To add a new header command property: 1. Look for the <code>pub struct TestProps</code> declaration in <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a> and add the new public property to the end of the declaration.</span>新しいヘッダーコマンドプロパティを追加するには：1. <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a> <code>pub struct TestProps</code>宣言を探し、宣言の最後に新しいパブリックプロパティを追加します。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">2. Look for the <code>impl TestProps</code> implementation block immediately following the struct declaration and initialize the new property to its default value.</span> 2.構造体宣言の直後にある<code>impl TestProps</code>実装ブロックを探し、新しいプロパティーをデフォルト値に初期化します。</span> </p><br><h4> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Adding a new header command parser</span>新しいヘッダーコマンドパーサーを追加する</span> </h4><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When <code>compiletest</code> encounters a test file, it parses the file a line at a time by calling every parser defined in the <code>Config</code> struct&#39;s implementation block, also in <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a> (note the <code>Config</code> struct&#39;s declaration block is found in <a class=notranslate href=#3common>src/tools/compiletest/src/common.rs</a> . <code>TestProps</code> &#39;s <code>load_from()</code> method will try passing the current line of text to each parser, which, in turn typically checks to see if the line begins with a particular commented ( <code>//</code> ) header command such as <code>// must-compile-successfully</code> or <code>// failure-status</code> . Whitespace after the comment marker is optional.</span> <code>compiletest</code>がテストファイルに遭遇すると、 <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a>の<code>Config</code>構造体の実装ブロックで定義されたすべてのパーサーを呼び出すことで、一度に1行ずつファイルを解析します（ <code>Config</code>構造体の宣言ブロックが見つかります<code>TestProps</code>の<code>load_from()</code>メソッドは、現在のテキスト行を各パーサに渡してみます。各パーサは、通常、その行が特定のコメント付きで始まるかどうかを確認します<a class=notranslate href=#3common>src/tools/compiletest/src/common.rs</a> <code>//</code> ）ヘッダーコマンド（ <code>// must-compile-successfully</code>または<code>// failure-status</code> 。コメントマーカーの後の空白はオプションです。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Parsers will override a given header command property&#39;s default value merely by being specified in the test file as a header command or by having a parameter value specified in the test file, depending on the header command.</span>パーサーは、ヘッダーコマンドとしてテストファイルで指定されるか、ヘッダーコマンドに応じてテストファイルで指定されたパラメーター値を持つことによって、特定のヘッダーコマンドプロパティーのデフォルト値をオーバーライドします。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Parsers defined in <code>impl Config</code> are typically named <code>parse_&lt;header_command&gt;</code> (note kebab-case <code>&lt;header-command&gt;</code> transformed to snake-case <code>&lt;header_command&gt;</code> ).</span> <code>impl Config</code>定義されたパーサーは、通常、 <code>parse_&lt;header_command&gt;</code>という名前に<code>parse_&lt;header_command&gt;</code> （ <code>parse_&lt;header_command&gt;</code> -case <code>&lt;header-command&gt;</code>はsnake-case <code>&lt;header_command&gt;</code>変換され<code>&lt;header_command&gt;</code> ）。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><code>impl Config</code> also defines several &#39;low-level&#39; parsers which make it simple to parse common patterns like simple presence or not ( <code>parse_name_directive()</code> ), header-command:parameter(s) ( <code>parse_name_value_directive()</code> ), optional parsing only if a particular <code>cfg</code> attribute is defined ( <code>has_cfg_prefix()</code> ) and many more.</span> <code>impl Config</code> 、単純な存在またはしないような一般的なパターンを解析することを簡単にいくつかの「低レベル」パーサーを定義する（ <code>parse_name_directive()</code>ヘッダコマンド：パラメータ（複数可）（ <code>parse_name_value_directive()</code>オプションの解析のみ、特定の場合<code>cfg</code>属性が定義されています（ <code>has_cfg_prefix()</code> ）。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The low-level parsers are found near the end of the <code>impl Config</code> block;</span>低レベルのパーサーは、 <code>impl Config</code>ブロックの終わり近くにあります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">be sure to look through them and their associated parsers immediately above to see how they are used to avoid writing additional parsing code unneccessarily.</span>すぐ上にあるそれらとそれに関連するパーサを調べて、追加の解析コードを不必要に書き込むのを避けるためにどのように使用されているかを確認してください。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">As a concrete example, here is the implementation for the <code>parse_failure_status()</code> parser, in <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a> :</span>具体的な例として、 <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a>の<code>parse_failure_status()</code>パーサーの実装を次に<code>parse_failure_status()</code> <a class=notranslate href=#3header>src/tools/compiletest/src/header.rs</a> 。</span> </p><br><div data-lang=diff><div data-l="@@ -232,6 +232,7 @@ pub struct TestProps {"></div><div data-l="#     // customized normalization rules"></div><div data-l="     // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">customized normalization rules</span>カスタマイズされた正規化ルール</span> </div><div data-l="     pub normalize_stdout: Vec&lt;(String, String)&gt;,"></div><div data-l="     pub normalize_stderr: Vec&lt;(String, String)&gt;,"></div><div data-l="+    pub failure_status: i32,"></div><div data-l=" }"></div><div data-l=""></div><div data-l=" impl TestProps {"></div><div data-l="@@ -260,6 +261,7 @@ impl TestProps {"></div><div data-l="             run_pass: false,"></div><div data-l="             normalize_stdout: vec![],"></div><div data-l="             normalize_stderr: vec![],"></div><div data-l="+            failure_status: 101,"></div><div data-l="         }"></div><div data-l="     }"></div><div data-l=""></div><div data-l="@@ -383,6 +385,10 @@ impl TestProps {"></div><div data-l="             if let Some(rule) = config.parse_custom_normalization(ln, &quot;normalize-stderr&quot;) {"></div><div data-l="                 self.normalize_stderr.push(rule);"></div><div data-l="             }"></div><div data-l=+></div><div data-l="+            if let Some(code) = config.parse_failure_status(ln) {"></div><div data-l="+                self.failure_status = code;"></div><div data-l="+            }"></div><div data-l="         });"></div><div data-l=""></div><div data-l="         for key in &amp;[&quot;RUST_TEST_NOCAPTURE&quot;, &quot;RUST_TEST_THREADS&quot;] {"></div><div data-l="@@ -488,6 +494,13 @@ impl Config {"></div><div data-l="         self.parse_name_directive(line, &quot;pretty-compare-only&quot;)"></div><div data-l="     }"></div><div data-l=""></div><div data-l="+    fn parse_failure_status(&amp;self, line: &amp;str) -&gt; Option&lt;i32&gt; {"></div><div data-l="+        match self.parse_name_value_directive(line, &quot;failure-status&quot;) {"></div><div data-l="+            Some(code) =&gt; code.trim().parse::&lt;i32&gt;().ok(),"></div><div data-l="+            _ =&gt; None,"></div><div data-l="+        }"></div><div data-l="+    }"></div></div><br><h2> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Implementing the behavior change</span>行動変更の実装</span> </h2><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">When a test invokes a particular header command, it is expected that some behavior will change as a result.</span>テストで特定のヘッダーコマンドが呼び出されると、結果としていくつかの動作が変わることが予想されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">What behavior, obviously, will depend on the purpose of the header command.</span>明らかに、どのような振る舞いがヘッダーコマンドの目的に依存するでしょうか。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In the case of <code>failure-status</code> , the behavior that changes is that <code>compiletest</code> expects the failure code defined by the header command invoked in the test, rather than the default value.</span> <code>failure-status</code>場合、変更される動作は、 <code>compiletest</code>が、デフォルト値ではなく、テストで呼び出されたヘッダーコマンドによって定義された失敗コードを予期していることです。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Although specific to <code>failure-status</code> (as every header command will have a different implementation in order to invoke behavior change) perhaps it is helpful to see the behavior change implementation of one case, simply as an example.</span> <code>failure-status</code>特有です（すべてのヘッダーコマンドが動作変更を呼び出すために異なる実装を持つため）場合がありますが、たぶん例として、1つのケースの動作変更実装を確認すると役に立ちます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To implement <code>failure-status</code> , the <code>check_correct_failure_status()</code> function found in the <code>TestCx</code> implementation block, located in <a class=notranslate href=#2https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/runtest.rs>src/tools/compiletest/src/runtest.rs</a> , was modified as per below:</span> <code>failure-status</code>を実装する<code>failure-status</code>に、 <a class=notranslate href=#2https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/runtest.rs>src/tools/compiletest/src/runtest.rs</a>にある<code>TestCx</code>実装ブロックにある<code>check_correct_failure_status()</code>関数を以下のように変更しました：</span> </p><br><div data-lang=diff><div data-l="@@ -295,11 +295,14 @@ impl&lt;'test&gt; TestCx&lt;'test&gt; {"></div><div data-l="     }"></div><div data-l=""></div><div data-l="     fn check_correct_failure_status(&amp;self, proc_res: &amp;ProcRes) {"></div><div data-l="#//-        // The value the rust runtime returns on failure"></div><div data-l="-        // "> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The value the rust runtime returns on failure</span>錆ランタイムが失敗したときに返す値</span> </div><div data-l="-        const RUST_ERR: i32 = 101;"></div><div data-l="-        if proc_res.status.code() != Some(RUST_ERR) {"></div><div data-l="+        let expected_status = Some(self.props.failure_status);"></div><div data-l="+        let received_status = proc_res.status.code();"></div><div data-l=+></div><div data-l="+        if expected_status != received_status {"></div><div data-l="             self.fatal_proc_rec("></div><div data-l="-                &amp;format!(&quot;failure produced the wrong error: {}&quot;, proc_res.status),"></div><div data-l="+                &amp;format!(&quot;Error: expected failure status ({:?}) but received status {:?}.&quot;,"></div><div data-l="+                         expected_status,"></div><div data-l="+                         received_status),"></div><div data-l="                 proc_res,"></div><div data-l="             );"></div><div data-l="         }"></div><div data-l="@@ -320,7 +323,6 @@ impl&lt;'test&gt; TestCx&lt;'test&gt; {"></div><div data-l="         );"></div><div data-l=""></div><div data-l="         let proc_res = self.exec_compiled_test();"></div><div data-l=-></div><div data-l="         if !proc_res.status.success() {"></div><div data-l="             self.fatal_proc_rec(&quot;test run failed!&quot;, &amp;proc_res);"></div><div data-l="         }"></div><div data-l="@@ -499,7 +501,6 @@ impl&lt;'test&gt; TestCx&lt;'test&gt; {"></div><div data-l="                 expected,"></div><div data-l="                 actual"></div><div data-l="             );"></div><div data-l="-            panic!();"></div><div data-l="         }"></div><div data-l="     }"></div></div><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note the use of <code>self.props.failure_status</code> to access the header command property.</span> <code>self.props.failure_status</code>を使用してheaderコマンド・プロパティにアクセスすることに注意してください。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">In tests which do not specify the failure status header command, <code>self.props.failure_status</code> will evaluate to the default value of 101 at the time of this writing.</span> failure status headerコマンドを指定しないテストでは、 <code>self.props.failure_status</code>はこの書き込みの時点でデフォルト値の101に評価されます。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">But for a test which specifies a header command of, for example, <code>// failure-status: 1</code> , <code>self.props.failure_status</code> will evaluate to 1, as <code>parse_failure_status()</code> will have overridden the <code>TestProps</code> default value, for that test specifically.</span>しかし、例えば、ヘッダのコマンドを指定し、テストするための、 <code>// failure-status: 1</code> 、 <code>self.props.failure_status</code>として、1と評価される<code>parse_failure_status()</code>オーバーライドされているであろう<code>TestProps</code>具体その試験のために、デフォルト値。</span> </p><br> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left"><a class=notranslate href=#1https://github.com/rust-lang/rust/tree/master/src/test>test</a> <a class=notranslate href=#1https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/header.rs>header</a> <a class=notranslate href=#1https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/common.rs>common</a></span> <a class=notranslate href=#1https://github.com/rust-lang/rust/tree/master/src/test>test</a> <a class=notranslate href=#1https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/header.rs>header</a> <a class=notranslate href=#1https://github.com/rust-lang/rust/tree/master/src/tools/compiletest/src/common.rs>common</a></span><script>_addload(function(){_setupIW('com');_csi('en','ja','compiletest.html');});</script>