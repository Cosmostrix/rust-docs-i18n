<!DOCTYPE html><html lang=ja-x-mtfrom-en><head><script>(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(h){}};this.tick("start",null,a)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var f=0<d?new e(d):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="https://translate.googleusercontent.com/translate/releases/twsfe_w_20180723_RC00/r/js/translate_c.js"></script><script>_intlStrings._originalText = "英語の原文テキスト:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|ja";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="%1$s に %2$s により翻訳されました";_intlStrings._unknown="不明";_intlStrings._suggestTranslation="翻訳を改善する"  ;_intlStrings._submit="送信";_intlStrings._suggestThanks="Google 翻訳の改善にご協力いただきありがとうございました。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href=used.html hreflang=en rel="alternate machine-translated-from"><base href="" target=_top /></head><body><iframe src="https://translate.google.com/translate_un?hl=ja&prev=_t&sl=en&tl=ja&lang=en&usg=ALkJrhgQ4ezENlkxSVYGeAHMYQ9vf0ngJQ" width=0 height=0 frameborder=0 style="width:0px;height:0px;border:0px;display:none;"></iframe><h1> <code>used</code> </h1> <br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The tracking issue for this feature is: <a class=notranslate href=#2https://github.com/rust-lang/rust/issues/40289>40289</a> .</span>この機能のトラッキングに関する問題は次の<a class=notranslate href=#2https://github.com/rust-lang/rust/issues/40289>40289</a>です<a class=notranslate href=#2https://github.com/rust-lang/rust/issues/40289>40289</a></span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">------------------------</span> ------------------------</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The <code>#[used]</code> attribute can be applied to <code>static</code> variables to prevent the Rust compiler from optimizing them away even if they appear to be unused by the crate (appear to be &quot;dead code&quot;).</span> <code>static</code>変数に<code>#[used]</code>属性を適用すると、Rustコンパイラがクレートによって使用されていないように見えても（「デッドコード」と表示されていても）、最適化されないようにすることができます。</span> </p><br><div data-lang=" rust"><div data-l=#![feature(used)]></div><div data-l=""></div><div data-l=#[used]></div><div data-l="static FOO: i32 = 1;"></div><div data-l=""></div><div data-l="static BAR: i32 = 2;"></div><div data-l=""></div><div data-l="fn main() {}"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">If you compile this program into an object file, you&#39;ll see that <code>FOO</code> makes it to the object file but <code>BAR</code> doesn&#39;t.</span>このプログラムをオブジェクトファイルにコンパイルすると、 <code>FOO</code>がオブジェクトファイルを作成するが、 <code>BAR</code>は生成しないことがわかります。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Neither static variable is used by the program.</span>どちらの静的変数もプログラムによって使用されません。</span> </p><br><div data-lang=" text"><div data-l="$ rustc -C opt-level=3 --emit=obj used.rs"></div><div data-l=""></div><div data-l="$ nm -C used.o"></div><div data-l="0000000000000000 T main"></div><div data-l="                 U std::rt::lang_start"></div><div data-l="0000000000000000 r used::FOO"></div><div data-l="0000000000000000 t used::main"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Note that the <i>linker</i> knows nothing about the <code>#[used]</code> attribute and will remove <code>#[used]</code> symbols if they are not referenced by other parts of the program:</span> <i>リンカ</i>は<code>#[used]</code>属性については何も知らず、プログラムの他の部分で参照されていない場合は<code>#[used]</code>シンボルを削除することに注意してください。</span> </p><br><div data-lang=" text"><div data-l="$ rustc -C opt-level=3 used.rs"></div><div data-l=""></div><div data-l="$ nm -C used | grep FOO"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">&quot;This doesn&#39;t sound too useful then!&quot;</span> &quot;これはあまりにも役に立つとは思わない！&quot;</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">you may think but keep reading.</span>あなたは考えるかもしれないが、読書を続ける。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">To preserve the symbols all the way to the final binary, you&#39;ll need the cooperation of the linker.</span>シンボルを最後のバイナリまで保存するには、リンカの協力が必要です。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Here&#39;s one example:</span>ここに1つの例があります：</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The ELF standard defines two special sections, <code>.init_array</code> and <code>.pre_init_array</code> , that may contain function pointers which will be executed <i>before</i> the <code>main</code> function is invoked.</span> ELF標準では、 <code>.init_array</code>と<code>.pre_init_array</code> 2つの特別なセクションが定義されています。 <code>.init_array</code>セクション<i>に</i>は、 <code>main</code>関数が呼び出される<i>前</i>に実行される関数ポインタが含まれています。</span> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">The linker will preserve symbols placed in these sections (at least when linking programs that target the <code>*-*-linux-*</code> targets).</span>リンカはこれらのセクションに置かれたシンボルを保存します（少なくとも<code>*-*-linux-*</code>ターゲットをターゲットとするプログラムをリンクするときは）。</span> </p><br><div data-lang=" rust,ignore"><div data-l=#![feature(used)]></div><div data-l=""></div><div data-l="extern &quot;C&quot; fn before_main() {"></div><div data-l="    println!(&quot;Hello, world!&quot;);"></div><div data-l=}></div><div data-l=""></div><div data-l="#[link_section = &quot;.init_array&quot;]"></div><div data-l=#[used]></div><div data-l="static INIT_ARRAY: [extern &quot;C&quot; fn(); 1] = [before_main];"></div><div data-l=""></div><div data-l="fn main() {}"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">So, <code>#[used]</code> and <code>#[link_section]</code> can be combined to obtain &quot;life before main&quot;.</span>したがって、 <code>#[used]</code>と<code>#[link_section]</code>を組み合わせて &quot;main before life&quot;を得ることができます。</span> </p><br><div data-lang=" text"><div data-l="$ rustc -C opt-level=3 before-main.rs"></div><div data-l=""></div><div data-l="$ ./before-main"></div><div data-l="Hello, world!"></div></div><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">Another example: ARM Cortex-M microcontrollers need their reset handler, a pointer to the function that will executed right after the microcontroller is turned on, to be placed near the start of their FLASH memory to boot properly.</span>もう1つの例：ARM Cortex-Mマイクロコントローラには、マイクロコントローラの電源を入れた直後に実行される機能へのポインタであるリセットハンドラが必要です。</span> </p><br><p> <span class="notranslate" onmouseover="_tipon(this)" onmouseout="_tipoff()"><span class="google-src-text" style="direction: ltr; text-align: left">This condition can be met using <code>#[used]</code> and <code>#[link_section]</code> plus a linker script.</span>この条件は、 <code>#[link_section]</code>と<code>#[link_section]</code>とリンカスクリプトを<code>#[used]</code>満たさ<code>#[used]</code>ます。</span> </p><br><div data-lang=" rust,ignore"><div data-l=#![feature(panic_implementation)]></div><div data-l=#![feature(used)]></div><div data-l=#![no_main]></div><div data-l=#![no_std]></div><div data-l=""></div><div data-l="use core::panic::PanicInfo;"></div><div data-l=""></div><div data-l="extern &quot;C&quot; fn reset_handler() -&gt; ! {"></div><div data-l="    loop {}"></div><div data-l=}></div><div data-l=""></div><div data-l="#[link_section = &quot;.reset_handler&quot;]"></div><div data-l=#[used]></div><div data-l="static RESET_HANDLER: extern &quot;C&quot; fn() -&gt; ! = reset_handler;"></div><div data-l=""></div><div data-l=#[panic_implementation]></div><div data-l="fn panic_impl(info: &amp;PanicInfo) -&gt; ! {"></div><div data-l="    loop {}"></div><div data-l=}></div></div><br><div data-lang=" text"><div data-l=MEMORY></div><div data-l={></div><div data-l="  FLASH : ORIGIN = 0x08000000, LENGTH = 128K"></div><div data-l="  RAM : ORIGIN = 0x20000000, LENGTH = 20K"></div><div data-l=}></div><div data-l=""></div><div data-l=SECTIONS></div><div data-l={></div><div data-l="  .text ORIGIN(FLASH) :"></div><div data-l="  {"></div><div data-l="    /* Vector table */"></div><div data-l="    LONG(ORIGIN(RAM) + LENGTH(RAM)); /* initial SP value */"></div><div data-l="    KEEP(*(.reset_handler));"></div><div data-l=""></div><div data-l="    /* Omitted: The rest of the vector table */"></div><div data-l=""></div><div data-l="    *(.text.*);"></div><div data-l="  } &gt; FLASH"></div><div data-l=""></div><div data-l="  /DISCARD/ :"></div><div data-l="  {"></div><div data-l="    /* Unused unwinding stuff */"></div><div data-l="    *(.ARM.exidx.*)"></div><div data-l="  }"></div><div data-l=}></div></div><br><div data-lang=" text"><div data-l="$ xargo rustc --target thumbv7m-none-eabi --release -- \"></div><div data-l="    -C link-arg=-Tlink.x -C link-arg=-nostartfiles"></div><div data-l=""></div><div data-l="$ arm-none-eabi-objdump -Cd target/thumbv7m-none-eabi/release/app"></div><div data-l="./target/thumbv7m-none-eabi/release/app:     file format elf32-littlearm"></div><div data-l=""></div><div data-l=""></div><div data-l="Disassembly of section .text:"></div><div data-l=""></div><div data-l="08000000 &lt;app::RESET_HANDLER-0x4&gt;:"></div><div data-l=" 8000000:       20005000        .word   0x20005000"></div><div data-l=""></div><div data-l="08000004 &lt;app::RESET_HANDLER&gt;:"></div><div data-l=" 8000004:       08000009                                ...."></div><div data-l=""></div><div data-l="08000008 &lt;app::reset_handler&gt;:"></div><div data-l=" 8000008:       e7fe            b.n     8000008 &lt;app::reset_handler&gt;"></div></div><script>_addload(function(){_setupIW('com');_csi('en','ja','used.html');});</script>