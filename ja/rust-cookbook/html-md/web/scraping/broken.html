<!DOCTYPE html>
<h2>Check a webpage for broken links</h2>
<br>
<p><a href="#3reqwest">!<a class="notranslate" href="#4reqwest-badge">reqwest-badge</a></a> <a href="#3select">!<a class="notranslate" href="#4select-badge">select-badge</a></a> <a href="#3url">!<a class="notranslate" href="#4url-badge">url-badge</a></a> <a href="#3cat-net">!<a class="notranslate" href="#4cat-net-badge">cat-net-badge</a></a></p>
<br>
<p>Call <code>get_base_url</code> to retrieve the base URL. If the document has a base tag,
get the href <a class="notranslate" href="#4`attr`">`attr`</a> from base tag. <a class="notranslate" href="#4`Position::BeforePath`">`Position::BeforePath`</a> of the original
URL acts as a default.</p>
<br>
<p>Iterate through links in the document and parse with <a class="notranslate" href="#4`url::ParseOptions`">`url::ParseOptions`</a>
and <a class="notranslate" href="#4`Url::parse`">`Url::parse`</a>). Makes a request to the links with reqwest and verifies
<a class="notranslate" href="#4`StatusCode`">`StatusCode`</a>.</p>
<br>
<div data-lang="rust,no_run"><div data-l="# #[macro_use]"></div><div data-l="# extern crate error_chain;"></div><div data-l="extern crate reqwest;"></div><div data-l="extern crate select;"></div><div data-l="extern crate url;"></div><div data-l=""></div><div data-l="use std::collections::HashSet;"></div><div data-l=""></div><div data-l="use url::{Url, Position};"></div><div data-l="use reqwest::StatusCode;"></div><div data-l="use select::document::Document;"></div><div data-l="use select::predicate::Name;"></div><div data-l="#"></div><div data-l="# error_chain! {"></div><div data-l="#   foreign_links {"></div><div data-l="#       ReqError(reqwest::Error);"></div><div data-l="#       IoError(std::io::Error);"></div><div data-l="#       UrlParseError(url::ParseError);"></div><div data-l="#   }"></div><div data-l="# }"></div><div data-l=""></div><div data-l="fn get_base_url(url: &amp;Url, doc: &amp;Document) -&gt; Result&lt;Url&gt; {"></div><div data-l="    let base_tag_href = doc.find(Name(&quot;base&quot;)).filter_map(|n| n.attr(&quot;href&quot;)).nth(0);"></div><div data-l=""></div><div data-l="    let base_url = base_tag_href.map_or_else("></div><div data-l="        || Url::parse(&amp;url[..Position::BeforePath]),"></div><div data-l="        Url::parse,"></div><div data-l="    )?;"></div><div data-l=""></div><div data-l="    Ok(base_url)"></div><div data-l="}"></div><div data-l=""></div><div data-l="fn check_link(url: &amp;Url) -&gt; Result&lt;bool&gt; {"></div><div data-l="    let res = reqwest::get(url.as_ref())?;"></div><div data-l=""></div><div data-l="    Ok(res.status() != StatusCode::NotFound)"></div><div data-l="}"></div><div data-l=""></div><div data-l="fn run() -&gt; Result&lt;()&gt; {"></div><div data-l="    let url = Url::parse(&quot;https://www.rust-lang.org/en-US/&quot;)?;"></div><div data-l=""></div><div data-l="    let res = reqwest::get(url.as_ref())?;"></div><div data-l="    let document = Document::from_read(res)?;"></div><div data-l=""></div><div data-l="    let base_url = get_base_url(&amp;url, &amp;document)?;"></div><div data-l=""></div><div data-l="    let base_parser = Url::options().base_url(Some(&amp;base_url));"></div><div data-l=""></div><div data-l="    let links: HashSet&lt;Url&gt; = document"></div><div data-l="        .find(Name(&quot;a&quot;))"></div><div data-l="        .filter_map(|n| n.attr(&quot;href&quot;))"></div><div data-l="        .filter_map(|link| base_parser.parse(link).ok())"></div><div data-l="        .collect();"></div><div data-l=""></div><div data-l="    links"></div><div data-l="        .iter()"></div><div data-l="        .filter(|link| check_link(link).ok() == Some(false))"></div><div data-l="        .for_each(|x| println!(&quot;{} is broken.&quot;, x));"></div><div data-l=""></div><div data-l="    Ok(())"></div><div data-l="}"></div><div data-l="#"></div><div data-l="# quick_main!(run);"></div></div>
<br>
<a class="notranslate" href="#1https://docs.rs/select/*/select/node/struct.Node.html#method.attr">`attr`</a>
<a class="notranslate" href="#1https://docs.rs/url/*/url/enum.Position.html#variant.BeforePath">`Position::BeforePath`</a>
<a class="notranslate" href="#1https://docs.rs/reqwest/*/reqwest/enum.StatusCode.html">`StatusCode`</a>
<a class="notranslate" href="#1https://docs.rs/url/*/url/struct.Url.html#method.parse">`url::Parse`</a>
<a class="notranslate" href="#1https://docs.rs/url/*/url/struct.ParseOptions.html">`url::ParseOptions`</a>